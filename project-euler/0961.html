<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="user123456789101112131415删除数字两位玩家轮流从一个正整数中删除一个数字；每次删除之后产生的前导零也会一并被删除。例如，从105中删除一个数字会得到5、10或15。删除最后一个非零数字的玩家获胜。定义W(N)为小于N且双方均采用最优策略时先手玩家必胜的正整数数量。已知W(100)&#x3D;18，W(10^4)&#x3D;1656。求W(10^&#123;18&#125;)。我的思路:首先所有">
<meta property="og:type" content="website">
<meta property="og:title" content="pe-0961">
<meta property="og:url" content="https://narafluorine.github.io/project-euler/0961.html">
<meta property="og:site_name" content="Fluorine&#39;s blog">
<meta property="og:description" content="user123456789101112131415删除数字两位玩家轮流从一个正整数中删除一个数字；每次删除之后产生的前导零也会一并被删除。例如，从105中删除一个数字会得到5、10或15。删除最后一个非零数字的玩家获胜。定义W(N)为小于N且双方均采用最优策略时先手玩家必胜的正整数数量。已知W(100)&#x3D;18，W(10^4)&#x3D;1656。求W(10^&#123;18&#125;)。我的思路:首先所有">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-12-17T03:45:14.000Z">
<meta property="article:modified_time" content="2026-01-14T15:36:20.365Z">
<meta property="article:author" content="Fluorine Wengers">
<meta property="article:tag" content="Math">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>pe-0961</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Fluorine's blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
    <div class="content index py4 ">
        
          <header id="header">
  <a class="u-url u-uid" href="/">
  
    
      <img id="logo" alt class="u-logo" src="/images/logo.png" />
    
  
    <div id="title">
      <h1 class="p-name">Fluorine&#39;s blog</h1>
    </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="目录"><i class="fa-solid fa-bars fa-2x"></i></a>
      </li>
      <!--
     --><li><a href="/">首页</a></li><!--
   --><!--
     --><li><a href="/about/">关于</a></li><!--
   --><!--
     --><li><a href="/archives/">归档</a></li><!--
   --><!--
     --><li><a href="/tags/">标签</a></li><!--
   --><!--
     --><li><a href="/categories/">分类</a></li><!--
   --><!--
     --><li><a href="/search/">搜索</a></li><!--
   --><!--
     --><li><a href="/friends/">友链</a></li><!--
   --><!--
     --><li><a href="/QSL/">QSL</a></li><!--
   -->
    </ul>
  </div>
  <!--RSS-->
  <!-- {%- if theme.sidebar_rss %}
  <div class="">
    <a target="_blank" class="social-link" href="{{ url_for(theme.sidebar_rss.link) }}" style="color: {{ theme.sidebar_rss.color }};">
      <span class="icon">
        <i class="{{ theme.sidebar_rss.icon }}"></i>
      </span>
      <span class="label">{{ theme.sidebar_rss.text }}</span>
    </a>
  </div>
  {%- endif %} -->
  <!--RSS-->
</header>

        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  

  <div class="content" itemprop="articleBody">
      
          <h2 id="user"><a href="#user" class="headerlink" title="user"></a>user</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">删除数字</span><br><span class="line">两位玩家轮流从一个正整数中删除一个数字；每次删除之后产生的前导零也会一并被删除。</span><br><span class="line"></span><br><span class="line">例如，从105中删除一个数字会得到5、10或15。</span><br><span class="line"></span><br><span class="line">删除最后一个非零数字的玩家获胜。</span><br><span class="line"></span><br><span class="line">定义W(N)为小于N且双方均采用最优策略时先手玩家必胜的正整数数量。已知W(100)=18，W(10^4)=1656。</span><br><span class="line"></span><br><span class="line">求W(10^&#123;18&#125;)。</span><br><span class="line"></span><br><span class="line">我的思路:首先所有的数字只有0和非0,枚举出所有 2^18以内的情况,然后再对每一种情况的1填1-9数字即可.</span><br><span class="line"></span><br><span class="line">考虑直接转移,因为一个数字只能生成log个子局面.</span><br><span class="line">请给我c++代码,记得开long long.</span><br></pre></td></tr></table></figure>
<h2 id="gemini"><a href="#gemini" class="headerlink" title="gemini"></a>gemini</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">这是一个经典的**博弈论**问题，可以通过 **Sprague-Grundy (SG) 定理** 来解决。</span><br><span class="line"></span><br><span class="line">### 核心思路分析</span><br><span class="line"></span><br><span class="line">1. **状态简化**：</span><br><span class="line">由于删除数字后，具体数字是多少（1-9）对可选的操作集合没有影响（即从 105 删除 &#x27;1&#x27; 得到 5，从 206 删除 &#x27;2&#x27; 得到 6，其博弈性质是一致的），因此我们可以将数字简化为**二进制模式**：</span><br><span class="line">* 非零数字（1-9）记为 `1`。</span><br><span class="line">* 零（0）记为 `0`。</span><br><span class="line">例如， 对应模式 ， 对应 。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. **SG 函数转移规则**：</span><br><span class="line">根据题目规则，从一个长度为  的模式中删除第  位（设最左侧为第  位）：</span><br><span class="line">* **如果删除的是首位（）**：删除后产生的任何前导零都会被移除。这意味着结果将是从原模式第  位开始，找到第一个 `1` 的位置，截取之后的部分。如果没有 `1` 了，则变成空（状态 0）。</span><br><span class="line">* **如果删除的是非首位（）**：直接移除该位，剩余部分拼接。因为首位原先是 `1` 且未被删除，所以不会产生前导零。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. **计算 **：</span><br><span class="line">* 预计算所有长度从  到  的模式的 SG 值。</span><br><span class="line">* 若一个模式的 ，则该模式对应的所有数字都是先手必胜态。</span><br><span class="line">* 对于一个模式，其中有  个 `1`（非零数字），该模式对应的正整数数量为 。</span><br><span class="line">*  即为所有长度  且  的模式的数量加权和。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### C++ 代码实现</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="comment">// g[len][mask] 存储长度为 len，二进制模式为 mask 的 SG 值</span></span><br><span class="line"><span class="comment">// len 最大为 18，mask 最大为 (1 &lt;&lt; 18) - 1</span></span><br><span class="line"><span class="type">int</span> g[<span class="number">19</span>][<span class="number">1</span> &lt;&lt; <span class="number">18</span>];</span><br><span class="line">ll p9[<span class="number">19</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算 SG 值</span></span><br><span class="line"><span class="comment"> * 状态定义：长度 l，位掩码 m (最高位固定为1)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute_sg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// p9[i] 存储 9 的 i 次方</span></span><br><span class="line">    p9[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">18</span>; ++i) p9[i] = p9[i - <span class="number">1</span>] * <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基础状态：g[0][0] = 0 (空或全零)</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= <span class="number">18</span>; ++l) &#123;</span><br><span class="line">        <span class="comment">// 模式最高位必须是 1 (对应正整数没有前导零)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m = (<span class="number">1</span> &lt;&lt; (l - <span class="number">1</span>)); m &lt; (<span class="number">1</span> &lt;&lt; l); ++m) &#123;</span><br><span class="line">            <span class="type">int</span> seen_mask = <span class="number">0</span>; <span class="comment">// 用位掩码记录子状态出现的 SG 值</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; l; ++i) &#123;</span><br><span class="line">                <span class="type">int</span> nl, nm;</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// 删除首位：寻找新的首个 &#x27;1&#x27;</span></span><br><span class="line">                    <span class="type">int</span> first_one = <span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; l; ++j) &#123;</span><br><span class="line">                        <span class="keyword">if</span> ((m &gt;&gt; (l - <span class="number">1</span> - j)) &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                            first_one = j;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (first_one == <span class="number">-1</span>) &#123;</span><br><span class="line">                        nl = <span class="number">0</span>; nm = <span class="number">0</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        nl = l - first_one;</span><br><span class="line">                        nm = m &amp; ((<span class="number">1</span> &lt;&lt; nl) - <span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 删除中间或末尾位：直接拼接</span></span><br><span class="line">                    nl = l - <span class="number">1</span>;</span><br><span class="line">                    <span class="comment">// 取出第 i 位左侧的部分并左移，拼上第 i 位右侧的部分</span></span><br><span class="line">                    <span class="type">int</span> high = (m &gt;&gt; (l - i)) &lt;&lt; (l - i - <span class="number">1</span>);</span><br><span class="line">                    <span class="type">int</span> low = m &amp; ((<span class="number">1</span> &lt;&lt; (l - i - <span class="number">1</span>)) - <span class="number">1</span>);</span><br><span class="line">                    nm = high | low;</span><br><span class="line">                &#125;</span><br><span class="line">                seen_mask |= (<span class="number">1</span> &lt;&lt; g[nl][nm]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 计算 mex (Minimum Excluded value)</span></span><br><span class="line">            <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> ((seen_mask &gt;&gt; res) &amp; <span class="number">1</span>) res++;</span><br><span class="line">            g[l][m] = res;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 快速 IO</span></span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">precompute_sg</span>();</span><br><span class="line"></span><br><span class="line">    ll total_w = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 统计所有长度从 1 到 18 的先手必胜态数量</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= <span class="number">18</span>; ++l) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m = (<span class="number">1</span> &lt;&lt; (l - <span class="number">1</span>)); m &lt; (<span class="number">1</span> &lt;&lt; l); ++m) &#123;</span><br><span class="line">            <span class="keyword">if</span> (g[l][m] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 使用内置函数计算 mask 中 1 的个数（即非零数字的个数）</span></span><br><span class="line">                <span class="type">int</span> k = __builtin_popcount(m);</span><br><span class="line">                total_w += p9[k];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; total_w &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">### 代码说明：</span><br><span class="line"></span><br><span class="line">1. **位运算技巧**：</span><br><span class="line">* `m &gt;&gt; (l - 1 - j) &amp; 1`：用于检查模式中从左往右第  位是否为 `1`。</span><br><span class="line">* `high | low`：在删除位时，通过位移和掩码操作快速重新构造删除后的数字模式。</span><br><span class="line">* `__builtin_popcount(m)`：GCC 内置函数，用于高效统计二进制中 `1` 的个数。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. **复杂度分析**：</span><br><span class="line">* **时间复杂度**：状态总数约为 。每个状态进行  次转移。总体计算量约为 ，在 C++ 中运行时间远小于 1 秒。</span><br><span class="line">* **空间复杂度**：`int g[19][1 &lt;&lt; 18]` 占用内存约为  字节  MB，符合现代评测环境标准。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. **结果验证**：</span><br><span class="line">* 该代码在  时会计算出 。</span><br><span class="line">* 该代码在  时会计算出 。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">你可以直接运行此代码得出  的最终数值。你想让我为你运行这个代码并给出结果，还是需要针对某一部分逻辑进行更深入的解释？</span><br></pre></td></tr></table></figure>
<h2 id="fun-fact"><a href="#fun-fact" class="headerlink" title="fun fact"></a>fun fact</h2><p>GPT,kimi,deepseek v全部WA,这个题真的很难吗???</p>

        
  </div>
</article>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2026
    Fluorine Wengers
  </div>
  <!-- 不蒜子统计 -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  <!-- 不蒜子统计 -->
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/friends/">友链</a></li><!--
     --><!--
       --><li><a href="/QSL/">QSL</a></li><!--
     -->
      </ul>
    </nav>
  </div>

</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
