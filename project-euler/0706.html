<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="本题Flu使用提示词工程(Vibe Coding)做的. 观察发现这是一个矩阵问题,可以把情况压缩到一个向量里面. 于是懒得自己写就问gpt要一个脚本. prompt 12345678910111213141516173似数将正整数n视为数字串，记f(n)为能被3整除的n的非空子串数目。例如，数字串”2573”有10个非空子串，其中有三个能被3整除，分别是57、573和3，因此f(2573)&#x3D;3。">
<meta property="og:type" content="website">
<meta property="og:title" content="Fluorine&#39;s blog">
<meta property="og:url" content="https://narafluorine.github.io/project-euler/0706.html">
<meta property="og:site_name" content="Fluorine&#39;s blog">
<meta property="og:description" content="本题Flu使用提示词工程(Vibe Coding)做的. 观察发现这是一个矩阵问题,可以把情况压缩到一个向量里面. 于是懒得自己写就问gpt要一个脚本. prompt 12345678910111213141516173似数将正整数n视为数字串，记f(n)为能被3整除的n的非空子串数目。例如，数字串”2573”有10个非空子串，其中有三个能被3整除，分别是57、573和3，因此f(2573)&#x3D;3。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-11-16T06:00:06.433Z">
<meta property="article:modified_time" content="2025-11-16T06:00:06.433Z">
<meta property="article:author" content="Fluorine Wengers">
<meta property="article:tag" content="algorithm">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Fluorine&#39;s blog</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Fluorine's blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
    <div class="content index py4 ">
        
          <header id="header">
  <a class="u-url u-uid" href="/">
  
    
      <img id="logo" alt class="u-logo" src="/images/logo.png" />
    
  
    <div id="title">
      <h1 class="p-name">Fluorine&#39;s blog</h1>
    </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="目录"><i class="fa-solid fa-bars fa-2x"></i></a>
      </li>
      <!--
     --><li><a href="/">首页</a></li><!--
   --><!--
     --><li><a href="/about/">关于</a></li><!--
   --><!--
     --><li><a href="/archives/">归档</a></li><!--
   --><!--
     --><li><a href="/tags/">标签</a></li><!--
   --><!--
     --><li><a href="/categories/">分类</a></li><!--
   --><!--
     --><li><a href="/search/">搜索</a></li><!--
   --><!--
     --><li><a href="/friends/">友链</a></li><!--
   --><!--
     --><li><a href="/QSL/">QSL</a></li><!--
   -->
    </ul>
  </div>
</header>

        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  

  <div class="content" itemprop="articleBody">
      
          <p>本题Flu使用提示词工程(Vibe Coding)做的.</p>
<p>观察发现这是一个矩阵问题,可以把情况压缩到一个向量里面.</p>
<p>于是懒得自己写就问gpt要一个脚本.</p>
<h1>prompt</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">3似数</span><br><span class="line">将正整数n视为数字串，记f(n)为能被3整除的n的非空子串数目。例如，数字串”2573”有10个非空子串，其中有三个能被3整除，分别是57、573和3，因此f(2573)=3。</span><br><span class="line"></span><br><span class="line">如果f(n)能被3整除，则称n为3似数。</span><br><span class="line"></span><br><span class="line">记F(d)为d位数中3似数的个数。例如，F(2)=30，F(6)=290898。</span><br><span class="line"></span><br><span class="line">求F(10^5)并将你的答案对1e9+7取余。</span><br><span class="line"></span><br><span class="line">我的思路是构建一个长度81的向量,代表当前遍历到的位数为i时,所有子区间和模3余012的结果的数量再模3分别是0,1,2的时候的数字的数量.(比如向量0代表当前遍历到第i位时,所有子区间模3余1的区间为0(再模3),模3余2的区间为0(再模3),模3余0的区间个数为0(再模3)的数字的个数,容易发现这是3*3*3*3=81维的,不是243维的)</span><br><span class="line">然后对于每一位填0-9,这可以构成一个27*27的转移矩阵,然后快速幂矩阵乘法计算出10^5次方.</span><br><span class="line"></span><br><span class="line">你需要特别注意,当前遍历到i位时的向量代表了各种情况下数字的个数,这个是对1e9+7取模的,不是对3取模的,所以矩阵就是81维,绝对不是243维的.</span><br><span class="line"></span><br><span class="line">你需要构建这个矩阵最后求解,请注意初始的向量因为d位数的限制不能为0,而转移矩阵可以为0.</span><br><span class="line">而且初始向量是1位数,你实际要求的是d-1次方.</span><br><span class="line">请给我python脚本。</span><br></pre></td></tr></table></figure>
<h1>ChatGPT</h1>
<p>我已经实现并运行了完整的 Python 脚本（含矩阵构建、快速幂、校验），并计算出结果：</p>
<ul>
<li>F(2) = 30（与题目给定一致）</li>
<li>F(6) = 290898（与题目给定一致）</li>
<li>F(10^5) mod (1e9+7) = <strong>884837055</strong></li>
</ul>
<p>我也把用于计算的脚本保存为 <code>/mnt/data/compute_F_3like.py</code>（笔记本里可见完整代码片段）。下面我把完整可直接运行的脚本粘贴给你（与你看到的运行版完全一致）——可直接保存为 <code>.py</code> 并运行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">MOD = <span class="number">10</span>**<span class="number">9</span> + <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build mapping between state (s0,s1,s2,t0) with s0,s1,s2,t0 in &#123;0,1,2&#125; and index 0..80</span></span><br><span class="line">states = []</span><br><span class="line">idx = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> s0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> s1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> s2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            <span class="keyword">for</span> t0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                st = (s0,s1,s2,t0)</span><br><span class="line">                idx[st] = <span class="built_in">len</span>(states)</span><br><span class="line">                states.append(st)</span><br><span class="line">N = <span class="built_in">len</span>(states)</span><br><span class="line"><span class="keyword">assert</span> N == <span class="number">81</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next_state</span>(<span class="params">st, digit</span>):</span><br><span class="line">    s0,s1,s2,t0 = st</span><br><span class="line">    x = digit % <span class="number">3</span></span><br><span class="line">    s = [s0,s1,s2]</span><br><span class="line">    sprime = [ (s[(k - x) % <span class="number">3</span>] + (<span class="number">1</span> <span class="keyword">if</span> x == k <span class="keyword">else</span> <span class="number">0</span>)) % <span class="number">3</span> <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>) ]</span><br><span class="line">    t0p = (t0 + sprime[<span class="number">0</span>]) % <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> (sprime[<span class="number">0</span>], sprime[<span class="number">1</span>], sprime[<span class="number">2</span>], t0p)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build transition matrix M (N x N) such that v_next = M * v_current</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_M</span>():</span><br><span class="line">    M = [[<span class="number">0</span>]*N <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line">    <span class="keyword">for</span> j, st <span class="keyword">in</span> <span class="built_in">enumerate</span>(states):</span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            stp = next_state(st, d)</span><br><span class="line">            i = idx[stp]</span><br><span class="line">            M[i][j] = (M[i][j] + <span class="number">1</span>) % MOD</span><br><span class="line">    <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line"><span class="comment"># Matrix multiply</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mat_mult</span>(<span class="params">A, B</span>):</span><br><span class="line">    p = <span class="built_in">len</span>(A); q = <span class="built_in">len</span>(A[<span class="number">0</span>]); r = <span class="built_in">len</span>(B[<span class="number">0</span>])</span><br><span class="line">    C = [[<span class="number">0</span>]*r <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(p)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">        Ai = A[i]</span><br><span class="line">        Ci = C[i]</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(q):</span><br><span class="line">            aik = Ai[k]</span><br><span class="line">            <span class="keyword">if</span> aik == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">            Bk = B[k]</span><br><span class="line">            mul = aik</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">                Ci[j] = (Ci[j] + mul * Bk[j]) % MOD</span><br><span class="line">    <span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line"><span class="comment"># Matrix-vector multiply</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mat_vec_mult</span>(<span class="params">A, v</span>):</span><br><span class="line">    p = <span class="built_in">len</span>(A); q = <span class="built_in">len</span>(A[<span class="number">0</span>])</span><br><span class="line">    res = [<span class="number">0</span>]*p</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">        s = <span class="number">0</span></span><br><span class="line">        Ai = A[i]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(q):</span><br><span class="line">            s = (s + Ai[j] * v[j]) % MOD</span><br><span class="line">        res[i] = s</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># Matrix exponentiation</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mat_pow</span>(<span class="params">M, e</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">identity</span>(<span class="params">n</span>):</span><br><span class="line">        I = [[<span class="number">0</span>]*n <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            I[i][i] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> I</span><br><span class="line">    result = identity(N)</span><br><span class="line">    base = [row[:] <span class="keyword">for</span> row <span class="keyword">in</span> M]</span><br><span class="line">    <span class="keyword">while</span> e &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> e &amp; <span class="number">1</span>:</span><br><span class="line">            result = mat_mult(base, result)</span><br><span class="line">        base = mat_mult(base, base)</span><br><span class="line">        e &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build M once</span></span><br><span class="line">M = build_M()</span><br><span class="line"></span><br><span class="line"><span class="comment"># initial vector v1 for 1-digit numbers (leading digit cannot be 0): digits 1..9</span></span><br><span class="line">v1 = [<span class="number">0</span>]*N</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">    st = (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)  <span class="comment"># before first digit</span></span><br><span class="line">    stp = next_state(st, d)</span><br><span class="line">    v1[idx[stp]] = (v1[idx[stp]] + <span class="number">1</span>) % MOD</span><br><span class="line"></span><br><span class="line"><span class="comment"># function to compute F(d)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(v1[i] <span class="keyword">for</span> i,st <span class="keyword">in</span> <span class="built_in">enumerate</span>(states) <span class="keyword">if</span> st[<span class="number">3</span>] == <span class="number">0</span>) % MOD</span><br><span class="line">    Mp = mat_pow(M, d-<span class="number">1</span>)</span><br><span class="line">    vd = mat_vec_mult(Mp, v1)</span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, st <span class="keyword">in</span> <span class="built_in">enumerate</span>(states):</span><br><span class="line">        <span class="keyword">if</span> st[<span class="number">3</span>] == <span class="number">0</span>:</span><br><span class="line">            ans = (ans + vd[i]) % MOD</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="comment"># Quick checks</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;F(2) =&quot;</span>, F(<span class="number">2</span>))      <span class="comment"># 30</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;F(6) =&quot;</span>, F(<span class="number">6</span>))      <span class="comment"># 290898</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Final answer</span></span><br><span class="line">d = <span class="number">10</span>**<span class="number">5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;F(10^5) mod 1e9+7 =&quot;</span>, F(d))</span><br></pre></td></tr></table></figure>
<p>如果你想我把完整脚本打包成可下载的 <code>.py</code> 文件，或者解释代码中某一步（例如状态设计、为什么只需记录后三个后缀计数模3和 T0 模3），我可以继续说明。</p>
<h1>fun fact</h1>
<blockquote>
<p>丢给gemini2.5 flash换了三次提示词反复强调,gemini一直输出243维的矩阵.可能是我没用过gemini 2.5 pro???</p>
</blockquote>

        
  </div>
</article>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    Fluorine Wengers
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/friends/">友链</a></li><!--
     --><!--
       --><li><a href="/QSL/">QSL</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
