<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="web密码在哪里呢反弹shell,然后进到里面之后发现&#x2F;root不让访问(没权限),同时没sudo命令.但是api给了一个读文件的程序,这个程序是root的.所以可以让root程序去读取flag. 抢课12345public void CutDown()&#123;    while (Interlocked.Exchange(ref _IsCutting, 1) !&#x3D; 0)&#123;&amp;#125">
<meta property="og:type" content="article">
<meta property="og:title" content="SpiritCTF 2025 Warm wp">
<meta property="og:url" content="https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/index.html">
<meta property="og:site_name" content="Fluorine&#39;s blog">
<meta property="og:description" content="web密码在哪里呢反弹shell,然后进到里面之后发现&#x2F;root不让访问(没权限),同时没sudo命令.但是api给了一个读文件的程序,这个程序是root的.所以可以让root程序去读取flag. 抢课12345public void CutDown()&#123;    while (Interlocked.Exchange(ref _IsCutting, 1) !&#x3D; 0)&#123;&amp;#125">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-09-12T15:21:27.000Z">
<meta property="article:modified_time" content="2026-01-08T07:55:02.394Z">
<meta property="article:author" content="Fluorine Wang">
<meta property="article:tag" content="Reverse">
<meta property="article:tag" content="PWN">
<meta property="article:tag" content="Crypto">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>SpiritCTF 2025 Warm wp</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Fluorine's blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/friends/">友链</a></li><!--
     --><!--
       --><li><a href="/QSL/">QSL</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2024/09/13/20017_buuctf/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2024/09/11/20015_2025_%E7%BD%91%E7%BB%9C%E8%B5%9B/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&text=SpiritCTF 2025 Warm wp"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&is_video=false&description=SpiritCTF 2025 Warm wp"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SpiritCTF 2025 Warm wp&body=Check out this article: https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&name=SpiritCTF 2025 Warm wp&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&t=SpiritCTF 2025 Warm wp"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web"><span class="toc-number">1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%9C%A8%E5%93%AA%E9%87%8C%E5%91%A2"><span class="toc-number">1.1.</span> <span class="toc-text">密码在哪里呢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A2%E8%AF%BE"><span class="toc-number">1.2.</span> <span class="toc-text">抢课</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B1%E5%BE%97%E7%A6%BB%E8%B0%B1%E7%9A%84%E7%AD%BE%E5%90%8D-JWT"><span class="toc-number">1.3.</span> <span class="toc-text">弱得离谱的签名 JWT</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#misc"><span class="toc-number">2.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#stream2"><span class="toc-number">2.1.</span> <span class="toc-text">stream2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#no-more-taowa"><span class="toc-number">2.2.</span> <span class="toc-text">no more taowa</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pcapng"><span class="toc-number">2.3.</span> <span class="toc-text">pcapng</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">3.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%AE%A1%E8%AE%A1"><span class="toc-number">3.1.</span> <span class="toc-text">最终审计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GoodCoding"><span class="toc-number">3.2.</span> <span class="toc-text">GoodCoding</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MediumPyc"><span class="toc-number">3.3.</span> <span class="toc-text">MediumPyc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ex"><span class="toc-number">3.3.1.</span> <span class="toc-text">Ex</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#number-game"><span class="toc-number">3.4.</span> <span class="toc-text">number game</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#d%E9%AB%98%E4%BD%8Dcoppersmith"><span class="toc-number">4.1.</span> <span class="toc-text">d高位coppersmith</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#d%E7%BB%9D%E5%AF%B9%E5%80%BC%E5%BE%88%E5%B0%8F%E7%9A%84coppersmith"><span class="toc-number">4.2.</span> <span class="toc-text">d绝对值很小的coppersmith</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#fun-fact"><span class="toc-number">4.2.0.1.</span> <span class="toc-text">fun fact</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Earthy-OL"><span class="toc-number">4.3.</span> <span class="toc-text">Earthy OL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#f14g-neq-flag"><span class="toc-number">4.4.</span> <span class="toc-text">f14g $\neq$ flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Glichy-RSA"><span class="toc-number">4.5.</span> <span class="toc-text">Glichy RSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extravagant-Cigarette-Battlefield"><span class="toc-number">4.6.</span> <span class="toc-text">Extravagant Cigarette Battlefield</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">5.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#fmtstr"><span class="toc-number">5.1.</span> <span class="toc-text">fmtstr</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flu"><span class="toc-number">6.</span> <span class="toc-text">Flu</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        SpiritCTF 2025 Warm wp
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Fluorine Wang</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-09-12T15:21:27.000Z" class="dt-published" itemprop="datePublished">2024-09-12</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Crypto/" rel="tag">Crypto</a>, <a class="p-category" href="/tags/PWN/" rel="tag">PWN</a>, <a class="p-category" href="/tags/Reverse/" rel="tag">Reverse</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="密码在哪里呢"><a href="#密码在哪里呢" class="headerlink" title="密码在哪里呢"></a>密码在哪里呢</h2><p>反弹shell,然后进到里面之后发现/root不让访问(没权限),同时没sudo命令.<br>但是api给了一个读文件的程序,这个程序是root的.<br>所以可以让root程序去读取flag.</p>
<h2 id="抢课"><a href="#抢课" class="headerlink" title="抢课"></a>抢课</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">CutDown</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (Interlocked.Exchange(ref _IsCutting, <span class="number">1</span>) != <span class="number">0</span>)&#123;&#125;</span><br><span class="line">    _FlagPrice -= (_FlagPrice - _Wallet) / <span class="number">2</span>;</span><br><span class="line">    Interlocked.Exchange(ref _IsCutting, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>竞态条件利用.<br>就是说程序有一个什么什么锁,多线程同时访问就会爆掉…<br>然后就能拿到flag,但是你要再做一个行为才会回显flag,因为没回显被卡了半个月.</p>
<h2 id="弱得离谱的签名-JWT"><a href="#弱得离谱的签名-JWT" class="headerlink" title="弱得离谱的签名 JWT"></a>弱得离谱的签名 JWT</h2><p>JWT密钥爆破.</p>
<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="stream2"><a href="#stream2" class="headerlink" title="stream2"></a>stream2</h2><p>是lfsr文件流…<br>通过文件流能恢复出另一张图片,然后两张图片抑或(可以先转成png然后再抑或)<br>得到第三张图片就是答案(红色和绿色的高位).</p>
<p>一般情况下LFSR隐写的压缩包都叫rar,而且必须用winrar打开,而且能在rar末尾看到隐写的那张图片的名称和dat的类别,Flu看到的的叫<br><code>Service (Quick Open) block</code></p>
<h2 id="no-more-taowa"><a href="#no-more-taowa" class="headerlink" title="no more taowa"></a>no more taowa</h2><p>神人题目…<br><a target="_blank" rel="noopener" href="https://blog.s1um4i.com/2024-DubheCTF/">ref</a></p>
<h2 id="pcapng"><a href="#pcapng" class="headerlink" title="pcapng"></a>pcapng</h2><p>GPT神力,直接把flag给出来了…<br>重点关注python解码rot13和解压缩zlib的代码:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> codecs, base64, zlib</span><br><span class="line"></span><br><span class="line">rot13_text = <span class="string">&quot;&quot;&quot;-----ORTVA PREGVSVPNGR-----</span></span><br><span class="line"><span class="string">rWjSDZfWtQNZaruOCmUIPGdNRlGcB/DtvUtGql/aCM/5qei4IHMhpDv0rVRZ37Oo</span></span><br><span class="line"><span class="string">IaOHMsAVlrEsrNxBvN==</span></span><br><span class="line"><span class="string">-----RAQ PREGVSVPNGR-----&quot;&quot;&quot;</span></span><br><span class="line">decoded = codecs.decode(rot13_text, <span class="string">&#x27;rot_13&#x27;</span>)</span><br><span class="line">b64 = decoded.splitlines()[<span class="number">1</span>]  <span class="comment"># 取中间那行 base64</span></span><br><span class="line">data = base64.b64decode(b64)</span><br><span class="line"><span class="built_in">print</span>(zlib.decompress(data).decode())</span><br></pre></td></tr></table></figure></p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="最终审计"><a href="#最终审计" class="headerlink" title="最终审计"></a>最终审计</h2><p>给定代码函数名称极其混乱,然后还有三个没用过的函数进行混淆.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> box[<span class="number">256</span>] = &#123;            </span><br><span class="line">  <span class="number">101</span>,  <span class="number">27</span>, <span class="number">192</span>,  <span class="number">94</span>,  <span class="number">58</span>,  <span class="number">31</span>,  <span class="number">23</span>, <span class="number">165</span>, <span class="number">105</span>, <span class="number">244</span>,</span><br><span class="line">  <span class="number">153</span>, <span class="number">151</span>,  <span class="number">71</span>, <span class="number">160</span>, <span class="number">194</span>, <span class="number">152</span>,  <span class="number">89</span>,  <span class="number">73</span>,  <span class="number">95</span>, <span class="number">119</span>,</span><br><span class="line">  <span class="number">130</span>,  <span class="number">51</span>, <span class="number">197</span>, <span class="number">186</span>, <span class="number">212</span>,  <span class="number">65</span>,  <span class="number">25</span>, <span class="number">219</span>, <span class="number">148</span>, <span class="number">235</span>,</span><br><span class="line">   <span class="number">86</span>, <span class="number">164</span>, <span class="number">138</span>,   <span class="number">9</span>, <span class="number">143</span>, <span class="number">111</span>, <span class="number">158</span>, <span class="number">171</span>, <span class="number">246</span>,  <span class="number">18</span>,</span><br><span class="line">   <span class="number">55</span>, <span class="number">134</span>, <span class="number">250</span>, <span class="number">245</span>, <span class="number">233</span>, <span class="number">248</span>,   <span class="number">3</span>, <span class="number">222</span>,  <span class="number">90</span>, <span class="number">204</span>,</span><br><span class="line">   <span class="number">45</span>,  <span class="number">39</span>,  <span class="number">96</span>,  <span class="number">54</span>,  <span class="number">10</span>, <span class="number">229</span>, <span class="number">154</span>,  <span class="number">48</span>, <span class="number">181</span>, <span class="number">145</span>,</span><br><span class="line">  <span class="number">166</span>, <span class="number">238</span>, <span class="number">126</span>,  <span class="number">97</span>,  <span class="number">38</span>, <span class="number">109</span>, <span class="number">150</span>,  <span class="number">70</span>, <span class="number">207</span>, <span class="number">216</span>,</span><br><span class="line">  <span class="number">146</span>, <span class="number">170</span>,  <span class="number">92</span>, <span class="number">228</span>,  <span class="number">60</span>, <span class="number">177</span>, <span class="number">247</span>, <span class="number">182</span>, <span class="number">180</span>,  <span class="number">13</span>,</span><br><span class="line">  <span class="number">139</span>,  <span class="number">50</span>,  <span class="number">74</span>,  <span class="number">22</span>, <span class="number">118</span>,  <span class="number">26</span>,  <span class="number">53</span>,  <span class="number">77</span>, <span class="number">185</span>,  <span class="number">61</span>,</span><br><span class="line">  <span class="number">203</span>, <span class="number">230</span>, <span class="number">172</span>, <span class="number">123</span>, <span class="number">218</span>, <span class="number">116</span>,  <span class="number">68</span>, <span class="number">178</span>, <span class="number">135</span>, <span class="number">190</span>,</span><br><span class="line">   <span class="number">43</span>,  <span class="number">37</span>, <span class="number">173</span>,  <span class="number">36</span>, <span class="number">208</span>,  <span class="number">11</span>,  <span class="number">40</span>,  <span class="number">24</span>,  <span class="number">14</span>, <span class="number">240</span>,</span><br><span class="line">   <span class="number">84</span>,   <span class="number">8</span>,  <span class="number">52</span>, <span class="number">239</span>,  <span class="number">83</span>, <span class="number">191</span>, <span class="number">193</span>, <span class="number">196</span>, <span class="number">122</span>, <span class="number">210</span>,</span><br><span class="line">    <span class="number">6</span>, <span class="number">140</span>, <span class="number">254</span>, <span class="number">242</span>,  <span class="number">69</span>, <span class="number">110</span>, <span class="number">132</span>, <span class="number">195</span>,  <span class="number">17</span>, <span class="number">253</span>,</span><br><span class="line">   <span class="number">20</span>, <span class="number">115</span>,  <span class="number">56</span>, <span class="number">124</span>,   <span class="number">1</span>, <span class="number">217</span>, <span class="number">213</span>, <span class="number">241</span>, <span class="number">252</span>, <span class="number">120</span>,</span><br><span class="line">   <span class="number">75</span>, <span class="number">224</span>, <span class="number">108</span>,  <span class="number">30</span>, <span class="number">201</span>,  <span class="number">78</span>,  <span class="number">85</span>, <span class="number">237</span>, <span class="number">211</span>, <span class="number">188</span>,</span><br><span class="line">  <span class="number">255</span>,  <span class="number">33</span>,  <span class="number">44</span>, <span class="number">128</span>, <span class="number">141</span>,  <span class="number">42</span>,  <span class="number">19</span>,  <span class="number">87</span>, <span class="number">167</span>, <span class="number">214</span>,</span><br><span class="line">    <span class="number">2</span>,  <span class="number">93</span>, <span class="number">174</span>, <span class="number">249</span>, <span class="number">121</span>, <span class="number">100</span>, <span class="number">209</span>,  <span class="number">67</span>, <span class="number">161</span>, <span class="number">156</span>,</span><br><span class="line">  <span class="number">162</span>, <span class="number">205</span>,  <span class="number">21</span>, <span class="number">234</span>, <span class="number">176</span>, <span class="number">206</span>,  <span class="number">49</span>, <span class="number">175</span>,  <span class="number">99</span>, <span class="number">103</span>,</span><br><span class="line">  <span class="number">114</span>, <span class="number">163</span>, <span class="number">113</span>,  <span class="number">80</span>,  <span class="number">59</span>, <span class="number">225</span>,  <span class="number">76</span>, <span class="number">183</span>, <span class="number">159</span>, <span class="number">112</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">251</span>, <span class="number">184</span>,  <span class="number">79</span>, <span class="number">149</span>, <span class="number">117</span>,  <span class="number">35</span>, <span class="number">168</span>, <span class="number">236</span>, <span class="number">200</span>,</span><br><span class="line">  <span class="number">133</span>,  <span class="number">88</span>,  <span class="number">63</span>,  <span class="number">29</span>, <span class="number">102</span>, <span class="number">227</span>,  <span class="number">98</span>,  <span class="number">16</span>,   <span class="number">4</span>,   <span class="number">0</span>,</span><br><span class="line">   <span class="number">81</span>, <span class="number">155</span>, <span class="number">198</span>,  <span class="number">34</span>, <span class="number">142</span>, <span class="number">202</span>,  <span class="number">12</span>, <span class="number">131</span>, <span class="number">136</span>, <span class="number">157</span>,</span><br><span class="line">   <span class="number">57</span>, <span class="number">189</span>, <span class="number">107</span>, <span class="number">129</span>, <span class="number">199</span>,  <span class="number">64</span>,  <span class="number">47</span>,  <span class="number">41</span>, <span class="number">179</span>, <span class="number">104</span>,</span><br><span class="line">    <span class="number">7</span>, <span class="number">106</span>,  <span class="number">91</span>, <span class="number">137</span>, <span class="number">215</span>,  <span class="number">72</span>, <span class="number">232</span>, <span class="number">187</span>,  <span class="number">15</span>, <span class="number">231</span>,</span><br><span class="line">  <span class="number">144</span>, <span class="number">147</span>,  <span class="number">28</span>,  <span class="number">66</span>, <span class="number">221</span>, <span class="number">226</span>, <span class="number">127</span>, <span class="number">243</span>,  <span class="number">46</span>,  <span class="number">82</span>,</span><br><span class="line">   <span class="number">62</span>, <span class="number">169</span>, <span class="number">125</span>,  <span class="number">32</span>, <span class="number">220</span>, <span class="number">223</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">uint8_t</span> <span class="title">dic</span><span class="params">(<span class="type">uint8_t</span> a, <span class="type">uint8_t</span> b)</span></span>&#123;</span><br><span class="line">    <span class="type">uint8_t</span> i;</span><br><span class="line">    <span class="type">uint8_t</span> temp;</span><br><span class="line">    <span class="type">uint8_t</span> result[<span class="number">8</span>];</span><br><span class="line">    <span class="type">uint8_t</span> sum = <span class="number">0</span>;</span><br><span class="line">    result[<span class="number">0</span>] = a;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">8</span>; i++)      </span><br><span class="line">    &#123;</span><br><span class="line">        temp = result[i - <span class="number">1</span>];  </span><br><span class="line">        temp = temp &gt;&gt; <span class="number">7</span>;     </span><br><span class="line">        <span class="keyword">if</span> (temp == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            result[i] = result[i - <span class="number">1</span>] &lt;&lt; <span class="number">1</span> ^ <span class="number">0x1b</span>;    </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            result[i] = result[i - <span class="number">1</span>] &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;            </span><br><span class="line">        temp = b &lt;&lt; i &amp; <span class="number">0x80</span>;       </span><br><span class="line">        <span class="keyword">if</span> (temp == <span class="number">0x80</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sum ^= result[<span class="number">7</span> - i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inv</span><span class="params">(<span class="type">uint8_t</span> K[<span class="number">16</span>], <span class="type">uint8_t</span> k[<span class="number">11</span>][<span class="number">16</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint8_t</span> RC[<span class="number">10</span>];</span><br><span class="line">    <span class="type">uint32_t</span> v4[<span class="number">10</span>];</span><br><span class="line">    RC[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">        RC[i] = <span class="built_in">dic</span>(<span class="number">0x02</span>, RC[i - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        k[<span class="number">0</span>][i] = K[i];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">11</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        k[i][<span class="number">0</span>] = k[i - <span class="number">1</span>][<span class="number">0</span>] ^ box[k[i - <span class="number">1</span>][<span class="number">13</span>]] ^ RC[<span class="number">10</span> - i];</span><br><span class="line">        k[i][<span class="number">1</span>] = k[i - <span class="number">1</span>][<span class="number">1</span>] ^ box[k[i - <span class="number">1</span>][<span class="number">14</span>]];</span><br><span class="line">        k[i][<span class="number">2</span>] = k[i - <span class="number">1</span>][<span class="number">2</span>] ^ box[k[i - <span class="number">1</span>][<span class="number">15</span>]];</span><br><span class="line">        k[i][<span class="number">3</span>] = k[i - <span class="number">1</span>][<span class="number">3</span>] ^ box[k[i - <span class="number">1</span>][<span class="number">12</span>]];</span><br><span class="line">        k[i][<span class="number">4</span>] = k[i - <span class="number">1</span>][<span class="number">4</span>] ^ k[i][<span class="number">0</span>];</span><br><span class="line">        k[i][<span class="number">5</span>] = k[i - <span class="number">1</span>][<span class="number">5</span>] ^ k[i][<span class="number">1</span>];</span><br><span class="line">        k[i][<span class="number">6</span>] = k[i - <span class="number">1</span>][<span class="number">6</span>] ^ k[i][<span class="number">2</span>];</span><br><span class="line">        k[i][<span class="number">7</span>] = k[i - <span class="number">1</span>][<span class="number">7</span>] ^ k[i][<span class="number">3</span>];</span><br><span class="line">        k[i][<span class="number">8</span>] = k[i - <span class="number">1</span>][<span class="number">8</span>] ^ k[i][<span class="number">4</span>];</span><br><span class="line">        k[i][<span class="number">9</span>] = k[i - <span class="number">1</span>][<span class="number">9</span>] ^ k[i][<span class="number">5</span>];</span><br><span class="line">        k[i][<span class="number">10</span>] = k[i - <span class="number">1</span>][<span class="number">10</span>] ^ k[i][<span class="number">6</span>];</span><br><span class="line">        k[i][<span class="number">11</span>] = k[i - <span class="number">1</span>][<span class="number">11</span>] ^ k[i][<span class="number">7</span>];</span><br><span class="line">        k[i][<span class="number">12</span>] = k[i - <span class="number">1</span>][<span class="number">12</span>] ^ k[i][<span class="number">8</span>];</span><br><span class="line">        k[i][<span class="number">13</span>] = k[i - <span class="number">1</span>][<span class="number">13</span>] ^ k[i][<span class="number">9</span>];</span><br><span class="line">        k[i][<span class="number">14</span>] = k[i - <span class="number">1</span>][<span class="number">14</span>] ^ k[i][<span class="number">10</span>];</span><br><span class="line">        k[i][<span class="number">15</span>] = k[i - <span class="number">1</span>][<span class="number">15</span>] ^ k[i][<span class="number">11</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">xxor</span><span class="params">(<span class="type">uint8_t</span>* a, <span class="type">uint8_t</span>* IIIlIIIIIllllIIl)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        a[i] ^= IIIlIIIIIllllIIl[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pprj</span><span class="params">(<span class="type">uint8_t</span>* input)</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        input[i] = box[input[i]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">depprj</span><span class="params">(<span class="type">uint8_t</span>* input)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">256</span>;++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(box[j]==input[i])&#123;</span><br><span class="line">                input[i]=j;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rrmm</span><span class="params">(<span class="type">uint8_t</span>* a)</span> </span>&#123;   </span><br><span class="line">    <span class="type">uint8_t</span> b[<span class="number">16</span>];</span><br><span class="line">    b[<span class="number">0</span>] = a[<span class="number">0</span>];    b[<span class="number">4</span>] = a[<span class="number">4</span>];    b[<span class="number">8</span>] = a[<span class="number">8</span>];    b[<span class="number">12</span>] = a[<span class="number">12</span>];</span><br><span class="line">    b[<span class="number">1</span>] = a[<span class="number">5</span>];    b[<span class="number">5</span>] = a[<span class="number">9</span>];    b[<span class="number">9</span>] = a[<span class="number">13</span>];    b[<span class="number">13</span>] = a[<span class="number">1</span>];</span><br><span class="line">    b[<span class="number">2</span>] = a[<span class="number">10</span>];    b[<span class="number">6</span>] = a[<span class="number">14</span>];    b[<span class="number">10</span>] = a[<span class="number">2</span>];    b[<span class="number">14</span>] = a[<span class="number">6</span>];</span><br><span class="line">    b[<span class="number">3</span>] = a[<span class="number">15</span>];    b[<span class="number">7</span>] = a[<span class="number">3</span>];    b[<span class="number">11</span>] = a[<span class="number">7</span>];    b[<span class="number">15</span>] = a[<span class="number">11</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        a[i] = b[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">derrmm</span><span class="params">(<span class="type">uint8_t</span>* a)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint8_t</span> b[<span class="number">16</span>];</span><br><span class="line">    b[<span class="number">0</span>] = a[<span class="number">0</span>];</span><br><span class="line">    b[<span class="number">1</span>] = a[<span class="number">13</span>];</span><br><span class="line">    b[<span class="number">2</span>] = a[<span class="number">10</span>];</span><br><span class="line">    b[<span class="number">3</span>] = a[<span class="number">7</span>];</span><br><span class="line">    b[<span class="number">4</span>] = a[<span class="number">4</span>];</span><br><span class="line">    b[<span class="number">5</span>] = a[<span class="number">1</span>];</span><br><span class="line">    b[<span class="number">6</span>] = a[<span class="number">14</span>];</span><br><span class="line">    b[<span class="number">7</span>] = a[<span class="number">11</span>];</span><br><span class="line">    b[<span class="number">8</span>] = a[<span class="number">8</span>];</span><br><span class="line">    b[<span class="number">9</span>] = a[<span class="number">5</span>];</span><br><span class="line">    b[<span class="number">10</span>] = a[<span class="number">2</span>];</span><br><span class="line">    b[<span class="number">11</span>] = a[<span class="number">15</span>];</span><br><span class="line">    b[<span class="number">12</span>] = a[<span class="number">12</span>];</span><br><span class="line">    b[<span class="number">13</span>] = a[<span class="number">9</span>];</span><br><span class="line">    b[<span class="number">14</span>] = a[<span class="number">6</span>];</span><br><span class="line">    b[<span class="number">15</span>] = a[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        a[i] = b[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dict</span><span class="params">(<span class="type">uint8_t</span>* a)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint8_t</span> b[<span class="number">16</span>];</span><br><span class="line">    b[<span class="number">0</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">0</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">1</span>]) ^ a[<span class="number">2</span>] ^ a[<span class="number">3</span>];</span><br><span class="line">    b[<span class="number">1</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">1</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">2</span>]) ^ a[<span class="number">3</span>] ^ a[<span class="number">0</span>];</span><br><span class="line">    b[<span class="number">2</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">2</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">3</span>]) ^ a[<span class="number">0</span>] ^ a[<span class="number">1</span>];</span><br><span class="line">    b[<span class="number">3</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">3</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">0</span>]) ^ a[<span class="number">1</span>] ^ a[<span class="number">2</span>];</span><br><span class="line">    b[<span class="number">4</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">4</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">5</span>]) ^ a[<span class="number">6</span>] ^ a[<span class="number">7</span>];</span><br><span class="line">    b[<span class="number">5</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">5</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">6</span>]) ^ a[<span class="number">7</span>] ^ a[<span class="number">4</span>];</span><br><span class="line">    b[<span class="number">6</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">6</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">7</span>]) ^ a[<span class="number">4</span>] ^ a[<span class="number">5</span>];</span><br><span class="line">    b[<span class="number">7</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">7</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">4</span>]) ^ a[<span class="number">5</span>] ^ a[<span class="number">6</span>];</span><br><span class="line">    b[<span class="number">8</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">8</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">9</span>]) ^ a[<span class="number">10</span>] ^ a[<span class="number">11</span>];</span><br><span class="line">    b[<span class="number">9</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">9</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">10</span>]) ^ a[<span class="number">11</span>] ^ a[<span class="number">8</span>];</span><br><span class="line">    b[<span class="number">10</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">10</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">11</span>]) ^ a[<span class="number">8</span>] ^ a[<span class="number">9</span>];</span><br><span class="line">    b[<span class="number">11</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">11</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">8</span>]) ^ a[<span class="number">9</span>] ^ a[<span class="number">10</span>];</span><br><span class="line">    b[<span class="number">12</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">12</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">13</span>]) ^ a[<span class="number">14</span>] ^ a[<span class="number">15</span>];</span><br><span class="line">    b[<span class="number">13</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">13</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">14</span>]) ^ a[<span class="number">15</span>] ^ a[<span class="number">12</span>];</span><br><span class="line">    b[<span class="number">14</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">14</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">15</span>]) ^ a[<span class="number">12</span>] ^ a[<span class="number">13</span>];</span><br><span class="line">    b[<span class="number">15</span>] = <span class="built_in">dic</span>(<span class="number">0x02</span>, a[<span class="number">15</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x03</span>, a[<span class="number">12</span>]) ^ a[<span class="number">13</span>] ^ a[<span class="number">14</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        a[i] = b[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dedict</span><span class="params">(<span class="type">uint8_t</span>* a)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint8_t</span> b[<span class="number">16</span>];</span><br><span class="line">    <span class="comment">// 第一组: a[0], a[1], a[2], a[3]</span></span><br><span class="line">    b[<span class="number">0</span>] = <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">0</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">1</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">2</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">3</span>]);</span><br><span class="line">    b[<span class="number">1</span>] = <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">0</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">1</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">2</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">3</span>]);</span><br><span class="line">    b[<span class="number">2</span>] = <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">0</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">1</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">2</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">3</span>]);</span><br><span class="line">    b[<span class="number">3</span>] = <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">0</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">1</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">2</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">3</span>]);</span><br><span class="line">    <span class="comment">// 第二组: a[4], a[5], a[6], a[7]</span></span><br><span class="line">    b[<span class="number">4</span>] = <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">4</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">5</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">6</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">7</span>]);</span><br><span class="line">    b[<span class="number">5</span>] = <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">4</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">5</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">6</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">7</span>]);</span><br><span class="line">    b[<span class="number">6</span>] = <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">4</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">5</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">6</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">7</span>]);</span><br><span class="line">    b[<span class="number">7</span>] = <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">4</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">5</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">6</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">7</span>]);</span><br><span class="line">    <span class="comment">// 第三组: a[8], a[9], a[10], a[11]</span></span><br><span class="line">    b[<span class="number">8</span>] = <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">8</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">9</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">10</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">11</span>]);</span><br><span class="line">    b[<span class="number">9</span>] = <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">8</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">9</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">10</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">11</span>]);</span><br><span class="line">    b[<span class="number">10</span>] = <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">8</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">9</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">10</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">11</span>]);</span><br><span class="line">    b[<span class="number">11</span>] = <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">8</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">9</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">10</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">11</span>]);</span><br><span class="line">    <span class="comment">// 第四组: a[12], a[13], a[14], a[15]</span></span><br><span class="line">    b[<span class="number">12</span>] = <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">12</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">13</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">14</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">15</span>]);</span><br><span class="line">    b[<span class="number">13</span>] = <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">12</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">13</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">14</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">15</span>]);</span><br><span class="line">    b[<span class="number">14</span>] = <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">12</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">13</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">14</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">15</span>]);</span><br><span class="line">    b[<span class="number">15</span>] = <span class="built_in">dic</span>(<span class="number">0x0b</span>, a[<span class="number">12</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0d</span>, a[<span class="number">13</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x09</span>, a[<span class="number">14</span>]) ^ <span class="built_in">dic</span>(<span class="number">0x0e</span>, a[<span class="number">15</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        a[i] = b[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ill</span><span class="params">(<span class="type">uint8_t</span> tmp[<span class="number">16</span>], <span class="type">uint8_t</span> rres[<span class="number">16</span>], <span class="type">uint8_t</span> k[<span class="number">11</span>][<span class="number">16</span>], <span class="type">int</span> Round)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i, round;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        rres[i] = tmp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">xxor</span>(rres, k[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (round = <span class="number">1</span>; round &lt; Round; round++) &#123;</span><br><span class="line">        <span class="built_in">dict</span>(rres);</span><br><span class="line">        <span class="built_in">pprj</span>(rres);</span><br><span class="line">        <span class="built_in">rrmm</span>(rres);</span><br><span class="line">        <span class="built_in">xxor</span>(rres, k[round]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pprj</span>(rres);</span><br><span class="line">    <span class="built_in">rrmm</span>(rres);</span><br><span class="line">    <span class="built_in">xxor</span>(rres, k[Round]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">deill</span><span class="params">(<span class="type">uint8_t</span> tmp[<span class="number">16</span>], <span class="type">uint8_t</span> rres[<span class="number">16</span>], <span class="type">uint8_t</span> k[<span class="number">11</span>][<span class="number">16</span>], <span class="type">int</span> Round)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i, round;</span><br><span class="line">    <span class="comment">// 将输入密文复制到 rres</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        rres[i] = tmp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 反转最后一轮的异或操作</span></span><br><span class="line">    <span class="built_in">xxor</span>(rres, k[Round]);</span><br><span class="line">    <span class="comment">// 反转最后一轮的 rrmm 和 pprj 操作（注意顺序相反）</span></span><br><span class="line">    <span class="built_in">derrrm</span>(rres);</span><br><span class="line">    <span class="built_in">depprj</span>(rres);</span><br><span class="line">    <span class="comment">// 从 Round-1 到 1 轮，逆向处理每一轮</span></span><br><span class="line">    <span class="keyword">for</span> (round = Round<span class="number">-1</span>; round &gt;= <span class="number">1</span>; round--) &#123;</span><br><span class="line">        <span class="built_in">xxor</span>(rres, k[round]);  <span class="comment">// 反转该轮的异或</span></span><br><span class="line">        <span class="built_in">derrrm</span>(rres);          <span class="comment">// 反转 rrmm</span></span><br><span class="line">        <span class="built_in">depprj</span>(rres);          <span class="comment">// 反转 pprj</span></span><br><span class="line">        <span class="built_in">dedict</span>(rres);          <span class="comment">// 反转 dict</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 反转初始异或</span></span><br><span class="line">    <span class="built_in">xxor</span>(rres, k[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint8_t</span> cnt[<span class="number">11</span>][<span class="number">16</span>];   </span><br><span class="line">    <span class="type">uint8_t</span> chk[<span class="number">16</span>] = &#123; <span class="number">218</span>,<span class="number">14</span>,<span class="number">205</span>,<span class="number">50</span>,<span class="number">168</span>,<span class="number">89</span>,<span class="number">88</span>,<span class="number">62</span>,<span class="number">25</span>,<span class="number">222</span>,<span class="number">96</span>,<span class="number">18</span>,<span class="number">18</span>,<span class="number">129</span>,<span class="number">198</span>,<span class="number">36</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> rres[<span class="number">17</span>];  </span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">17</span>];</span><br><span class="line">    <span class="type">uint8_t</span> arr[<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="number">0x5A</span>, <span class="number">0x0D</span>, <span class="number">0x9D</span>, <span class="number">0x04</span>, <span class="number">0x60</span>, <span class="number">0xAE</span>, <span class="number">0x05</span>, <span class="number">0xBB</span>, <span class="number">0x85</span>, <span class="number">0x6B</span>,</span><br><span class="line">        <span class="number">0x13</span>, <span class="number">0xB5</span>, <span class="number">0x73</span>, <span class="number">0xCF</span>, <span class="number">0x3D</span>, <span class="number">0x1E</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> a = <span class="number">0</span>; a &lt; <span class="number">16</span>; a++) &#123;</span><br><span class="line">        tmp[a] = <span class="built_in">getchar</span>();</span><br><span class="line">        rres[a] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    tmp[<span class="number">16</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> a=<span class="number">0</span>;a&lt;<span class="number">11</span>;a++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> b=<span class="number">0</span>;b&lt;<span class="number">16</span>;b++)&#123;</span><br><span class="line">            cnt[a][b] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">inv</span>(arr, cnt);</span><br><span class="line">    <span class="built_in">ill</span>(tmp,rres,cnt,<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (rres[i] != chk[i]) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your flag: flag&#123;%16s&#125;&quot;</span>, tmp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>手动把变量名换成一些稍微熟悉的名字之后,再丢给AI说是自己实现了一个AES加密,S盒自定义的,而且密钥就在main函数里.<br>把AES拆成一段一段的函数丢给ds分别写解密函数即可.(就是上面的结果…)</p>
<h2 id="GoodCoding"><a href="#GoodCoding" class="headerlink" title="GoodCoding"></a>GoodCoding</h2><p>把所有神秘函数综合在一起…<br>那种纯抑或找字符串数据区在哪的没意思,真的.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line">fastio::IN fin;</span><br><span class="line">fastio::OUT fout;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _BYTE char</span></span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_401100</span><span class="params">(_BYTE *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  result = <span class="number">1</span>;</span><br><span class="line">  *a1 = <span class="number">102</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_401120</span><span class="params">(_BYTE * a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  result = <span class="number">1</span>;</span><br><span class="line">  *(a1 + <span class="number">1</span>) = <span class="number">108</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_401140</span><span class="params">(_BYTE * a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> n2; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  n2 = <span class="number">2</span>;</span><br><span class="line">  *(a1 + <span class="number">2</span>) = <span class="number">97</span>;</span><br><span class="line">  <span class="keyword">return</span> n2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_401160</span><span class="params">(_BYTE * a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  result = <span class="number">1</span>;</span><br><span class="line">  *(a1 + <span class="number">3</span>) = <span class="number">103</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_401180</span><span class="params">(_BYTE * a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> n4; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  n4 = <span class="number">4</span>;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">4</span>) = <span class="number">123</span>;</span><br><span class="line">  <span class="keyword">return</span> n4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_4011A0</span><span class="params">(_BYTE * a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  result = <span class="number">1</span>;</span><br><span class="line">  *(a1 + <span class="number">44</span>) = <span class="number">125</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> Buf2_[]=&#123;</span><br><span class="line">    <span class="number">0x00</span>,<span class="number">0x8F</span>,<span class="number">0xDE</span>,<span class="number">0x51</span>,<span class="number">0x16</span>,<span class="number">0x27</span>,<span class="number">0xAD</span>,<span class="number">0x35</span>,</span><br><span class="line">    <span class="number">0xB4</span>,<span class="number">0xE1</span>,<span class="number">0x49</span>,<span class="number">0x6D</span>,<span class="number">0x1A</span>,<span class="number">0x58</span>,<span class="number">0xE5</span>,<span class="number">0xA4</span>,</span><br><span class="line">    <span class="number">0xCF</span>,<span class="number">0x1F</span>,<span class="number">0x56</span>,<span class="number">0xAD</span>,<span class="number">0x5D</span>,<span class="number">0x52</span>,<span class="number">0x32</span>,<span class="number">0xD8</span>,</span><br><span class="line">    <span class="number">0x28</span>,<span class="number">0x15</span>,<span class="number">0x76</span>,<span class="number">0x14</span>,<span class="number">0xF2</span>,<span class="number">0x1C</span>,<span class="number">0xBD</span>,<span class="number">0xA6</span>,</span><br><span class="line">    <span class="number">0x03</span>,<span class="number">0xD4</span>,<span class="number">0x1C</span>,<span class="number">0x40</span>,<span class="number">0x5D</span>,<span class="number">0x1C</span>,<span class="number">0xFB</span>,<span class="number">0xE1</span>,</span><br><span class="line">    <span class="number">0xEB</span>,<span class="number">0x30</span>,<span class="number">0xF5</span>,<span class="number">0x29</span>,<span class="number">0xFE</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Buf2_          db    0                 ; DATA XREF: _main+139↑o</span></span><br><span class="line"><span class="comment">// .data:0040402D                 db  8Fh</span></span><br><span class="line"><span class="comment">// .data:0040402E                 db 0DEh</span></span><br><span class="line"><span class="comment">// .data:0040402F                 db  51h ; Q</span></span><br><span class="line"><span class="comment">// .data:00404030                 db  16h</span></span><br><span class="line"><span class="comment">// .data:00404031                 db  27h ; &#x27;</span></span><br><span class="line"><span class="comment">// .data:00404032                 db 0ADh</span></span><br><span class="line"><span class="comment">// .data:00404033                 db  35h ; 5</span></span><br><span class="line"><span class="comment">// .data:00404034                 db 0B4h</span></span><br><span class="line"><span class="comment">// .data:00404035                 db 0E1h</span></span><br><span class="line"><span class="comment">// .data:00404036                 db  49h ; I</span></span><br><span class="line"><span class="comment">// .data:00404037                 db  6Dh ; m</span></span><br><span class="line"><span class="comment">// .data:00404038                 db  1Ah</span></span><br><span class="line"><span class="comment">// .data:00404039                 db  58h ; X</span></span><br><span class="line"><span class="comment">// .data:0040403A                 db 0E5h</span></span><br><span class="line"><span class="comment">// .data:0040403B                 db 0A4h</span></span><br><span class="line"><span class="comment">// .data:0040403C                 db 0CFh</span></span><br><span class="line"><span class="comment">// .data:0040403D                 db  1Fh</span></span><br><span class="line"><span class="comment">// .data:0040403E                 db  56h ; V</span></span><br><span class="line"><span class="comment">// .data:0040403F                 db 0ADh</span></span><br><span class="line"><span class="comment">// .data:00404040                 db  5Dh ; ]</span></span><br><span class="line"><span class="comment">// .data:00404041                 db  52h ; R</span></span><br><span class="line"><span class="comment">// .data:00404042                 db  32h ; 2</span></span><br><span class="line"><span class="comment">// .data:00404043                 db 0D8h</span></span><br><span class="line"><span class="comment">// .data:00404044                 db  28h ; (</span></span><br><span class="line"><span class="comment">// .data:00404045                 db  15h</span></span><br><span class="line"><span class="comment">// .data:00404046                 db  76h ; v</span></span><br><span class="line"><span class="comment">// .data:00404047                 db  14h</span></span><br><span class="line"><span class="comment">// .data:00404048                 db 0F2h</span></span><br><span class="line"><span class="comment">// .data:00404049                 db  1Ch</span></span><br><span class="line"><span class="comment">// .data:0040404A                 db 0BDh</span></span><br><span class="line"><span class="comment">// .data:0040404B                 db 0A6h</span></span><br><span class="line"><span class="comment">// .data:0040404C                 db    3</span></span><br><span class="line"><span class="comment">// .data:0040404D                 db 0D4h</span></span><br><span class="line"><span class="comment">// .data:0040404E                 db  1Ch</span></span><br><span class="line"><span class="comment">// .data:0040404F                 db  40h ; @</span></span><br><span class="line"><span class="comment">// .data:00404050                 db  5Dh ; ]</span></span><br><span class="line"><span class="comment">// .data:00404051                 db  1Ch</span></span><br><span class="line"><span class="comment">// .data:00404052                 db 0FBh</span></span><br><span class="line"><span class="comment">// .data:00404053                 db 0E1h</span></span><br><span class="line"><span class="comment">// .data:00404054                 db 0EBh</span></span><br><span class="line"><span class="comment">// .data:00404055                 db  30h ; 0</span></span><br><span class="line"><span class="comment">// .data:00404056                 db 0F5h</span></span><br><span class="line"><span class="comment">// .data:00404057                 db  29h ; )</span></span><br><span class="line"><span class="comment">// .data:00404058                 db 0FEh</span></span><br><span class="line"><span class="comment">// .data:00404059                 db    0</span></span><br><span class="line"><span class="comment">// .data:0040405A                 db    0</span></span><br><span class="line"><span class="comment">// .data:0040405B                 db    0</span></span><br><span class="line"><span class="type">char</span> aFppv[]=<span class="string">&quot;`fppv``&quot;</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_4011E0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+0h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i )</span><br><span class="line">    aFppv[i] ^= <span class="number">0x33</span>u;                          <span class="comment">// &quot;`fppv``&quot;</span></span><br><span class="line">  <span class="comment">// &quot;`fppv``&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, aFppv);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title">sub_401670</span><span class="params">(<span class="type">char</span> *Buf1,<span class="type">unsigned</span>  <span class="type">char</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> j_1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+4h] [ebp-23Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> j_2; <span class="comment">// [esp+10h] [ebp-230h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+18h] [ebp-228h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+1Ch] [ebp-224h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> j; <span class="comment">// [esp+20h] [ebp-220h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+24h] [ebp-21Ch]</span></span><br><span class="line">  <span class="type">int</span> n256; <span class="comment">// [esp+30h] [ebp-210h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+34h] [ebp-20Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v11; <span class="comment">// [esp+3Ah] [ebp-206h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v12; <span class="comment">// [esp+3Bh] [ebp-205h]</span></span><br><span class="line">  _BYTE v13[<span class="number">256</span>]; <span class="comment">// [esp+3Ch] [ebp-204h] BYREF</span></span><br><span class="line">  _BYTE v14[<span class="number">256</span>]; <span class="comment">// [esp+13Ch] [ebp-104h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(v14, <span class="number">0</span>, <span class="built_in">sizeof</span>(v14));</span><br><span class="line">  <span class="built_in">memset</span>(v13, <span class="number">0</span>, <span class="built_in">sizeof</span>(v13));</span><br><span class="line">  j_2=<span class="number">0x2D</span>;</span><br><span class="line"><span class="comment">//   j_2 = strlen(a2);</span></span><br><span class="line">  v3 = <span class="built_in">strlen</span>(Buf1);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v14[i] = i;</span><br><span class="line">    v13[i] = Buf1[i % v3];</span><br><span class="line">  &#125;</span><br><span class="line">  n256 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( n256 &lt; <span class="number">256</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = v14[n256];</span><br><span class="line">    v6 = (v6 + v11 + (<span class="type">char</span>)v13[n256]) % <span class="number">256</span>;</span><br><span class="line">    v14[n256] = v14[v6];</span><br><span class="line">    v14[v6] = v11;</span><br><span class="line">    ++n256;</span><br><span class="line">  &#125;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; ; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    j_1 = j;</span><br><span class="line">    <span class="keyword">if</span> ( j &gt;= j_2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v8 = (v8 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v12 = v14[v8];</span><br><span class="line">    v5 = (v5 + v12) % <span class="number">256</span>;</span><br><span class="line">    v14[v8] = v14[v5];</span><br><span class="line">    v14[v5] = v12;</span><br><span class="line">    a2[j] ^= v14[(<span class="type">unsigned</span> __int8)(v14[v8] + v12)];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> j_1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> byte_404020[]=&#123;</span><br><span class="line">    <span class="number">0x01</span>,<span class="number">0x07</span>,<span class="number">0x0C</span>,<span class="number">0x75</span>,<span class="number">0x14</span>,</span><br><span class="line">    <span class="number">0x12</span>,<span class="number">0x14</span>,<span class="number">0x1C</span>,<span class="number">0x1B</span>,<span class="number">0x74</span>,</span><br><span class="line">    <span class="number">0x00</span>,<span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// .data:00404020 ; char byte_404020[12]</span></span><br><span class="line"><span class="comment">// .data:00404020 byte_404020     db 1                    ; DATA XREF: sub_401230+1F↑r</span></span><br><span class="line"><span class="comment">// .data:00404020                                         ; sub_401230+2C↑w ...</span></span><br><span class="line"><span class="comment">// .data:00404021                 db    7</span></span><br><span class="line"><span class="comment">// .data:00404022                 db  0Ch</span></span><br><span class="line"><span class="comment">// .data:00404023                 db  75h ; u</span></span><br><span class="line"><span class="comment">// .data:00404024                 db  14h</span></span><br><span class="line"><span class="comment">// .data:00404025                 db  12h</span></span><br><span class="line"><span class="comment">// .data:00404026                 db  14h</span></span><br><span class="line"><span class="comment">// .data:00404027                 db  1Ch</span></span><br><span class="line"><span class="comment">// .data:00404028                 db  1Bh</span></span><br><span class="line"><span class="comment">// .data:00404029                 db  74h ; t</span></span><br><span class="line"><span class="comment">// .data:0040402A                 db    0</span></span><br><span class="line"><span class="comment">// .data:0040402B                 db    0</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_401230</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+0h] [ebp-4h]</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i )</span><br><span class="line">    byte_404020[i] ^= <span class="number">0x55</span>u;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, byte_404020);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_401450</span><span class="params">(_BYTE * a1)</span></span>&#123;</span><br><span class="line">  <span class="built_in">sub_401100</span>(a1);</span><br><span class="line">  <span class="built_in">sub_401120</span>(a1);</span><br><span class="line">  <span class="built_in">sub_401140</span>(a1);</span><br><span class="line">  <span class="built_in">sub_401160</span>(a1);</span><br><span class="line">  <span class="built_in">sub_401180</span>(a1);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_4011A0</span>(a1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">mian</span><span class="params">(<span class="type">char</span>* Buf1,<span class="type">char</span>* Buf1_1)</span></span>&#123;</span><br><span class="line">  <span class="built_in">sub_401450</span>(Buf1);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">48</span>;++i)&#123;</span><br><span class="line">    Buf1[i]=Buf2_[i];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">sub_401670</span>(Buf1_1, Buf2_);</span><br><span class="line">  <span class="built_in">sub_401450</span>(Buf1);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">46</span>;++i)&#123;</span><br><span class="line">    fout&lt;&lt;(<span class="type">char</span>)Buf2_[i];</span><br><span class="line">  &#125;<span class="function">enter</span></span><br><span class="line"><span class="function">  <span class="title">if</span> <span class="params">( !memcmp(Buf1, &amp;Buf2_, <span class="number">0x2D</span>u) )</span></span>&#123;</span><br><span class="line">    si;</span><br><span class="line">    <span class="built_in">sub_401450</span>(Buf1);</span><br><span class="line">    <span class="built_in">sub_401450</span>(Buf1);</span><br><span class="line">    <span class="built_in">sub_4011E0</span>();<span class="comment">//success</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    si;si;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_401450</span>(Buf1);</span><br><span class="line">  <span class="built_in">sub_401450</span>(Buf1);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> Buf1_1[]=<span class="string">&quot;Simple.Game.of.Reverse,+SO+EASY!&quot;</span>;</span><br><span class="line"><span class="type">char</span> Buf[<span class="number">1000</span>];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> n,m,res;</span><br><span class="line"><span class="comment">//#define NaraFluorine</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">mian</span>(Buf,Buf1_1);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="MediumPyc"><a href="#MediumPyc" class="headerlink" title="MediumPyc"></a>MediumPyc</h2><p>给了一个神秘pyc编译的exe文件.首先使用pyinstxtractor解包:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python pyinstxtractor.py MediumPyc.exe</span><br></pre></td></tr></table></figure><br>然后使用编译好的pycdc(尝试还原源代码)或者pycdas(分析字节码)尝试还原:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pycdc.exe fast.pyc</span><br><span class="line">pycdas.exe fast.pyc</span><br></pre></td></tr></table></figure><br>(这俩不会生成任何文件,输出都是直接打在cmd里面的)</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zrax/pycdc/blob/master/pyc_module.cpp#L206">pyc魔数判定函数</a><br><a target="_blank" rel="noopener" href="https://github.com/zrax/pycdc/blob/master/pyc_module.h">pyc魔数表</a></p>
<p>回到这道题,补全魔数之后发现还是无法反编译,所以我们分析字节码.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">D:\SucksFluorine\download\MediumPyc&gt;pycdc.exe fast.pyc</span><br><span class="line">CreateObject: Got unsupported <span class="built_in">type</span> 0x0</span><br><span class="line">Error loading file fast.pyc: std::bad_cast</span><br><span class="line"></span><br><span class="line">D:\SucksFluorine\download\MediumPyc&gt;pycdas.exe fast.pyc</span><br><span class="line">fast.pyc (Python 3.9)</span><br><span class="line">[Code]</span><br><span class="line">    File Name: fast.py</span><br><span class="line">    Object Name: &lt;module&gt;</span><br><span class="line">    Arg Count: 0</span><br><span class="line">    Pos Only Arg Count: 0</span><br><span class="line">    KW Only Arg Count: 0</span><br><span class="line">    Locals: 0</span><br><span class="line">    Stack Size: 5</span><br><span class="line">    Flags: 0x00000040 (CO_NOFREE)</span><br><span class="line">    [Names]</span><br><span class="line">        <span class="string">&#x27;ans&#x27;</span></span><br><span class="line">        <span class="string">&#x27;enumerate&#x27;</span></span><br><span class="line">        <span class="string">&#x27;i&#x27;</span></span><br><span class="line">        <span class="string">&#x27;v&#x27;</span></span><br><span class="line">        <span class="string">&#x27;print&#x27;</span></span><br><span class="line">        <span class="string">&#x27;join&#x27;</span></span><br><span class="line">    [Var Names]</span><br><span class="line">    [Free Vars]</span><br><span class="line">    [Cell Vars]</span><br><span class="line">    [Constants]</span><br><span class="line">        ...太长了省略</span><br><span class="line">        [Code]</span><br><span class="line">            File Name: fast.py</span><br><span class="line">            Object Name: &lt;genexpr&gt;</span><br><span class="line">            Arg Count: 1</span><br><span class="line">            Pos Only Arg Count: 0</span><br><span class="line">            KW Only Arg Count: 0</span><br><span class="line">            Locals: 2</span><br><span class="line">            Stack Size: 3</span><br><span class="line">            Flags: 0x00000063 (CO_OPTIMIZED | CO_NEWLOCALS | CO_GENERATOR | CO_NOFREE)</span><br><span class="line">            [Names]</span><br><span class="line">                <span class="string">&#x27;chr&#x27;</span></span><br><span class="line">            [Var Names]</span><br><span class="line">                <span class="string">&#x27;.0&#x27;</span></span><br><span class="line">                <span class="string">&#x27;i&#x27;</span></span><br><span class="line">            [Free Vars]</span><br><span class="line">            [Cell Vars]</span><br><span class="line">            [Constants]</span><br><span class="line">                None</span><br><span class="line">            [Disassembly]</span><br><span class="line">                0       LOAD_FAST                       0: .0</span><br><span class="line">                2       FOR_ITER                        14 (to 18)</span><br><span class="line">                4       STORE_FAST                      1: i</span><br><span class="line">                6       LOAD_GLOBAL                     0: chr</span><br><span class="line">                8       LOAD_FAST                       1: i</span><br><span class="line">                10      CALL_FUNCTION                   1</span><br><span class="line">                12      YIELD_VALUE</span><br><span class="line">                14      POP_TOP</span><br><span class="line">                16      JUMP_ABSOLUTE                   2</span><br><span class="line">                18      LOAD_CONST                      0: None</span><br><span class="line">                20      RETURN_VALUE</span><br><span class="line">        <span class="string">&#x27;&lt;genexpr&gt;&#x27;</span></span><br><span class="line">        None</span><br><span class="line">    [Disassembly]</span><br><span class="line">        0       LOAD_CONST                      0: 1</span><br><span class="line">        2       LOAD_CONST                      1: 0</span><br><span class="line">        4       COMPARE_OP                      2 (==)</span><br><span class="line">        6       POP_JUMP_IF_TRUE                12</span><br><span class="line">        8       LOAD_ASSERTION_ERROR</span><br><span class="line">        10      RAISE_VARARGS                   1</span><br><span class="line">        12      BUILD_LIST                      0</span><br><span class="line">        14      LOAD_CONST                      2: (121, 90, 67, 88, 67, 94, 81, 122, 83, 27, 68, 89, 94, 75, 70, 70, 79, 88, 11, 23, 99, 68, 94, 79, 88, 30, 89, 94, 67, 68, 77, 87)</span><br><span class="line">        16      LIST_EXTEND                     1</span><br><span class="line">        18      STORE_NAME                      0: ans</span><br><span class="line">        20      LOAD_NAME                       1: enumerate</span><br><span class="line">        22      LOAD_NAME                       0: ans</span><br><span class="line">        24      CALL_FUNCTION                   1</span><br><span class="line">        26      GET_ITER</span><br><span class="line">        28      FOR_ITER                        20 (to 50)</span><br><span class="line">        30      UNPACK_SEQUENCE                 2</span><br><span class="line">        32      STORE_NAME                      2: i</span><br><span class="line">        34      STORE_NAME                      3: v</span><br><span class="line">        36      LOAD_NAME                       3: v</span><br><span class="line">        38      LOAD_CONST                      3: 42</span><br><span class="line">        40      BINARY_XOR</span><br><span class="line">        42      LOAD_NAME                       0: ans</span><br><span class="line">        44      LOAD_NAME                       2: i</span><br><span class="line">        46      STORE_SUBSCR</span><br><span class="line">        48      JUMP_ABSOLUTE                   28</span><br><span class="line">        50      LOAD_NAME                       4: <span class="built_in">print</span></span><br><span class="line">        52      LOAD_CONST                      4: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        54      LOAD_METHOD                     5: <span class="built_in">join</span></span><br><span class="line">        56      LOAD_CONST                      5: &lt;CODE&gt; &lt;genexpr&gt;</span><br><span class="line">        58      LOAD_CONST                      6: <span class="string">&#x27;&lt;genexpr&gt;&#x27;</span></span><br><span class="line">        60      MAKE_FUNCTION                   0</span><br><span class="line">        62      LOAD_NAME                       0: ans</span><br><span class="line">        64      GET_ITER</span><br><span class="line">        66      CALL_FUNCTION                   1</span><br><span class="line">        68      CALL_METHOD                     1</span><br><span class="line">        70      CALL_FUNCTION                   1</span><br><span class="line">        72      POP_TOP</span><br><span class="line">        74      LOAD_CONST                      7: None</span><br><span class="line">        76      RETURN_VALUE</span><br></pre></td></tr></table></figure><br>发现一串神秘字符串很可疑,打印出来加个偏移发现是集中抑或某个神秘值,flag到手.</p>
<h3 id="Ex"><a href="#Ex" class="headerlink" title="Ex"></a>Ex</h3><p>首先pycdc不是万能的<br>再者pycdc如果想要反编译成python的话,就需要字节码是<a target="_blank" rel="noopener" href="https://github.com/zrax/pycdc/blob/a05ddec0d889efe3a9082790df4e2ed380d6a555/ASTree.cpp#L164">这些</a></p>
<p>如果你不想让你的pyc被pycdc简单的解出来的话,添加这些不支持的opcode,那解到一半的时候就会报错了,比如涉及到控制流转移的处理起来就比较麻烦.</p>
<p>或者说作者还没更新…</p>
<h2 id="number-game"><a href="#number-game" class="headerlink" title="number game"></a>number game</h2><p>答案是这堆质数的乘积.主要讲为什么代码会这么写:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f1</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v1 = (v1 + <span class="number">1</span>) % <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f2</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v2 = (v2 + <span class="number">1</span>) % <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f3</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v3 = (v3 + <span class="number">1</span>) % <span class="number">5</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f4</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v4 = (v4 + <span class="number">1</span>) % <span class="number">7</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f5</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v5 = (v5 + <span class="number">1</span>) % <span class="number">11</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f6</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v6 = (v6 + <span class="number">1</span>) % <span class="number">13</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f7</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v7 = (v7 + <span class="number">1</span>) % <span class="number">17</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f8</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v8 = (v8 + <span class="number">1</span>) % <span class="number">19</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f9</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v9 = (v9 + <span class="number">1</span>) % <span class="number">23</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f10</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v10 = (v10 + <span class="number">1</span>) % <span class="number">29</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f11</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v11 = (v11 + <span class="number">1</span>) % <span class="number">31</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">f12</span><span class="params">()</span></span>&#123;</span><br><span class="line">  v12 = (v12 + <span class="number">1</span>) % <span class="number">37</span>;</span><br><span class="line">  <span class="built_in">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">  funcInd = (funcInd + <span class="number">1</span>) % <span class="number">12</span>;</span><br><span class="line">  funcTable[funcInd]();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">func_hook</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">func_hook</span>(<span class="type">void</span>)::flag )&#123;</span><br><span class="line">    <span class="built_in">free</span>(<span class="built_in">func_hook</span>(<span class="type">void</span>)::flag);</span><br><span class="line">    <span class="built_in">func_hook</span>(<span class="type">void</span>)::flag = <span class="number">0LL</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">func_hook</span>(<span class="type">void</span>)::flag = <span class="built_in">malloc</span>(<span class="number">4uLL</span>);</span><br><span class="line">    <span class="built_in">f_backup</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">starter</span><span class="params">(<span class="type">int</span> start)</span></span>&#123;</span><br><span class="line">  FUNC *funcTable; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  funcInd = start;</span><br><span class="line">  f_backup = funcTable[start];</span><br><span class="line">  funcTable[start] = func_hook;</span><br><span class="line">  funcTable[start]();</span><br><span class="line">  funcTable = funcTable;</span><br><span class="line">  funcTable[start] = f_backup;</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">int</span>)funcTable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>讲讲为什么上面的代码在调用starter的时候不会死循环:<br>上面首先生成了一个函数表,里面包含所有的函数.<br>然后在调用的时候由于functable[start]被修改为f_backup,第二层的循环会被停止.<br>所以上面代码并不会死循环.</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="d高位coppersmith"><a href="#d高位coppersmith" class="headerlink" title="d高位coppersmith"></a>d高位coppersmith</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_full_p</span>(<span class="params">p_high, n,d_high,kbits</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))    </span><br><span class="line">    f = x + p_high</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(kbits + <span class="number">4</span>), beta=<span class="number">0.5</span>,epsilon=<span class="number">0.02</span>)  </span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        x0 = roots[<span class="number">0</span>]</span><br><span class="line">        p = gcd(x0 + p_high, n)</span><br><span class="line">        <span class="keyword">return</span> ZZ(p)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_p_high</span>(<span class="params">d_high, e, n,kbits</span>):</span><br><span class="line">    PR.&lt;X&gt; = PolynomialRing(RealField(<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(k)</span><br><span class="line">        f=e * d_high * X - (k*n*X + k*X + X-k*X**<span class="number">2</span> - k*n)<span class="comment"># 核心公式</span></span><br><span class="line">        results = f.roots()</span><br><span class="line">        <span class="keyword">if</span> results:</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">                p_high = <span class="built_in">int</span>(x[<span class="number">0</span>])</span><br><span class="line">                p = get_full_p(p_high, n,d_high,kbits)</span><br><span class="line">                <span class="keyword">if</span> p <span class="keyword">and</span> p != <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> p</span><br><span class="line">    <span class="keyword">assert</span> <span class="literal">False</span>, <span class="string">&quot;No p found&quot;</span></span><br><span class="line"></span><br><span class="line">n=</span><br><span class="line">e=</span><br><span class="line">dh=</span><br><span class="line">dh&lt;&lt;=<span class="number">496</span></span><br><span class="line">p=find_p_high(dh, e, n,<span class="number">496</span>)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br></pre></td></tr></table></figure>
<h2 id="d绝对值很小的coppersmith"><a href="#d绝对值很小的coppersmith" class="headerlink" title="d绝对值很小的coppersmith"></a>d绝对值很小的coppersmith</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    d = -getRandomNBitInteger(<span class="number">540</span>)</span><br><span class="line">    <span class="keyword">if</span> GCD(d, phi) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">e = <span class="built_in">pow</span>(d, -<span class="number">1</span>, phi)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>加密脚本很短,d很小但是是负数.<br>hint:注意 $e-(ed-1)/phi(n)$ 的尺寸.  </p>
<p>赛时一直被模意义下的负数勾走了全部注意力,一直在想d实际上是一个很大但是和phi有一丢丢差距的d,然后一直在想怎么搞,而不是直接把d当成就是负数带进去.<br>设 $s=p+q$ ,易知</p>
<script type="math/tex; mode=display">φ(n) = (p-1)*(q-1) = n - s + 1</script><script type="math/tex; mode=display">e*d = 1 + k*(n - s + 1)</script><p>因为d不大,所以我们 <strong>模e</strong> 重写这个式子:</p>
<script type="math/tex; mode=display">0 ≡ 1 + k*(n - s + 1) (\mod e)</script><p>d是负数,乘个负号进去:</p>
<script type="math/tex; mode=display">k*(s - n - 1) -1 ≡ 0 (\mod e)</script><p>其中k和s相对e很小.<br>于是有exp(参考):<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(f, Polynomial):</span><br><span class="line">        x, = polygens(f.base_ring(), f.variable_name(), <span class="number">1</span>)</span><br><span class="line">        f = f(x)</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    </span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">        base = N**(m-i) * f**i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(<span class="built_in">pow</span>, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(B.dimensions())</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, QQ(<span class="number">1</span>)/factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B*monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">n = <span class="number">15425573671310522242443233746310042356010853473818779398996082170048567920118903681647987050437827476913593832140428830079145356506759781679910740377921852505076061481509359602427721750479160787169664264051601089514008111429884419691138271831739082569598985466474557813544198040214986436278455435986026770676924475450399939298815488163616243041363787783962074104279847511568615583301057627557564500487351753188613907753680349679738865135580863009439093285204444919006821721593430250207889013892442639687535905431874786143108315990529242269940558109859388267058928250425298772293217740622765655823152565113123923668763</span></span><br><span class="line">e = <span class="number">6327896556094253658091659747817429016856309408223961473436189764962070708842237303975014061823644906347752556361281697369789352104420663408346153770487875230284945025757165322724674918235859941960496109640341557214144096200220842694000276854218573600170424950171069117292606035040028300347830463121907243469437544334463474385688805125872252275430155205268386655868804799918703077669963435094113657930181088370605609979145651653040814955685490046815107715494698297046996041104363384752763054510338109663193238262157980276143877128191648541907859079950162479302046677570441450717578777789735482678087230318134288988821</span></span><br><span class="line">c = <span class="number">5475801009485342952728196694456030407918197307336985418171034018093532133078620703384196948359167250839791850276381898952700516800696564114585589757825210269752869192009824899469495374079950070566028398387345642338708146308408285379972269045531178705443124429741740620536581303639550183992924966455905800211495026220301107141605352717625377246526111322887069149636557059363604462796789995221078881649570057345061701830406867272793448661252769484093736788748691697722275957340631743777620368716400287850649194356828671277924972545427720251564065359140554273211854162576253356785240336290941903470838097920938027634391</span></span><br><span class="line"></span><br><span class="line">P, (kx, sx) = PolynomialRing(Zmod(e), <span class="string">&#x27;k, s&#x27;</span>).objgens()</span><br><span class="line"></span><br><span class="line">f = kx*(n-sx+<span class="number">1</span>) - <span class="number">1</span></span><br><span class="line">roots = small_roots(f, (<span class="number">2</span>**<span class="number">545</span>, <span class="number">2</span>**<span class="number">1025</span>), m=<span class="number">5</span>, d=<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(roots)</span><br><span class="line"></span><br><span class="line">k, s = roots[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">p = ZZ((sqrt(s**<span class="number">2</span> - <span class="number">4</span>*n) + s) / <span class="number">2</span>)</span><br><span class="line">q = ZZ(n // p)</span><br><span class="line"><span class="keyword">assert</span> p * q == n <span class="keyword">and</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> q &gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n)))</span><br></pre></td></tr></table></figure></p>
<h4 id="fun-fact"><a href="#fun-fact" class="headerlink" title="fun fact"></a>fun fact</h4><p>不知道为什么最后求p和q非常慢,sage特性吗,还是/2触发sage的float了?</p>
<h2 id="Earthy-OL"><a href="#Earthy-OL" class="headerlink" title="Earthy OL"></a>Earthy OL</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> hashlib, secrets</span><br><span class="line"></span><br><span class="line">n = <span class="number">10</span></span><br><span class="line">N = getPrime(<span class="number">1024</span>)</span><br><span class="line">a_s = [secrets.randbits(<span class="number">960</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">e_s = [secrets.randbits(<span class="number">750</span>)*(secrets.randbits(<span class="number">1</span>)*<span class="number">2</span> - <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">b_s = [a*N + e <span class="keyword">for</span> a, e <span class="keyword">in</span> <span class="built_in">zip</span>(a_s, e_s)]</span><br><span class="line">ct = AES.new(hashlib.sha256(<span class="built_in">str</span>(a_s).encode() + <span class="built_in">str</span>(e_s).encode() + <span class="built_in">str</span>(N).encode()).digest(), AES.MODE_ECB).encrypt(pad(flag, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;b_s = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>问管理员说,所谓的secret库实际上是同文件夹下的secret.py,里面往往只有一句 <code>flag=b&#39;xxx&#39;</code> ,实际上根本不神秘.<br>这个程序实现了一个加密系统,并放出了论文给出了几种格构造的攻击方式.  </p>
<p>Flu这里选取第二种格:即</p>
<script type="math/tex; mode=display">\begin{pmatrix}
a_1&2^{\rho}\\
a_2&&2^{\rho}\\
\vdots&&&\ddots\\
a_n&&&&2^{\rho}
\end{pmatrix}</script><p>然后用lll求出来的是这个向量:</p>
<script type="math/tex; mode=display">\left(\sum_{i=1}^nu_ia_i,u_12^\rho,...,u_n2^\rho\right)</script><p>我们只期望得到u,所以lll得到的u第一列可以删掉.脚本:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">b_s = [ ... ]</span><br><span class="line">alpha=<span class="number">2</span>**<span class="number">750</span></span><br><span class="line">mat=Matrix(ZZ,<span class="number">10</span>,<span class="number">11</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    mat[i,<span class="number">0</span>]=b_s[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    mat[i,i+<span class="number">1</span>]=alpha</span><br><span class="line">M=mat.LLL()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> M:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><br><strong>记得求出来的分量都除一个 $2^\rho$ 才是本来的u!</strong><br>然后我们尝试恢复q:已知所有的u都和q垂直,只有最后一个分量乘q的值是 $±1$ ,这意味着</p>
<script type="math/tex; mode=display">U(q_1,...,q_n)^T=(0,...,0,\pm 1)^T</script><p>所以</p>
<script type="math/tex; mode=display">(q_1,...,q_n)^T=U^{-1}(0,...,0,\pm 1)^T</script><p>至此,我们成功恢复了q👏!脚本:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">M=Matrix(ZZ,[ ... ])</span><br><span class="line">res=M.inverse()</span><br><span class="line">b=Matrix(ZZ,[[<span class="number">0</span>],[<span class="number">0</span>],[<span class="number">0</span>],[<span class="number">0</span>],[<span class="number">0</span>],[<span class="number">0</span>],[<span class="number">0</span>],[<span class="number">0</span>],[<span class="number">0</span>],[-<span class="number">1</span>]])</span><br><span class="line">rres=res*b</span><br><span class="line"><span class="built_in">print</span>(rres)</span><br></pre></td></tr></table></figure><br>然后我们尝试恢复大质数N:应用论文中GACD或者PACD的方法,Flu让AI写的脚本…<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">b_s = [...]</span><br><span class="line">a_s = [...]</span><br><span class="line"><span class="comment"># 选择两个样本</span></span><br><span class="line">i, j = <span class="number">0</span>, <span class="number">1</span>  <span class="comment"># 可以尝试多组</span></span><br><span class="line"></span><br><span class="line">num = b_s[i] - b_s[j]</span><br><span class="line">den = a_s[i] - a_s[j]</span><br><span class="line">N_candidate = <span class="built_in">abs</span>(num) // <span class="built_in">abs</span>(den)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b_s)):</span><br><span class="line">    e_candidate = b_s[k] - a_s[k] * N_candidate</span><br><span class="line">    <span class="keyword">if</span> e_candidate.bit_length() &gt; <span class="number">800</span>:  <span class="comment"># 如果误差太大，说明不对</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;样本 <span class="subst">&#123;k&#125;</span> 验证失败，误差位数: <span class="subst">&#123;e_candidate.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;成功恢复 N:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(N_candidate)</span><br></pre></td></tr></table></figure><br>然后成功恢复N,本题结束.</p>
<h2 id="f14g-neq-flag"><a href="#f14g-neq-flag" class="headerlink" title="f14g $\neq$ flag"></a>f14g $\neq$ flag</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, secret</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;Spirit&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) &lt;= <span class="number">128</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">233333</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">isinstance</span>(secret, <span class="built_in">list</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(<span class="built_in">set</span>(secret)) == N</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">min</span>(secret) == <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">max</span>(secret) == N - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FeatherStitching</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, stitching</span>):</span><br><span class="line">        self.stitching = <span class="built_in">list</span>(stitching)</span><br><span class="line">        self.unstitching = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        new = FeatherStitching([other.stitching[s] <span class="keyword">for</span> s <span class="keyword">in</span> self.stitching])</span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, n</span>):</span><br><span class="line">        new = UNIT</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>: <span class="keyword">return</span> UNIT</span><br><span class="line">        <span class="keyword">if</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            double = self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            double = self.inverse()</span><br><span class="line">            n = -n</span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n &amp; <span class="number">1</span>:</span><br><span class="line">                new *= double</span><br><span class="line">            double *= double</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> self.stitching == other.stitching</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;FeatherStitching(%s)&#x27;</span> % <span class="built_in">repr</span>(self.stitching)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;FeatherStitching(%s)&#x27;</span> % <span class="built_in">str</span>(self.stitching)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.__class__, (self.stitching,))</span><br><span class="line"></span><br><span class="line">UNIT = FeatherStitching(<span class="built_in">range</span>(N))</span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> m, l: m + <span class="built_in">bytes</span>(random.randrange(<span class="number">256</span>)*<span class="built_in">bool</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l - <span class="built_in">len</span>(m)))</span><br><span class="line">unpad = <span class="keyword">lambda</span> m: m[:m.index(<span class="number">0</span>)] <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">in</span> m <span class="keyword">else</span> m</span><br><span class="line">flag = pad(flag, <span class="number">128</span>)</span><br><span class="line"></span><br><span class="line">fs = FeatherStitching(secret)</span><br><span class="line">gift = fs**<span class="number">1337133713371337133713371337713371337133713371337133702</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;gift.pickle&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    pickle.dump(gift, f)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stitch</span>(<span class="params">msg, stitching</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(msg) == <span class="number">128</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(msg, hashlib.sha512(<span class="string">&#x27; :p &#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, stitching.stitching)).encode()).digest() + hashlib.sha512(<span class="string">&#x27; XD &#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, stitching.stitching)).encode()).digest()))</span><br><span class="line"></span><br><span class="line">ct = stitch(flag, fs)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;ct.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>大意:给了一个置换类,范围 $[0,n)$ ,假设为 $\sigma$ ,现在给定大数 $p$ ,给你 $\sigma^p$ ,你要完整还原原来的 $\sigma$ .</p>
<p>几个性质:</p>
<ol>
<li>原来的排列可以用找出来的一堆子环表示.</li>
<li>环的size和p不互质的时候会断子环,这个时候会出现几个size相同的子环,考虑将这样的环O(n)合并:交错枚举,假设有两个环分别是[1,2,3,4]和[5,6,7,8],我们考虑枚举[1,5,2,6,3,7,4,8],[1,6,2,7,3,8,4,5]…</li>
<li>环的size和p互质的时候可以快速求出原来的排列,你知道了 $\sigma^p$ ,那么有 $\alpha^p\mod size$ ,直接对置换求逆元即可.</li>
<li>对于剩下拼起来的环,因为他们是被拼起来的,所以对size除掉公因子的部分求逆元,比如p含有2,两个4拼起来的环就是 <code>invert(p//2,4)</code> 乘上这个逆元即可.</li>
</ol>
<p>回归正题,我们先找环,发现数据由以下构成:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[117899, 66053, 48605, 687, 34, 34, 4, 4, 3, 3, 3, 3, 1]</span><br></pre></td></tr></table></figure><br>所以前面的求逆元,后面的34因为有两个,考虑合并.又因为34是2的倍数,所以他们呢不可能单独成环.<br>因为加密的时候因为环大小不互质,信息会丢失,所以逆推回去会有很多个解,我们只能在解密的时候检查这些解对不对.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FeatherStitching</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,stitching</span>):</span><br><span class="line">        self.stitching=<span class="built_in">list</span>(stitching)</span><br><span class="line">        self.unstitching=<span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self,other</span>):</span><br><span class="line">        new=FeatherStitching([other.stitching[s] <span class="keyword">for</span> s <span class="keyword">in</span> self.stitching])</span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self,n</span>):</span><br><span class="line">        new=UNIT</span><br><span class="line">        <span class="keyword">if</span> n==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> UNIT</span><br><span class="line">        <span class="keyword">if</span> n&gt;<span class="number">0</span>:</span><br><span class="line">            double=self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            double=self.inverse()</span><br><span class="line">            n=-n</span><br><span class="line">        <span class="keyword">while</span> n&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n&amp;<span class="number">1</span>:</span><br><span class="line">                new*=double</span><br><span class="line">            double*=double</span><br><span class="line">            n&gt;&gt;=<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self,other</span>):</span><br><span class="line">        <span class="keyword">return</span> self.stitching==other.stitching</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;FeatherStitching(%s)&#x27;</span>%<span class="built_in">repr</span>(self.stitching)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;FeatherStitching(%s)&#x27;</span>%<span class="built_in">str</span>(self.stitching)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.__class__,(self.stitching,))</span><br><span class="line">p=<span class="number">1337133713371337133713371337713371337133713371337133702</span></span><br><span class="line">N=<span class="number">233333</span></span><br><span class="line">UNIT=FeatherStitching(<span class="built_in">range</span>(N))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;gift.pickle&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    gift=pickle.load(f)</span><br><span class="line"></span><br><span class="line">cyc=[]</span><br><span class="line">vis=[<span class="number">0</span>]*N</span><br><span class="line">res=[<span class="number">0</span>]*N</span><br><span class="line"></span><br><span class="line">r34=[]</span><br><span class="line">r4=[]</span><br><span class="line">r3=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">iinv</span>(<span class="params">st,top,inv</span>):</span><br><span class="line">    <span class="keyword">global</span> UNIT</span><br><span class="line">    UNIT=FeatherStitching(<span class="built_in">range</span>(top))</span><br><span class="line">    <span class="comment"># inv=int(invert(p,top))</span></span><br><span class="line">    dic=&#123;&#125;</span><br><span class="line">    rres=[]</span><br><span class="line">    ttop=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> st:</span><br><span class="line">        dic[ttop]=j</span><br><span class="line">        ttop+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,top):</span><br><span class="line">        rres.append(j)</span><br><span class="line">    rres.append(<span class="number">0</span>)</span><br><span class="line">    rres=FeatherStitching(rres)**inv</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(top):</span><br><span class="line">        res[st[j]]=dic[rres.stitching[j]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    st=[]</span><br><span class="line">    tmp=i</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> vis[tmp]==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        vis[tmp]=<span class="number">1</span></span><br><span class="line">        st.append(tmp)</span><br><span class="line">        tmp=gift.stitching[tmp]</span><br><span class="line">    top=<span class="built_in">len</span>(st)</span><br><span class="line">    <span class="keyword">if</span> top!=<span class="number">0</span>:</span><br><span class="line">        cyc.append(top)</span><br><span class="line">        <span class="keyword">if</span> top==<span class="number">34</span>:</span><br><span class="line">            r34.append(st)</span><br><span class="line">        <span class="keyword">elif</span> top==<span class="number">4</span>:</span><br><span class="line">            r4.append(st)</span><br><span class="line">        <span class="keyword">elif</span> top==<span class="number">3</span>:</span><br><span class="line">            r3.append(st)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            iinv(st,top,invert(p,top))</span><br><span class="line"></span><br><span class="line">cyc.sort()</span><br><span class="line">cyc.reverse()</span><br><span class="line"><span class="built_in">print</span>(cyc)</span><br><span class="line"></span><br><span class="line">ct = <span class="string">b&#x27;\xe8\xd4l6\x08\x17\xd9\x01\xbe,&gt;\x00\xd9\x82g`\x12\x8a\xc3\xdc~\x06tF\x8fn\xe8\x8f7\x81\xe1\xe8\x96S^\xe7\xcd\x95\xe7hH\xdc\x9aN&lt;\xc5\xd5\xcbt&quot;\x17\xe5\x9ft\x92|g\xd8\xe6\xcfI\xcf\xd5P%\xa1\xff\x15\t5\xb3mL\xe7\xa0\x0fC\xc4m\x11\xd9\x9e\x0c\xe3\xf0+\xb8;U\xc8\x1d\xad\xdb\xc0&lt;%\xe4\xabq\xc5\x12t\xe7\xe6nU\xf8\x86\\\xf8\xb0\x8cg\x14\xb2)%\x9a\xd7p\x87\&#x27;\xf6\xa1\xeeG\xba\xb7&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stitch</span>(<span class="params">msg, stitching</span>):</span><br><span class="line">    <span class="comment"># assert len(msg) == 128</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(msg, hashlib.sha512(<span class="string">&#x27; :p &#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, stitching)).encode()).digest() + hashlib.sha512(<span class="string">&#x27; XD &#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, stitching)).encode()).digest()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chk</span>():</span><br><span class="line">    cct=stitch(ct,res)</span><br><span class="line">    <span class="keyword">if</span> cct.startswith(<span class="string">b&#x27;Spirit&#123;&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(cct)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chk33</span>(<span class="params">ar1,ar2</span>):</span><br><span class="line">    jio=[<span class="number">0</span>]*<span class="number">6</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        jio[<span class="number">2</span>*i]=ar1[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            jio[(<span class="number">2</span>*i+<span class="number">1</span>+<span class="number">2</span>*j)%<span class="number">6</span>]=ar2[j]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">            res[jio[j]]=jio[(j+<span class="number">1</span>)%<span class="number">6</span>]</span><br><span class="line">        chk()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chk3</span>(<span class="params">ar1,ar2,ar3,ar4</span>):</span><br><span class="line">    jio=[<span class="number">0</span>]*<span class="number">6</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        jio[<span class="number">2</span>*i]=ar1[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            jio[(<span class="number">2</span>*i+<span class="number">1</span>+<span class="number">2</span>*j)%<span class="number">6</span>]=ar2[j]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">            res[jio[j]]=jio[(j+<span class="number">1</span>)%<span class="number">6</span>]</span><br><span class="line">        chk33(ar3,ar4)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chk3ii</span>(<span class="params">ar1,ar2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        res[ar1[i]]=ar1[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        res[ar2[i]]=ar2[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line">    chk()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chk3i</span>(<span class="params">ar1,ar2,ar3,ar4</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        res[ar1[i]]=ar1[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line">        res[ar2[i]]=ar2[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line">    chk33(ar3,ar4)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chk3iii</span>(<span class="params">ar1,ar2,ar3,ar4</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        res[ar1[i]]=ar1[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line">        res[ar2[i]]=ar2[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line">        res[ar3[i]]=ar3[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line">        res[ar4[i]]=ar4[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line">    chk33(ar3,ar4)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chk4</span>(<span class="params">ar1,ar2</span>):</span><br><span class="line">    jio=[<span class="number">0</span>]*<span class="number">8</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        jio[<span class="number">2</span>*i]=ar1[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;  &#x27;</span>,i,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            jio[(<span class="number">2</span>*i+<span class="number">1</span>+<span class="number">2</span>*j)%<span class="number">8</span>]=ar2[j]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            res[jio[j]]=jio[(j+<span class="number">1</span>)%<span class="number">8</span>]</span><br><span class="line">        iinv(jio,<span class="number">8</span>,<span class="number">3</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        chk3(r3[<span class="number">0</span>],r3[<span class="number">1</span>],r3[<span class="number">2</span>],r3[<span class="number">3</span>])</span><br><span class="line">        chk3(r3[<span class="number">0</span>],r3[<span class="number">2</span>],r3[<span class="number">1</span>],r3[<span class="number">3</span>])</span><br><span class="line">        chk3(r3[<span class="number">0</span>],r3[<span class="number">3</span>],r3[<span class="number">1</span>],r3[<span class="number">2</span>])</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;?&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        chk3i(r3[<span class="number">2</span>],r3[<span class="number">3</span>],r3[<span class="number">0</span>],r3[<span class="number">1</span>])</span><br><span class="line">        chk3i(r3[<span class="number">1</span>],r3[<span class="number">3</span>],r3[<span class="number">0</span>],r3[<span class="number">2</span>])</span><br><span class="line">        chk3i(r3[<span class="number">1</span>],r3[<span class="number">2</span>],r3[<span class="number">0</span>],r3[<span class="number">3</span>])</span><br><span class="line">        chk3i(r3[<span class="number">0</span>],r3[<span class="number">3</span>],r3[<span class="number">1</span>],r3[<span class="number">2</span>])</span><br><span class="line">        chk3i(r3[<span class="number">0</span>],r3[<span class="number">2</span>],r3[<span class="number">1</span>],r3[<span class="number">3</span>])</span><br><span class="line">        chk3i(r3[<span class="number">0</span>],r3[<span class="number">1</span>],r3[<span class="number">2</span>],r3[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chk34</span>(<span class="params">ar1,ar2</span>):</span><br><span class="line">    jio=[<span class="number">0</span>]*<span class="number">68</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">34</span>):</span><br><span class="line">        jio[<span class="number">2</span>*i]=ar1[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">34</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;!&#x27;</span>,i,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">34</span>):</span><br><span class="line">            jio[(<span class="number">2</span>*i+<span class="number">1</span>+<span class="number">2</span>*j)%<span class="number">68</span>]=ar2[j]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">68</span>):</span><br><span class="line">            res[jio[j]]=jio[(j+<span class="number">1</span>)%<span class="number">68</span>]</span><br><span class="line">        iinv(jio,<span class="number">68</span>,<span class="number">9</span>)</span><br><span class="line">        chk4(r4[<span class="number">0</span>],r4[<span class="number">1</span>])</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">chk34(r34[<span class="number">0</span>],r34[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>经过询问,发现pickle是一个反序列化的神秘代码库,有可能被利用一些神秘的漏洞…</p>
<h2 id="Glichy-RSA"><a href="#Glichy-RSA" class="headerlink" title="Glichy RSA"></a>Glichy RSA</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;Spirit&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> m, l: m + <span class="built_in">bytes</span>(randrange(<span class="number">256</span>)*<span class="built_in">bool</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l - <span class="built_in">len</span>(m)))</span><br><span class="line">unpad = <span class="keyword">lambda</span> m: m[:m.index(<span class="number">0</span>)] <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">in</span> m <span class="keyword">else</span> m</span><br><span class="line"></span><br><span class="line">p = <span class="number">374919257834708853127105653533131423526470493321071779252930174908643079553320681210179134804655002009583675610709928359950994682395685971940672950131558136671499</span></span><br><span class="line">q = <span class="number">226263738668232288370072345054926113916031632256528317809359892398377213222472523060400295354898022094562015743037585126619302198113372432010737704133680070000127</span></span><br><span class="line">e = <span class="number">18420051203452939</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> p.bit_length() == q.bit_length() == <span class="number">537</span></span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(pad(flag, <span class="number">133</span>))</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>首先能发现p-1和e不互质,也就意味着m在p-1的群里面会丢失信息.<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6750311=105*65537</span><br></pre></td></tr></table></figure><br>这样就有两个解法:</p>
<script type="math/tex; mode=display">\Huge 1</script><p>原理: $e/\gcd(p-1,e)\times d1 \equiv 1\mod ((p-1)/\gcd(p-1,e))$<br>所以用d1去解,能得到 $m^{\gcd(p-1,e)}\mod p$ ,然后再有限域开根号.</p>
<p>第一种解法是直接开根号,脚本长这样:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">e1=e//GCD(p-<span class="number">1</span>,e)</span><br><span class="line">d1 =inverse(e1,p-<span class="number">1</span>)</span><br><span class="line">m1 =<span class="built_in">pow</span>(c,d1,P)</span><br><span class="line">mp =GF(p)(m1).nth_root(GCD(p-<span class="number">1</span>,e),<span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">d2=inverse(e//GCD(q-<span class="number">1</span>,e),q-<span class="number">1</span>)</span><br><span class="line">m2 =<span class="built_in">pow</span>(c,d2,q)</span><br><span class="line">mq = GF(q)(m2).nth_root(GCD(q-<span class="number">1</span>,e),<span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(mp),<span class="built_in">len</span>(mq))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> mp:</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> mq:</span><br><span class="line">        X = ZZ(x)</span><br><span class="line">        y = ZZ(y)</span><br><span class="line">        m = crt([x,y],[p,q])</span><br><span class="line">        <span class="keyword">if</span>(long_to_bytes(m).startswith(<span class="string">b&#x27;Spirit&#123;&#x27;</span>)):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure><br>算了很久才算出来.</p>
<script type="math/tex; mode=display">\Huge 2</script><p>是出题人的解法.</p>
<p>首先RSA的明密文空间是</p>
<script type="math/tex; mode=display">(\mathbb Z/N\mathbb Z)^*</script><p>也就是所有0~N之间和N互质的数。然后因为N=pq,所以</p>
<script type="math/tex; mode=display">(\mathbb Z/N\mathbb Z)^*\cong(\mathbb Z/p\mathbb Z)^*\times(\mathbb Z/q\mathbb Z)^*</script><p>然后公钥指数e和 <script type="math/tex">\#(\mathbb Z/q\mathbb Z)^*=q-1</script> 是互质的,所以密文在 <script type="math/tex">(\mathbb Z/q\mathbb Z)^*</script> 中的那部分可以逆回去，也就是说可以找到 <script type="math/tex">d_q</script> 使得 <script type="math/tex">e*d_q\equiv1\mod(q-1)</script> ,模q的部分很简单。</p>
<p>但是 $p-1$ 和 $e$ 有一个公因子，我记得是 $103$ 乘上 $65537^2$ ,</p>
<script type="math/tex; mode=display">(\mathbb Z/p\mathbb Z)^*\cong\mathbb Z/(p-1)\mathbb Z\cong\mathbb Z/103\mathbb Z\times\mathbb Z/65537^2\mathbb Z\times\mathbb{Z}\left.\middle/\frac{p-1}{103\times 65537^2}\right.\mathbb{Z}</script><p>不存在 $d_p$ 使得 $e*d_p=1(\mod (p-1))$ 。</p>
<p>所以这个时候就得穷举这两个子群中的元素, $103×65537$ 次.<br>不是 $103×65537^2$ 是因为公钥指数里面有一个 $65537$ .所以 $\mathbb Z/65537^2\mathbb Z$ 中对应 $65537*k,k-0,…,65536$</p>
<p>Z/(p-1)Z中每个元素都可以映射到一个三元组(g1, g2, g3)$g1\in Z/103Z$ ,以此类推<br>然后如果对这个Z/(p-1)Z的元素乘上103(对应 <script type="math/tex">(Z/pZ)^*</script> 里的103次乘方) ,那这个映射的像就变成 <script type="math/tex">(g1*103,g2*103, g3*103)</script><br>因为 $g1\in Z/103Z$ ,所以就相当于 <script type="math/tex">(0, g2*103, g3*103)</script><br>算103分别模 <script type="math/tex">65537^2</script> 和 <script type="math/tex">(p-1)/(103*65537^2)</script> 的逆,就可以从 <script type="math/tex">(0,g2*103,g3*103)</script> 恢复出(0,g2,g3)<br>但是g1求不了,g1的信息永远地丢失了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> rich.progress <span class="keyword">import</span> track</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span>(<span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>).read())</span><br><span class="line"></span><br><span class="line">p = <span class="number">374919257834708853127105653533131423526470493321071779252930174908643079553320681210179134804655002009583675610709928359950994682395685971940672950131558136671499</span></span><br><span class="line">q = <span class="number">226263738668232288370072345054926113916031632256528317809359892398377213222472523060400295354898022094562015743037585126619302198113372432010737704133680070000127</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">103</span></span><br><span class="line">b = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> e == a * b * <span class="number">2728770749</span></span><br><span class="line"><span class="keyword">assert</span> (p-<span class="number">1</span>) % a == <span class="number">0</span> <span class="keyword">and</span> (p-<span class="number">1</span>) % b**<span class="number">2</span> == <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> GCD(q-<span class="number">1</span>, e) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    g = randrange(p)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(g, (p-<span class="number">1</span>)//a, p) != <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">pow</span>(g, (p-<span class="number">1</span>)//b, p) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">cp = c % p</span><br><span class="line">cq = c % q</span><br><span class="line">mq = <span class="built_in">pow</span>(cq, <span class="built_in">pow</span>(e, -<span class="number">1</span>, q-<span class="number">1</span>), q)</span><br><span class="line">ag = <span class="built_in">pow</span>(g, (p-<span class="number">1</span>)//a, p)</span><br><span class="line">bg = <span class="built_in">pow</span>(g, (p-<span class="number">1</span>)//b**<span class="number">2</span>, p)</span><br><span class="line">mpb = <span class="built_in">pow</span>(cp, <span class="built_in">pow</span>(e//b, -<span class="number">1</span>, b**<span class="number">2</span>), p)</span><br><span class="line">k = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p-<span class="number">1</span>)//a//b**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dlog <span class="keyword">in</span> <span class="built_in">range</span>(b):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(<span class="built_in">pow</span>(bg, dlog*b, p) * <span class="built_in">pow</span>(mpb, -<span class="number">1</span>, p), (p-<span class="number">1</span>)//b**<span class="number">2</span>, p) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> da <span class="keyword">in</span> <span class="built_in">range</span>(a):</span><br><span class="line">    <span class="built_in">print</span>(da)</span><br><span class="line">    ma = <span class="built_in">pow</span>(ag, da, p) * <span class="built_in">pow</span>(cp, k, p) % p</span><br><span class="line">    <span class="keyword">for</span> db <span class="keyword">in</span> track(<span class="built_in">range</span>(b)):</span><br><span class="line">        mp = ma * <span class="built_in">pow</span>(bg, db*b + dlog, p) % p</span><br><span class="line">        mm = crt([mp, mq], [p, q])</span><br><span class="line">        <span class="keyword">if</span> long_to_bytes(mm).startswith(<span class="string">b&#x27;Spirit&#123;&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(mm))</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br></pre></td></tr></table></figure>
<h2 id="Extravagant-Cigarette-Battlefield"><a href="#Extravagant-Cigarette-Battlefield" class="headerlink" title="Extravagant Cigarette Battlefield"></a>Extravagant Cigarette Battlefield</h2><p>encrypt.py<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pip install opencv-python</span></span><br><span class="line"><span class="string">pip install numpy</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> Cipher, Mode</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">flag = cv2.imread(<span class="string">&#x27;flag.png&#x27;</span>, cv2.IMREAD_COLOR)</span><br><span class="line">flag = cv2.cvtColor(flag, cv2.COLOR_BGR2RGB)</span><br><span class="line"></span><br><span class="line">height, width, channels = flag.shape</span><br><span class="line"><span class="keyword">assert</span> height % <span class="number">4</span> == <span class="number">0</span> <span class="keyword">and</span> width % <span class="number">4</span> == <span class="number">0</span> <span class="keyword">and</span> channels == <span class="number">3</span></span><br><span class="line"></span><br><span class="line">enc = np.zeros((height, width, channels), dtype=np.uint8)</span><br><span class="line"></span><br><span class="line">cipher = Cipher(random.randbytes(<span class="number">16</span>), Mode.CBC, iv = random.randbytes(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(channels):</span><br><span class="line">    message = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, height, <span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, width, <span class="number">4</span>):</span><br><span class="line">            block = <span class="built_in">bytes</span>(flag[i+ii,j+jj,c] <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>) <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br><span class="line">            message += block</span><br><span class="line">    enc_msg = cipher.encrypt(message)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, height, <span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, width, <span class="number">4</span>):</span><br><span class="line">            enc[i:i+<span class="number">4</span>,j:j+<span class="number">4</span>,c] = [[enc_msg[(i*width+j*<span class="number">4</span>)+ii+jj] <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">16</span>,<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">cv2.imwrite(<span class="string">&#x27;encrypted.png&#x27;</span>, enc)</span><br></pre></td></tr></table></figure><br>utils.py<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mode</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    ECB = <span class="number">0x0</span></span><br><span class="line">    CBC = <span class="number">0x1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">StupidBOX = [</span><br><span class="line">    <span class="number">0x2a</span>, <span class="number">0x70</span>, <span class="number">0x7e</span>, <span class="number">0x24</span>, <span class="number">0x43</span>, <span class="number">0x19</span>, <span class="number">0x17</span>, <span class="number">0x4d</span>, <span class="number">0xf8</span>, <span class="number">0xa2</span>, <span class="number">0xac</span>, <span class="number">0xf6</span>, <span class="number">0x91</span>, <span class="number">0xcb</span>, <span class="number">0xc5</span>, <span class="number">0x9f</span>,</span><br><span class="line">    <span class="number">0x8e</span>, <span class="number">0xd4</span>, <span class="number">0xda</span>, <span class="number">0x80</span>, <span class="number">0xe7</span>, <span class="number">0xbd</span>, <span class="number">0xb3</span>, <span class="number">0xe9</span>, <span class="number">0x5c</span>, <span class="number">0x06</span>, <span class="number">0x08</span>, <span class="number">0x52</span>, <span class="number">0x35</span>, <span class="number">0x6f</span>, <span class="number">0x61</span>, <span class="number">0x3b</span>,</span><br><span class="line">    <span class="number">0x6b</span>, <span class="number">0x31</span>, <span class="number">0x3f</span>, <span class="number">0x65</span>, <span class="number">0x02</span>, <span class="number">0x58</span>, <span class="number">0x56</span>, <span class="number">0x0c</span>, <span class="number">0xb9</span>, <span class="number">0xe3</span>, <span class="number">0xed</span>, <span class="number">0xb7</span>, <span class="number">0xd0</span>, <span class="number">0x8a</span>, <span class="number">0x84</span>, <span class="number">0xde</span>,</span><br><span class="line">    <span class="number">0xcf</span>, <span class="number">0x95</span>, <span class="number">0x9b</span>, <span class="number">0xc1</span>, <span class="number">0xa6</span>, <span class="number">0xfc</span>, <span class="number">0xf2</span>, <span class="number">0xa8</span>, <span class="number">0x1d</span>, <span class="number">0x47</span>, <span class="number">0x49</span>, <span class="number">0x13</span>, <span class="number">0x74</span>, <span class="number">0x2e</span>, <span class="number">0x20</span>, <span class="number">0x7a</span>,</span><br><span class="line">    <span class="number">0xa9</span>, <span class="number">0xf3</span>, <span class="number">0xfd</span>, <span class="number">0xa7</span>, <span class="number">0xc0</span>, <span class="number">0x9a</span>, <span class="number">0x94</span>, <span class="number">0xce</span>, <span class="number">0x7b</span>, <span class="number">0x21</span>, <span class="number">0x2f</span>, <span class="number">0x75</span>, <span class="number">0x12</span>, <span class="number">0x48</span>, <span class="number">0x46</span>, <span class="number">0x1c</span>,</span><br><span class="line">    <span class="number">0x0d</span>, <span class="number">0x57</span>, <span class="number">0x59</span>, <span class="number">0x03</span>, <span class="number">0x64</span>, <span class="number">0x3e</span>, <span class="number">0x30</span>, <span class="number">0x6a</span>, <span class="number">0xdf</span>, <span class="number">0x85</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0xb6</span>, <span class="number">0xec</span>, <span class="number">0xe2</span>, <span class="number">0xb8</span>,</span><br><span class="line">    <span class="number">0xe8</span>, <span class="number">0xb2</span>, <span class="number">0xbc</span>, <span class="number">0xe6</span>, <span class="number">0x81</span>, <span class="number">0xdb</span>, <span class="number">0xd5</span>, <span class="number">0x8f</span>, <span class="number">0x3a</span>, <span class="number">0x60</span>, <span class="number">0x6e</span>, <span class="number">0x34</span>, <span class="number">0x53</span>, <span class="number">0x09</span>, <span class="number">0x07</span>, <span class="number">0x5d</span>,</span><br><span class="line">    <span class="number">0x4c</span>, <span class="number">0x16</span>, <span class="number">0x18</span>, <span class="number">0x42</span>, <span class="number">0x25</span>, <span class="number">0x7f</span>, <span class="number">0x71</span>, <span class="number">0x2b</span>, <span class="number">0x9e</span>, <span class="number">0xc4</span>, <span class="number">0xca</span>, <span class="number">0x90</span>, <span class="number">0xf7</span>, <span class="number">0xad</span>, <span class="number">0xa3</span>, <span class="number">0xf9</span>,</span><br><span class="line">    <span class="number">0x2d</span>, <span class="number">0x77</span>, <span class="number">0x79</span>, <span class="number">0x23</span>, <span class="number">0x44</span>, <span class="number">0x1e</span>, <span class="number">0x10</span>, <span class="number">0x4a</span>, <span class="number">0xff</span>, <span class="number">0xa5</span>, <span class="number">0xab</span>, <span class="number">0xf1</span>, <span class="number">0x96</span>, <span class="number">0xcc</span>, <span class="number">0xc2</span>, <span class="number">0x98</span>,</span><br><span class="line">    <span class="number">0x89</span>, <span class="number">0xd3</span>, <span class="number">0xdd</span>, <span class="number">0x87</span>, <span class="number">0xe0</span>, <span class="number">0xba</span>, <span class="number">0xb4</span>, <span class="number">0xee</span>, <span class="number">0x5b</span>, <span class="number">0x01</span>, <span class="number">0x0f</span>, <span class="number">0x55</span>, <span class="number">0x32</span>, <span class="number">0x68</span>, <span class="number">0x66</span>, <span class="number">0x3c</span>,</span><br><span class="line">    <span class="number">0x6c</span>, <span class="number">0x36</span>, <span class="number">0x38</span>, <span class="number">0x62</span>, <span class="number">0x05</span>, <span class="number">0x5f</span>, <span class="number">0x51</span>, <span class="number">0x0b</span>, <span class="number">0xbe</span>, <span class="number">0xe4</span>, <span class="number">0xea</span>, <span class="number">0xb0</span>, <span class="number">0xd7</span>, <span class="number">0x8d</span>, <span class="number">0x83</span>, <span class="number">0xd9</span>,</span><br><span class="line">    <span class="number">0xc8</span>, <span class="number">0x92</span>, <span class="number">0x9c</span>, <span class="number">0xc6</span>, <span class="number">0xa1</span>, <span class="number">0xfb</span>, <span class="number">0xf5</span>, <span class="number">0xaf</span>, <span class="number">0x1a</span>, <span class="number">0x40</span>, <span class="number">0x4e</span>, <span class="number">0x14</span>, <span class="number">0x73</span>, <span class="number">0x29</span>, <span class="number">0x27</span>, <span class="number">0x7d</span>,</span><br><span class="line">    <span class="number">0xae</span>, <span class="number">0xf4</span>, <span class="number">0xfa</span>, <span class="number">0xa0</span>, <span class="number">0xc7</span>, <span class="number">0x9d</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x7c</span>, <span class="number">0x26</span>, <span class="number">0x28</span>, <span class="number">0x72</span>, <span class="number">0x15</span>, <span class="number">0x4f</span>, <span class="number">0x41</span>, <span class="number">0x1b</span>,</span><br><span class="line">    <span class="number">0x0a</span>, <span class="number">0x50</span>, <span class="number">0x5e</span>, <span class="number">0x04</span>, <span class="number">0x63</span>, <span class="number">0x39</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0xd8</span>, <span class="number">0x82</span>, <span class="number">0x8c</span>, <span class="number">0xd6</span>, <span class="number">0xb1</span>, <span class="number">0xeb</span>, <span class="number">0xe5</span>, <span class="number">0xbf</span>,</span><br><span class="line">    <span class="number">0xef</span>, <span class="number">0xb5</span>, <span class="number">0xbb</span>, <span class="number">0xe1</span>, <span class="number">0x86</span>, <span class="number">0xdc</span>, <span class="number">0xd2</span>, <span class="number">0x88</span>, <span class="number">0x3d</span>, <span class="number">0x67</span>, <span class="number">0x69</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0x0e</span>, <span class="number">0x00</span>, <span class="number">0x5a</span>,</span><br><span class="line">    <span class="number">0x4b</span>, <span class="number">0x11</span>, <span class="number">0x1f</span>, <span class="number">0x45</span>, <span class="number">0x22</span>, <span class="number">0x78</span>, <span class="number">0x76</span>, <span class="number">0x2c</span>, <span class="number">0x99</span>, <span class="number">0xc3</span>, <span class="number">0xcd</span>, <span class="number">0x97</span>, <span class="number">0xf0</span>, <span class="number">0xaa</span>, <span class="number">0xa4</span>, <span class="number">0xfe</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">PeroPero = [<span class="number">0</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">25</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">26</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">19</span>, <span class="number">27</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">28</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">22</span>, <span class="number">30</span>, <span class="number">7</span>,</span><br><span class="line">            <span class="number">15</span>, <span class="number">23</span>, <span class="number">31</span>]</span><br><span class="line">rol = <span class="keyword">lambda</span> a, b: (a &gt;&gt; <span class="number">8</span> - b | a &lt;&lt; b) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">schedule</span>(<span class="params">key: <span class="built_in">bytes</span></span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        key = key[<span class="number">1</span>:] + <span class="built_in">bytes</span>([rol(<span class="built_in">sum</span>(<span class="number">114</span> * (k &lt;&lt; i) % <span class="number">42</span> <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(key)) &amp; <span class="number">0xFF</span>, <span class="number">3</span>)])</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">16</span> == <span class="number">0</span>:</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">            <span class="keyword">yield</span> key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cipher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key: <span class="built_in">bytes</span>, mode: Mode, iv: <span class="built_in">bytes</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(key) != <span class="number">16</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Wrong key length :(&#x27;</span>)</span><br><span class="line">        self.key = key</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.rounds = <span class="number">9</span></span><br><span class="line">        <span class="keyword">if</span> self.mode == Mode.CBC:</span><br><span class="line">            <span class="keyword">if</span> iv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&#x27;I need IV :(&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(iv) != <span class="number">16</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Wrong IV length :(&#x27;</span>)</span><br><span class="line">            self.iv = iv</span><br><span class="line">        self.round_keys = []</span><br><span class="line">        sche = schedule(self.key)</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(self.rounds + <span class="number">1</span>):</span><br><span class="line">            self.round_keys.append(<span class="built_in">next</span>(sche))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">K</span>(<span class="params">self, block: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(block, key))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">self, block: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(StupidBOX[a] <span class="keyword">for</span> a <span class="keyword">in</span> block)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">A_</span>(<span class="params">self, block32: <span class="built_in">bytes</span></span>):</span><br><span class="line">        ret = [<span class="literal">None</span>] * <span class="number">32</span></span><br><span class="line">        <span class="keyword">for</span> p, a <span class="keyword">in</span> <span class="built_in">zip</span>(PeroPero, block32):</span><br><span class="line">            ret[p] = a</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(ret)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">A</span>(<span class="params">self, block: <span class="built_in">bytes</span></span>):</span><br><span class="line">        bits = <span class="string">&#x27;&#x27;</span>.join(<span class="string">f&#x27;<span class="subst">&#123;a:08b&#125;</span>&#x27;</span> <span class="keyword">for</span> a <span class="keyword">in</span> block)</span><br><span class="line">        enc = <span class="string">&#x27;&#x27;</span>.join(self.A_(bits[i:i + <span class="number">32</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">128</span>, <span class="number">32</span>))</span><br><span class="line">        enc = <span class="built_in">hex</span>(<span class="built_in">int</span>(enc, <span class="number">2</span>))[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(enc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt_block</span>(<span class="params">self, block: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(self.rounds):</span><br><span class="line">            key = self.round_keys[r]</span><br><span class="line">            block = self.K(block, key)</span><br><span class="line">            block = self.S(block)</span><br><span class="line">            block = self.A(block)</span><br><span class="line">        key = self.round_keys[r + <span class="number">1</span>]</span><br><span class="line">        block = self.K(block, key)</span><br><span class="line">        <span class="keyword">return</span> block</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, msg: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(msg) % <span class="number">16</span> == <span class="number">0</span>, <span class="string">&#x27;Wrong message length :(&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> self.mode == Mode.ECB:</span><br><span class="line">            blocks = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>):</span><br><span class="line">                blocks.append(self.encrypt_block(msg[i:i + <span class="number">16</span>]))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span>.join(blocks)</span><br><span class="line">        <span class="keyword">elif</span> self.mode == Mode.CBC:</span><br><span class="line">            blocks = []</span><br><span class="line">            last = self.iv</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>):</span><br><span class="line">                blocks.append(self.encrypt_block(self.K(msg[i:i + <span class="number">16</span>], last)))</span><br><span class="line">                last = blocks[-<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span>.join(blocks)</span><br></pre></td></tr></table></figure></p>
<p>上面仍然是一个线性盒,也就是说满足 <code>box[i^j]=box[i]^box[j]</code> .<br>放到图片上,我们设C[i]=第i个密文块,然后<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C[i] = F(M[i] + C[i-1], key) + X</span><br><span class="line">C[i+1] = F(M[i+1] + C[i], key) + X</span><br></pre></td></tr></table></figure></p>
<p>其中X是一个常数.上式相加,对F求逆,则有<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">M[i] + M[i+1] = F^-1(C[i] + C[i+1]) + C[i] + C[i-1]</span><br></pre></td></tr></table></figure></p>
<p>所以我们可以通过块与块之间的diff看出来这张图片是什么.<br>hint:AES变换的九轮过程可以打包一起分析.<br>所以最后…要到的exp是这么写的:(其中iv和key可以随便填)<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">xor = <span class="keyword">lambda</span> a, b: <span class="built_in">bytes</span>(aa^bb <span class="keyword">for</span> aa, bb <span class="keyword">in</span> <span class="built_in">zip</span>(a, b))</span><br><span class="line"></span><br><span class="line">StupidBOX_inv = [StupidBOX.index(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cipher2</span>(<span class="title class_ inherited__">Cipher</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(*args, **kwargs)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">F</span>(<span class="params">self, block: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">            block = self.S(block)</span><br><span class="line">            block = <span class="built_in">bytes</span>(b ^ StupidBOX[<span class="number">0</span>] <span class="keyword">for</span> b <span class="keyword">in</span> block)</span><br><span class="line">            block = self.A(block)</span><br><span class="line">        <span class="keyword">return</span> block</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">S_inv</span>(<span class="params">self, block: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(StupidBOX_inv[a] <span class="keyword">for</span> a <span class="keyword">in</span> block)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">A_inv_</span>(<span class="params">self, block32: <span class="built_in">bytes</span></span>):</span><br><span class="line">        ret = [<span class="literal">None</span>]*<span class="number">32</span></span><br><span class="line">        <span class="keyword">for</span> i, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(PeroPero):</span><br><span class="line">            ret[i] = block32[p]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(ret)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">A_inv</span>(<span class="params">self, block: <span class="built_in">bytes</span></span>):</span><br><span class="line">        bits = <span class="string">&#x27;&#x27;</span>.join(<span class="string">f&#x27;<span class="subst">&#123;a:08b&#125;</span>&#x27;</span> <span class="keyword">for</span> a <span class="keyword">in</span> block)</span><br><span class="line">        enc = <span class="string">&#x27;&#x27;</span>.join(self.A_inv_(bits[i:i+<span class="number">32</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">128</span>, <span class="number">32</span>))</span><br><span class="line">        enc = <span class="built_in">hex</span>(<span class="built_in">int</span>(enc, <span class="number">2</span>))[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(enc)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">F_inv</span>(<span class="params">self, block: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">            block = self.A_inv(block)</span><br><span class="line">            block = <span class="built_in">bytes</span>(b ^ StupidBOX[<span class="number">0</span>] <span class="keyword">for</span> b <span class="keyword">in</span> block)</span><br><span class="line">            block = self.S_inv(block)</span><br><span class="line">        <span class="keyword">return</span> block</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">vuln</span>(<span class="params">self, msg: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(msg) % <span class="number">16</span> == <span class="number">0</span>, <span class="string">&#x27;Wrong message length :(&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> self.mode == Mode.CBC, <span class="string">&quot;Baka :p&quot;</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        C[i]   = F(M[i] + C[i-1]) + X</span></span><br><span class="line"><span class="string">        C[i+1] = F(M[i+1] + C[i]) + X</span></span><br><span class="line"><span class="string">        M[i] + M[i+1] = F^-1(C[i] + C[i+1]) + C[i] + C[i-1]</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        ret = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        last = <span class="literal">None</span></span><br><span class="line">        lastlast = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>):</span><br><span class="line">            block = msg[i:i+<span class="number">16</span>]</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                last = block</span><br><span class="line">                ret += block</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">16</span>:</span><br><span class="line">                lastlast = last</span><br><span class="line">                last = block</span><br><span class="line">                ret += block</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            ret += xor(</span><br><span class="line">                xor(last, lastlast),</span><br><span class="line">                self.F_inv(xor(last, block))</span><br><span class="line">            )</span><br><span class="line">            lastlast = last</span><br><span class="line">            last = block</span><br><span class="line">        <span class="keyword">return</span> ret       </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">enc = cv2.imread(<span class="string">&#x27;encrypted.png&#x27;</span>, cv2.IMREAD_COLOR)</span><br><span class="line">enc = cv2.cvtColor(enc, cv2.COLOR_BGR2RGB)</span><br><span class="line"></span><br><span class="line">height, width, channels = enc.shape</span><br><span class="line"><span class="keyword">assert</span> height % <span class="number">4</span> == <span class="number">0</span> <span class="keyword">and</span> width % <span class="number">4</span> == <span class="number">0</span> <span class="keyword">and</span> channels == <span class="number">3</span></span><br><span class="line"></span><br><span class="line">vuln = np.zeros((height, width, channels), dtype=np.uint8)</span><br><span class="line"></span><br><span class="line">cipher_vuln = Cipher2(<span class="string">b&#x27;aaaaaaaaaaaaaaaa&#x27;</span>, Mode.CBC, iv = <span class="string">b&#x27;7hiS 1s 16 byt3s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(channels):</span><br><span class="line">    message = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, height, <span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, width, <span class="number">4</span>):</span><br><span class="line">            block = <span class="built_in">bytes</span>(enc[i+ii,j+jj,c] <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>) <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br><span class="line">            message += block</span><br><span class="line">    vuln_msg = cipher_vuln.vuln(message)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, height, <span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, width, <span class="number">4</span>):</span><br><span class="line">            vuln[i:i+<span class="number">4</span>,j:j+<span class="number">4</span>,c] = [[vuln_msg[(i*width+j*<span class="number">4</span>)+ii+jj] <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">16</span>,<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">cv2.imwrite(<span class="string">&#x27;unchained.png&#x27;</span>, vuln)</span><br></pre></td></tr></table></figure></p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="fmtstr"><a href="#fmtstr" class="headerlink" title="fmtstr"></a>fmtstr</h2><p>标准字符串利用漏洞,使用printf输出的字符串有%什么的就可以操作了,然后就能读变量改变量…<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c读一个字符</span><br><span class="line">d读一个数字</span><br><span class="line"></span><br><span class="line">n写入</span><br><span class="line">p读取地址</span><br><span class="line"></span><br><span class="line">注意栈对齐(%9$n前面加上四个补齐栈区)</span><br></pre></td></tr></table></figure></p>
<h1 id="Flu"><a href="#Flu" class="headerlink" title="Flu"></a>Flu</h1><p>Flu设想出一系列的套题,这些题是如此操作:<br>AES很高级,所以我们给密文和一些数据,还有一道”密码体系”,用于计算密钥.  </p>
<p>这个”密码体系”可以是有缺陷的RSA等,这是标准密码题.<br>既然这是一道算数题,那么…我们为什么不在”密码体系”这里放一道时间复杂度爆炸的算法题,然后让选手优化算法去高效算数得到密钥和flag呢…</p>
<p>又或者说,反正数据结构上都上了,为什么不编译一下丢到Reverse里呢…</p>
<p>但这是不对的:</p>
<blockquote>
<p>not faithful to the source.<br>代码是描述性的.</p>
<p>一般来说,一道好的密码题要有一个明确的明文和密文,和清晰的加密逻辑.</p>
</blockquote>

  </div>
</article>
<script src="https://giscus.app/client.js"
        data-repo="NaraFluorine/NaraFluorine.github.io"
        data-repo-id="R_kgDONrzj3A"
        data-category="Announcements"
        data-category-id="DIC_kwDONrzj3M4C02ef"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="noborder_dark"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/tags/">标签</a></li>
        
          <li><a href="/categories/">分类</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
          <li><a href="/friends/">友链</a></li>
        
          <li><a href="/QSL/">QSL</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web"><span class="toc-number">1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%9C%A8%E5%93%AA%E9%87%8C%E5%91%A2"><span class="toc-number">1.1.</span> <span class="toc-text">密码在哪里呢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A2%E8%AF%BE"><span class="toc-number">1.2.</span> <span class="toc-text">抢课</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B1%E5%BE%97%E7%A6%BB%E8%B0%B1%E7%9A%84%E7%AD%BE%E5%90%8D-JWT"><span class="toc-number">1.3.</span> <span class="toc-text">弱得离谱的签名 JWT</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#misc"><span class="toc-number">2.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#stream2"><span class="toc-number">2.1.</span> <span class="toc-text">stream2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#no-more-taowa"><span class="toc-number">2.2.</span> <span class="toc-text">no more taowa</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pcapng"><span class="toc-number">2.3.</span> <span class="toc-text">pcapng</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">3.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%AE%A1%E8%AE%A1"><span class="toc-number">3.1.</span> <span class="toc-text">最终审计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GoodCoding"><span class="toc-number">3.2.</span> <span class="toc-text">GoodCoding</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MediumPyc"><span class="toc-number">3.3.</span> <span class="toc-text">MediumPyc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ex"><span class="toc-number">3.3.1.</span> <span class="toc-text">Ex</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#number-game"><span class="toc-number">3.4.</span> <span class="toc-text">number game</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#d%E9%AB%98%E4%BD%8Dcoppersmith"><span class="toc-number">4.1.</span> <span class="toc-text">d高位coppersmith</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#d%E7%BB%9D%E5%AF%B9%E5%80%BC%E5%BE%88%E5%B0%8F%E7%9A%84coppersmith"><span class="toc-number">4.2.</span> <span class="toc-text">d绝对值很小的coppersmith</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#fun-fact"><span class="toc-number">4.2.0.1.</span> <span class="toc-text">fun fact</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Earthy-OL"><span class="toc-number">4.3.</span> <span class="toc-text">Earthy OL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#f14g-neq-flag"><span class="toc-number">4.4.</span> <span class="toc-text">f14g $\neq$ flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Glichy-RSA"><span class="toc-number">4.5.</span> <span class="toc-text">Glichy RSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extravagant-Cigarette-Battlefield"><span class="toc-number">4.6.</span> <span class="toc-text">Extravagant Cigarette Battlefield</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">5.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#fmtstr"><span class="toc-number">5.1.</span> <span class="toc-text">fmtstr</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flu"><span class="toc-number">6.</span> <span class="toc-text">Flu</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&text=SpiritCTF 2025 Warm wp"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&is_video=false&description=SpiritCTF 2025 Warm wp"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SpiritCTF 2025 Warm wp&body=Check out this article: https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&title=SpiritCTF 2025 Warm wp"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&name=SpiritCTF 2025 Warm wp&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://narafluorine.github.io/2024/09/12/20016_Spirit_CTF_2025_warm/&t=SpiritCTF 2025 Warm wp"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2026
    Fluorine Wang
  </div>
  <!-- 不蒜子统计 -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  <!-- 不蒜子统计 -->
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/friends/">友链</a></li><!--
     --><!--
       --><li><a href="/QSL/">QSL</a></li><!--
     -->
      </ul>
    </nav>
  </div>

</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
